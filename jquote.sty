%%% jquote.sty by tDB(emath@nifty.com)
%
\NeedsTeXFormat{LaTeX2e}%
\ProvidesPackage{jquote}[2019/07/02 v0.15]%
%
    \RequirePackage{keyval}%
%
\@ifundefined{ltxitem}{\let\ltxitem\item}{}%
%
%
%%% インデント
%%% jquote(#1)(#2)[#3]
%%%     #1 : 左インデント（デフォルト値 2\zw）
%%%     #2 : 右インデント（デフォルト値 0\zw）
%%%     #3 : \topsep
%
%  \define@key{jquote}{tsep}{\edef\t@sep{#1}}%
  \define@key{jquote}{tsep}{\@tempdima=#1\advance\@tempdima-\topsep\edef\t@sep{\the\@tempdima}}%
%  \define@key{jquote}{bsep}{\edef\b@sep{#1}}%
  \define@key{jquote}{bsep}{\@tempdima=#1\advance\@tempdima-\topsep\edef\b@sep{\the\@tempdima}}%
%  \define@key{jquote}{vsep}{\edef\t@sep{#1}\edef\b@sep{#1}}%
  \define@key{jquote}{vsep}{\@tempdima=#1\advance\@tempdima-\topsep\edef\t@sep{\the\@tempdima}\edef\b@sep{\t@sep}}%
  \define@key{jquote}{prestr}{\EMedef\pre@str{#1}}%
%
\def\jquote{%
  \def\t@sep{0pt}\def\b@sep{0pt}\let\pre@str\undefined\edef\jquote@lsep{2\zw}%
  \@ifnextchar<{\jquote@}{\@jquote}}%
\def\jquote@<#1>{\setkeys{jquote}{#1}%
	\@ifundefined{pre@str}{}{%
		\setbox0=\hbox{\pre@str}\edef\jquote@lsep{\the\wd0}%
	}%
	\@jquote}%
\def\@jquote{\@ifnextchar({\@@jquote}{\@@jquote(\jquote@lsep)}}%
\def\@@jquote(#1){%
  \@ifnextchar({\@@@jquote(#1)}{\@@@jquote(#1)(\z@)}}%
\def\@@@jquote(#1)(#2){%
    \@ifnextchar[{\@@@@jquote(#1)(#2)}{\@@@@jquote(#1)(#2)[\topsep]}}%
\def\@@@@jquote(#1)(#2)[#3]{%
% \leavevmode%
  \ifdim\t@sep=\z@\else\vspace*{\t@sep}\fi
  \list{}{\setlength{\leftmargin}{#1}\setlength{\rightmargin}{#2}%
    \parsep\z@ plus\p@\setlength{\topsep}{#3}}%
  \@ifundefined{EMWR@list}{\ltxitem\relax}{\item\relax}%
  \@ifundefined{pre@str}{}{\leavevmode\hbox to \z@{\hss\pre@str\null}}%
  \ignorespaces%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2008/03/07
}%
\def\endjquote{\endlist
  \ifdim\b@sep=\z@\else\vspace*{\b@sep}\fi
}%
%
\def\jquotation{%
  \def\t@sep{0pt}\def\b@sep{0pt}%
  \@ifnextchar<{\jquotation@}{\@jquotation}}%
\def\jquotation@<#1>{\setkeys{jquote}{#1}\@jquotation}%
\def\@jquotation{\@ifnextchar({\@@jquotation}{\@@jquotation(2\zw)}}%
\def\@@jquotation(#1){\@ifnextchar({\@@@jquotation(#1)}{%
\@@@jquotation(#1)(0\zw)}}%
\def\@@@jquotation(#1)(#2){\@ifnextchar[{\@@@@jquotation(#1)(#2)}{%
    \@@@@jquotation(#1)(#2)[\z@ plus\p@]}}%
\def\@@@@jquotation(#1)(#2)[#3]{%
    \ifdim\t@sep=\z@\else\vspace*{\t@sep}\fi
    \list{}{\setlength{\leftmargin}{#1}\setlength{\rightmargin}{#2}%
    \listparindent\parindent%
    \itemindent\parindent\parsep\z@ plus\p@
    \topsep#3\relax}%
%    \hsize=\linewidth%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% for framed
    \item\relax}%
\def\endjquotation{\endlist
  \ifdim\b@sep=\z@\else\vspace*{\b@sep}\fi
}%
%
\def\EMchangeLRskip{%
  \edef\top@par{1}%
  \edef\LR@vsep{\empty}%
  \edef\LR@tsep{\empty}%
  \edef\LR@bsep{\empty}%
  \define@key{LRskip}{toppar}{\edef\top@par{##1}}%
  \define@key{LRskip}{vsep}{\def\LR@vsep{##1}}%
  \define@key{LRskip}{tsep}{\def\LR@tsep{##1}}%
  \define@key{LRskip}{bsep}{\def\LR@bsep{##1}}%
  \@ifnextchar<{\@EMchangeLRskip}{\@EMchangeLRskip<\empty>}}%
\def\@EMchangeLRskip<#1>{\@ifnextchar({\@@EMchangeLRskip<#1>}{\@@EMchangeLRskip<#1>(2\zw)}}%
\def\@@EMchangeLRskip<#1>(#2){\@ifnextchar({\@@@EMchangeLRskip<#1>(#2)}{\@@@EMchangeLRskip<#1>(#2)(\z@)}}%
\def\@@@EMchangeLRskip<#1>(#2)(#3){%
  \@ifnextchar[{\@@@@EMchangeLRskip<#1>(#2)(#3)}{%
                \@@@@EMchangeLRskip<#1>(#2)(#3)[\z@ plus \p@]}}%
\def\@@@@EMchangeLRskip<#1>(#2)(#3)[#4]{%
%
\@ifundefined{Migi@Haiti}{}{%
\def\Migi@Haiti(##1,##2)##3{%
  \leavevmode\vadjust{\kern-\p@\hbox{\smash{\vtop{%
  \noindent\hspace*{\linewidth}\hspace*{-\EMWR@zuhaba}%
%\@ifundefined{EMLR@lskip}{}{%
  \hspace{-\EMLR@lskip}%
  \hspace{-\EMLR@lskip}%
  \hspace{-\EMLR@rskip}%
%}%
  \hspace{\@totalleftmargin}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \@tempdimb ##2\relax
  \relax\leavevmode\lower -\@tempdimb\hbox{\hspace*{##1}##3}}}}\kern\p@}}%
}%
%
  \ifx\empty #1\else
    \setkeys{LRskip}{#1}%
  \fi
  \ifnum\top@par>\z@
    \ifvmode\else\par\noindent\fi
  \fi
  \ifx\empty\LR@vsep\else
    \ifx\empty\LR@tsep\def\LR@tsep{\LR@vsep}\fi
    \ifx\empty\LR@bsep\def\LR@bsep{\LR@vsep}\fi
  \fi
  \@tempdima=#2\relax
  \@tempdimb=#3\relax
  \edef\EMLR@lskip{\the\@tempdima}%
  \edef\EMLR@rskip{\the\@tempdimb}%
  \advance\leftskip#2\relax
%  \advance\rightskip#3\relax
  \advance\hsize-\@tempdimb
  \@ifundefined{mathindent}{}{\advance\mathindent#2\relax}%
%  \advance\@totalleftmargin#2\relax%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \@ifundefined{mwrkmpar}{%
    \advance\linewidth-\@tempdima%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \advance\@totalleftmargin\@tempdima%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \advance\linewidth-\@tempdimb%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  }{\let\par\mwrkmpar}%
  \ifx\empty\LR@tsep\else\vskip\LR@tsep\fi
  \ignorespaces
}%
%
\def\endEMchangeLRskip{%
  \ifx\empty\LR@bsep\else\vskip\LR@bsep\fi
  \par
  \@ifundefined{mwrkmpar}{}{%
    \endgroup\par
    \begingroup\def\@currenvir{EMchangeLRskip}%
  }%
}%
\endinput

v 0.00 2005/06/30 emath.sty から独立
v 0.02 2006/06/07 EMchangeLRskip環境
                  jquote を edaenumerate環境内で使用可能
v 0.03 2006/07/30 mawarikomi環境内の使用に配慮して，上記を修正
v 0.04 2008/01/12 0.03 の修正が逆だった
v 0.05 2008/03/07 \ignorespaces 付加
v 0.06 2008/09/04 空白の混入対策
v 0.07 2009/01/10 \ltxitem 未定義対策
v 0.08 2009/06/01 framed環境に対応 ---> framed で行う (6/16)
v 0.09 2009/06/16 \hsize=\linewidth を ..framed.sty に移管
v 0.10 2010/10/18 EMchangeLRskip 整備 (BBS #8396)
v 0.11 2010/10/21 仝 (BBS #8398)
v 0.12 2010/11/16 EMchangeLRskip: vsep, tsep, bsep
v 0.13 2012/01/06 EMchangeLRskip: 書式を jquotation と揃える
v 0.14 2012/11/23 EMchangeLRskip: \hsize
v 0.15 2019/07/02 \smash : \hbox でくるむ
