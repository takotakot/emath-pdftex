% pszahyou.sty  by tDB (emath@nifty.com)
%
\ProvidesPackage{pszahyou}[2017/08/20 v 2.40a]%
%
% pszahyou 環境
%
%
\define@key{emP}{gradbegin}{\edef\grad@begin{#1}}%
\define@key{emP}{gradend}{\edef\grad@end{#1}}%
\define@key{emP}{gradangle}{\edef\grad@angle{#1}}%
\define@key{emP}{gradN}{\edef\grad@N{#1}}%
\define@key{emP}{gradF}{\edef\grad@F{#1}}%
\define@key{emP}{nextopt}{\EMedef\next@opt{#1}}%
\define@key{emP}{nextoption}{\EMedef\next@opt{#1}}%
\define@key{emPs}{nextopt}{\EMedef\next@opt{#1}}%
\define@key{emPs}{nextoption}{\EMedef\next@opt{#1}}%
\define@key{emPs}{cliplabel}{\edef\EMclip@label{\prelabel #1}}%
\define@key{emPs}{EMcliplabel}{\edef\EMclip@label{\prelabel #1}}%
\define@key{emPs}{Henvi}{\vecXY{#1}\henvi@x\henvi@y
  \ukansan\henvi@x\henvi@x\ukansan\henvi@y\henvi@y
  \edef\hen@i{(\henvi@x,\henvi@y)}}%
\define@key{emPs}{Henvii}{\vecXY{#1}\henvi@x\henvi@y
  \ukansan\henvi@x\henvi@x\ukansan\henvi@y\henvi@y
  \edef\hen@ii{(\henvi@x,\henvi@y)}}%
\define@key{emPs}{henvi}{\def\hen@i{#1}}%
\define@key{emPs}{henvii}{\def\hen@ii{#1}}%
%
\edef\syaei@hasenLG{.5mm,.5mm}%
\def\syaeihasenLG#1{\edef\syaei@hasenLG{#1}}%
%\edef\syaei@linewidth@{1}%
\edef\syaei@linewidth@{2}%   デフォルト値変更 2012/08/14
\def\syaeilinewidth#1{\edef\syaei@linewidth@{#1}}%
\def\syaeithickness#1{\edef\syaei@linewidth@{#1}}%
\edef\pszahyou@N{0}%
%
%\def\pszahyou{%
\DeclareRobustCommand\pszahyou{%
  \xIncr\pszahyou@N
  \define@key{emP}{iro}{\edef\iro@{##1}}%
  \let\Drawline\psDrawline
  \let\Sensyu\psDrawline
  \let\Drawlines\psDrawline
  \let\Drawwave\EMpsDrawwave
  \let\linethickness\setlinewidth
  \let\yclipDrawline\@psDrawline
  \let\xclipDrawline\@psDrawline
  \let\clipDrawline\@psDrawline
  \def\Thicklines{\setlinewidth{1.2pt}}%
  \def\thicklines{\setlinewidth{.8pt}}%
  \def\thinlines{\setlinewidth{.4pt}}%
  \def\EMps@filename{}%%%%%%%%%% pszahyou環境内であることの判定にも利用
  \def\ps@debug@{}%
  \def\EMps@clip{true}%
  \def\default@syaeisensyu{\drawline}%
  \def\zahyou@haiti{\zahyou@haiti@default}%
  \def\zahyou@haiti@hosei{}%
  \def\ue@yohaku{0}%
  \def\sita@yohaku{0}%
  \def\migi@yohaku{0}%
  \def\hidari@yohaku{0}%
  \def\arrow@headsize{1}%
  \edef\v@mark{\empty}%
  \edef\dp@frame{0}%
  \let\EMpsIrositei\EM@psIrositei
  \pszahyou@}%
\def\pszahyou@{\@ifnextchar[{\@pszahyou}{\@pszahyou[\yokozikukigou]}}%
\def\@pszahyou[#1]{\@ifnextchar[{\@@pszahyou[#1]}{%
  \@@pszahyou[#1][\tatezikukigou]}}%
\def\@@pszahyou[#1][#2]{\@ifnextchar<{\@@@pszahyou[#1][#2]}{%
  \@@@pszahyou[#1][#2]<\yokozikuhaiti>}}%
\def\@@@pszahyou[#1][#2]<#3>{\@ifnextchar<{\@@@@pszahyou[#1][#2]<#3>}{%
  \@@@@pszahyou[#1][#2]<#3><\tatezikuhaiti>}}%
\def\@@@@pszahyou[#1][#2]<#3><#4>{%
  \@ifnextchar<{\@@@@@pszahyou[#1][#2]<#3><#4>}{%
    \@@@@@pszahyou[#1][#2]<#3><#4><\gentenhaiti>}}%
\def\@@@@@pszahyou[#1][#2]<#3><#4><#5>{\@ifnextchar({%
    \@@@@@@pszahyou[#1][#2]<#3><#4><#5>}{%
    \@@@@@@pszahyou[#1][#2]<#3><#4><#5>(\xmin,\xmax)(\ymin,\ymax)}}%
\def\@@@@@@pszahyou[#1][#2]<#3><#4><#5>(#6,#7)(#8,#9){%
%  \def\zahyou@haiti{b}%
%  \def\zahyou@haiti@hosei{}%
%  \def\ue@yohaku{0}%
%  \def\sita@yohaku{0}%
%  \def\migi@yohaku{0}%
%  \def\hidari@yohaku{0}%
%  \def\arrow@headsize{1}%
  \@@@@@zahyou[#1][#2]<#3><#4><#5>(#6,#7)(#8,#9)\relax
%
%\typeout{xmin=\xmin,ymin=\ymin}%\xxx%
\@ifundefined{EMps@rx@include}{}{%
  \Add\xmin\EMps@rx@include\EMps@x@include
  \Add\ymin\EMps@ry@include\EMps@y@include
}%
\@ifundefined{EMps@x@include}{%
  \edef\EMps@x@include{\xmin}%
  \edef\EMps@y@include{\ymin}%
  \edef\include@origin{(0,0)}%
}{%
  \Sub\xmin\EMps@x@include\EMps@x@include
  \Sub\ymin\EMps@y@include\EMps@y@include
  \edef\include@origin{(\EMps@x@include,\EMps@y@include)}%
  \Addself\EMps@x@include\xmin
  \Addself\EMps@y@include\ymin
}%
%
% \def\special#1{\@warning{pszahyou環境でspecial:#1を使おうとしています。}}%
  \ifthenelse{\equal\EMps@filename\empty}{%
    \refstepcounter{EMps@flnm}%
\@ifundefined{Ginclude@image@common}{%
    \edef\EMps@filename{\EMps@filedir\EMworkfilename_e\theEMps@flnm .eps}%
}{%
    \edef\EMps@filename{\EMps@filedir\EMworkfilename\theEMps@flnm .eps}%
}%
  }{}%
  \xdef\currentEPSfile{\EMps@filename}%
%\typeout{EPSfile:\currentEPSfile}%
  \IfFileExists{\EMps@filename}{\edef\EMps@mode{0}}{\edef\EMps@mode{1}}%
  \@ifundefined{ps@debug}{}{\xdef\save@perldata{0}\edef\EMps@mode{1}}%
  \ifthenelse{\equal\ps@debug@\empty}{}{\xdef\save@perldata{0}\edef\EMps@mode{1}}%
\ifnum\remake@eps>\z@\edef\EMps@mode{1}\fi
%
  \edef\Kuromaru@Hankei{\psKuromaru@Hankei}%
  \edef\Kurosikaku@Hankei{\psKurosikaku@Hankei}%
  \edef\Kurosankaku@Hankei{\psKurosankaku@Hankei}%
  \edef\Siromaru@Hankei{\psSiromaru@Hankei}%
  \edef\Sirosikaku@Hankei{\psSirosikaku@Hankei}%
  \edef\Sirosankaku@Hankei{\psSirosankaku@Hankei}%
  \def\psdraw{%
    \ifthenelse{\EMps@mode=\z@}{%
      \comment
    }{%
      \def\endcomment{\relax}}%
    }%
  \def\endpsdraw{\endcomment}%
%
% as \EMps@mode=0
%
  \ifthenelse{\EMps@mode=\z@}{%
    \def\writeEPS##1{\relax\ignorespaces}%
    \def\pushGP{\relax\ignorespaces}%
    \def\popGP{\relax\ignorespaces}%
    \let\gsave\pushGP
    \let\grestore\popGP
%    \def\setlinewidth##1{\edef\cur@linewidth{##1}\@Div\cur@linewidth{2}\cur@halflinewidth}%
    \def\setlinewidth##1{%
%      \@wholewidth ##1\relax \@halfwidth .5\@wholewidth
      \upszkansan{##1}\cur@linewidth
        \@Div\cur@linewidth{10}\cur@linewidth@
        \@wholewidth\cur@linewidth@\p@
        \@halfwidth=.5\@wholewidth
      \@Div\cur@linewidth{2}\cur@halflinewidth\ignorespaces
    }%
    \let\linethickness\setlinewidth
    \def\setlinecap##1{\edef\cur@linecap{##1}\ignorespaces}%
    \def\setlinejoin##1{\edef\cur@linejoin{##1}\ignorespaces}%
    \def\setd@sh{\protect\@setd@sh}%
    \def\@setd@sh{\@ifnextchar[{\@@setd@sh}{\@@setd@sh[0]}}%
    \def\@@setd@sh[##1]##2{%
      \ifthenelse{\equal{##2}\empty}{%
        \edef\cur@dash{}\edef\cur@dashoffset{0}}{%
        \edef\cur@dash{##2}\edef\cur@dashoffset{##1}%
      }\ignorespaces}%
    \def\@@Ensyuu##1##2{\relax\ignorespaces}%
    \def\@@Enban[##1]<##2>##3##4{\relax\ignorespaces}%
    \def\@@@Hatch@Circle[##1]<##2>(##3)##4##5{\relax\ignorespaces}%
    \def\Enk@@@<##1>##2##3[##4]##5[##6]##7{\relax\ignorespaces}%
%    \def\@Daen##1##2##3{\relax\ignorespaces}%
    \def\@@Daen<##1>##2##3##4{\relax\ignorespaces}%
    \def\@Daen@[##1]##2##3##4{\relax\ignorespaces}%
    \def\@@@Daenko[##1][##2]##3##4##5##6{\relax\egroup\ignorespaces}%
    \def\drawline(##1,##2){%
      \@ifnextchar({\@drawline}{\relax}%
    }%
    \def\@drawline(##1,##2){%
      \@ifnextchar({\drawline}{\relax\ignorespaces}%
    }%
    \def\Takakkei{\@ifnextchar<{\@Takakkei}{\@Takakkei<\empty>}}%
    \def\@Takakkei<##1>##2{\relax\ignorespaces}%
%
\edef\nest@clip{0}%
\edef\YG@migiT{\empty}%
\edef\YG@hidariT{\empty}%
\define@key{emPs}{migiT}[migiT]{\def\YG@migiT{##1}}%
\define@key{emPs}{hidariT}[hidariT]{\def\YG@hidariT{##1}}%
\define@key{emPs}{ueT}[ueT]{\def\YG@migiT{##1}}%
\define@key{emPs}{sitaT}[sitaT]{\def\YG@hidariT{##1}}%
\def\clipborder{\@ifnextchar[{\@clipborder}{\@clipborder[\empty]}}%
\def\@clipborder[##1]{%
  \@ifnextchar<{\@@clipborder[##1]}{\@@clipborder[##1]<\empty>}}%
\def\@@clipborder[##1]<##2>{\@ifnextchar\bgroup{\@@@clipborder[##1]<##2>}{%
  \@@@clipborder[##1]<##2>{}}}%
%\def\@@@clipborder[##1]<##2>(##3){%
\def\@@@clipborder[##1]<##2>##3{%
  \ifnum\remake@eps=\z@
    \errmessage{cannot use clipborder with noremake-option for emathPs}
  \fi
\edef\EMclip@label{\empty}%
  \ifthenelse{\equal{##3}\empty}{%
    \edef\cb@tmp{\clip@lni}%
  }{%
    \edef\cb@tmp{\csname clip@ln@\prelabel ##3\endcsname}%
  }%
  \edef\YG@migiT{\empty}%
  \edef\YG@hidariT{\empty}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \Drawline<##2>\cb@tmp
\ifx\empty\EMclip@label
\else
  \expandafter\xdef\csname clip@ln@\EMclip@label\endcsname{%
    \csname clip@ln\romannumeral\nest@clip\endcsname}%
\fi
  \ifthenelse{\equal\YG@hidariT\empty \and \equal\YG@migiT\empty}{}{%
%          \Strsep\cb@tmp{)(}\cb@a\cb@b
          \expandafter\makeTenHairetu\cb@tmp
          \edef\cb@a{\hairetu{TH@V}{1}}%
          \edef\cb@b{\hairetu{TH@V}{\TH@N}}%
%          \vecXY\cb@a\cb@ax\cb@ay
%          \vecXY\cb@b\cb@bx\cb@by
%          \ifdim\cb@ax\p@<\cb@bx\p@\else\swap\cb@a\cb@b\fi
          \expandafter\edef\csname\YG@hidariT\endcsname{\cb@a}%
          \expandafter\edef\csname\YG@migiT\endcsname{\cb@b}%
  }%
\ignorespaces
}%
%
\def\clipborders{\@ifnextchar[{\@clipborders}{\@clipborders[\empty]}}%
\def\@clipborders[##1]{%
  \@ifnextchar<{\@@clipborders[##1]}{\@@clipborders[##1]<\empty>}}%
\def\@@clipborders[##1]<##2>##3{%
  \@for\cbs@l:=##3\do{\@@@clipborder[##1]<##2>{\cbs@l}}%
}%
%
\def\clipxrange{\@ifnextchar<{\@clipxrange}{\@clipxrange<\empty>}}%
\def\@clipxrange<##1>##2{\relax}%
\def\clipyrange{\@ifnextchar<{\@clipyrange}{\@clipyrange<\empty>}}%
\def\@clipyrange<##1>##2{\relax}%
\def\endclipxrange{\relax}%
\def\endclipyrange{\relax}%
\def\clipSyougen##1{\relax}%
\def\endclipSyougen{\relax}%
%
    \def\clipTakakkei{\@ifnextchar<{\@clipTakakkei}{\@clipTakakkei<\empty>}}%
    \def\@clipTakakkei<##1>##2{\relax\ignorespaces}%
    \def\endclipTakakkei{\relax\ignorespaces}%
    \def\clipEn{\@ifnextchar<{\@clipEn}{\@clipEn<\empty>}}%
    \def\@clipEn<##1>##2##3{\relax}%
    \def\clipDaen{\@ifnextchar<{\@clipDaen}{\@clipDaen<\empty>}}%
    \def\@clipDaen<##1>##2##3##4{\relax}%
    \def\clipSoukyokusen{%
      \@ifnextchar<{\@clipSoukyokusen}{\@clipSoukyokusen<\empty>}}%
    \def\@clipSoukyokusen<##1>##2##3##4{\relax}%
    \def\clipLline{\@ifnextchar<{\@clipLline}{\@clipLline<\empty>}}%
    \def\@clipLline<##1>##2##3{\relax}%
    \def\cliplline{\@ifnextchar<{\@cliplline}{\@cliplline<\empty>}}%
    \def\@cliplline<##1>##2##3{\relax}%
    \def\clipkline{\@ifnextchar<{\@clipkline}{\@clipkline<\empty>}}%
    \def\@clipkline<##1>##2##3{\relax}%
    \def\clipgline{\@ifnextchar<{\@clipgline}{\@clipgline<\empty>}}%
    \def\@clipgline<##1>##2##3{\relax}%
    \def\clipabcline{\@ifnextchar<{\@clipabcline}{\@clipabcline<\empty>}}%
    \def\@clipabcline<##1>##2{\relax}%
    \expandafter\def\csname clipabcline+\endcsname##1{\relax}%
    \expandafter\def\csname clipabcline-\endcsname##1{\relax}%
    \expandafter\def\csname endclipabcline+\endcsname{\relax}%
    \expandafter\def\csname endclipabcline--\endcsname{\relax}%
    \def\endclipLline{\relax}%
    \def\endcliplline{\relax}%
    \def\endclipkline{\relax}%
    \def\endclipgline{\relax}%
    \def\endclipDaen{\relax}%
    \def\endclipSoukyokusen{\relax}%
    \def\endclipabcline{\relax}%
    \def\setarrowsize{\@ifnextchar<{\@setarrowsize}{\@setarrowsize<\ArrowHeadPit>}}%
    \def\@setarrowsize<##1>##2##3##4{\relax\ignorespaces}%
%    \def\setarrowSize{\@ifnextchar<{\@setarrowSize}{\@setarrowSize<\ArrowHeadPit>}}%
%    \def\@setarrowSize<##1>##2##3##4{\relax}%
    \def\@@ArrowLine<##1>[##2]##3##4{%
      \edef\put@str{\empty}\def\put@pos{.5}%
      \ifx\empty ##1\else\setkeys{emP}{##1}\fi
      \Subvec{##4}{##3}\miki@v
      \ifx\empty\put@str\else
        \Mulvec\put@pos\miki@v\put@p\Addvec{##3}\put@p\put@p
        \expandafter\emathPut\expandafter\put@p\put@str
      \fi\ignorespaces}%
    \def\drawXYaxis{%
      \edef\zahyou@tmp{{(\truexmax,0)}\yokozikuhaiti}%
%      \expandafter\emathPut\zahyou@tmp{\yokozikukigou}%
      \expandafter\cPut\zahyou@tmp{\yokozikukigou}%
      \edef\zahyou@tmp{{(0,\trueymax)}\tatezikuhaiti}%
%      \expandafter\emathPut\zahyou@tmp{\tatezikukigou}%
      \expandafter\cPut\zahyou@tmp{\tatezikukigou}%
      \edef\zahyou@tmp{{(0,0)}\gentenhaiti}%
%      \expandafter\emathPut\zahyou@tmp{\gentenkigou}%
      \expandafter\cPut\zahyou@tmp{\gentenkigou}%
      \ignorespaces}%
%   \def\@hasen(##1,##2){\@ifnextchar({\@@hasen(##1,##2)}{\relax}}%
%   \def\@@hasen(##1,##2)(##3,##4){\@hasen(##3,##4)}%
    \def\@@@ougigata[##1]<##2>##3##4##5{\relax\ignorespaces}%
    \def\@@hatch@ougigata[##1]<##2>##3##4##5{\relax\ignorespaces}%
    \def\@@@yumigata[##1]<##2>##3##4##5{\relax\ignorespaces}%
    \def\@@hatch@yumigata[##1]<##2>##3##4##5{\relax\ignorespaces}%
    \def\nuritubusi{\@ifnextchar[{\@nuritubusi}{\@nuritubusi[.5]}}%
    \def\@nuritubusi[##1]{\@@nuritubusi}%
    \def\@@nuritubusi(##1,##2){%
      \@ifnextchar({\@@nuritubusi}{\relax\ignorespaces}%
    }%
    \def\@Nuritubusi[##1]<##2>##3{\relax\ignorespaces}%
    \def\@@Hatchpolygon[##1]<##2>##3{\relax\ignorespaces}%
%   \def\YGurafu@@@@@(##1)(##2)##3{\relax}%
    \def\@@YGurafu(##1)(##2)##3##4##5{\relax\egroup\ignorespaces}%
%   \def\XGurafu@@@@@(##1)(##2)##3{\relax}%
    \def\@@XGurafu(##1)(##2)##3##4##5{\relax\egroup\ignorespaces}%
%   \def\BGurafu@@@@@(##1)(##2)##3##4##5##6{\relax}%
    \def\@B@Gurafu(##1)(##2)##3##4##5##6{\relax\egroup\ignorespaces}%
    \def\EMpscolor##1{\relax\ignorespaces}%
    \def\endEMpscolor{\relax\ignorespaces}%
    \def\open@nuri{\relax\ignorespaces}%
    \def\@ParamC<##1>##2##3{\relax}%
    \def\@iiiParamC<##1>##2##3##4{\relax}%
%
    \let\ltxqbezierto\qbezier
    \def\qbezier{\@ifnextchar[{\@qbezier}{\@qbezier[0]}}%
    \def\@qbezier[##1](##2,##3)(##4,##5)(##6,##7){\relax}%
    \def\EMpsBezier{\@ifnextchar<{\@EMpsBezier}{\@EMpsBezier<\empty>}}%
    \def\@EMpsBezier<##1>##2##3##4##5{\relax\ignorespaces}%
    \def\EMpsRBezier{\@ifnextchar<{\@EMpsRBezier}{\@EMpsRBezier<\empty>}}%
    \def\@EMpsRBezier<##1>##2##3##4##5{\relax\ignorespaces}%
    \def\emRbezier{\@ifnextchar<{\@@emRbezier}{\@@emRbezier<\empty>}}%
    \def\@@emRbezier<##1>##2##3##4{\relax\ignorespaces}%
    \def\emRbezierto{\@ifnextchar<{\@@emRbezierto}{\@@emRbezierto<\empty>}}%
    \def\@@emRbezierto<##1>##2##3{\relax\ignorespaces}%
    \def\QGraph{\@ifnextchar<{\@QGraph}{\@QGraph<\empty>}}%
    \def\@QGraph<##1>##2{\relax\ignorespaces}%
    \def\RBezierarc{\@ifnextchar<{\@RBezierarc}{\@RBezierarc<\empty>}}%
    \def\@RBezierarc<##1>##2##3##4##5##6##7{\relax\ignorespaces}%
%
    \def\@@@zahyouMemori[##1][##2]<##3>{{%
      \edef\by@perl{0}%
%      \@tempdima=\def@memori@nagasa
  \Strsep{\def@memori@nagasa}{,}\memori@nagasai\memori@nagasaii
  \uxkansan\memori@nagasai\memori@nagasaxi
  \uykansan\memori@nagasai\memori@nagasayi
  \ifx\empty\memori@nagasaii
    \let\memori@nagasaxii\memori@nagasaxi
    \let\memori@nagasayii\memori@nagasayi
    \edef\memori@nagasaxi{-\memori@nagasaxii}%
    \edef\memori@nagasayi{-\memori@nagasayii}%
  \else
    \uxkansan\memori@nagasaii\memori@nagasaxii
    \uykansan\memori@nagasaii\memori@nagasayii
  \fi
      \xdef\zM@xo{0}%
      \xdef\zM@yo{0}%
      \xdef\zM@dx{1}%
      \xdef\zM@dy{1}%
      \def\zM@sensyu{\drawline}%
      \def\zM@linethickness{\zM@linethickness@}%
      \Strchr{##3}{=}\zM@tmp
      \ifnum\zM@tmp>\z@
        \define@key{emPzM}{iro}{\def\iro@{####1}}%
        \setkeys{emPzM}{##3}%
      \else
        \def\zM@dx{##3}%
        \def\zM@dy{##3}%
      \fi
%      \ukansan\@tempdima\memori@nagasa
%      \@Div\memori@nagasa\@xscale\memori@nagasax
%      \@Div\memori@nagasa\@yscale\memori@nagasay
        \Sub\xmax\zM@xo\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dx\zM@a
        \Seisuububun\zM@a\zM@xn
        \Sub\zM@xo\xmin\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dx\zM@a
        \Seisuububun\zM@a\zM@a
        \IAdd\zM@xn\zM@a\zM@xn\Incr\zM@xn
        \Mul\zM@a\zM@dx\zM@a
        \Sub\zM@xo\zM@a\zM@x
        \Sub\ymax\zM@yo\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dy\zM@a
        \Seisuububun\zM@a\zM@yn
        \Sub\zM@yo\ymin\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dy\zM@a
        \Seisuububun\zM@a\zM@a
        \IAdd\zM@yn\zM@a\zM@yn\Incr\zM@yn
        \Mul\zM@a\zM@dy\zM@a
        \Sub\zM@yo\zM@a\zM@y
      \if m##2\relax
        \Strchr\zM@xo{.}\zM@tmpa
        \Strchr\zM@dx{.}\zM@tmpb
        \ifthenelse{\zM@tmpa=0 \and \zM@tmpb=0}{%
          \Cfor{\def\zM@x{\zM@xo}}{\lengthtest{\zM@x pt<\xmax pt}}{%
          \IAdd\zM@dx\zM@x\zM@x}\do{%
            \ifnum\zM@x=\z@\else\emathPut{(\zM@x,0)}[s]{\zM@x}\fi}%
          \Cfor{\def\zM@x{\zM@xo}\ISub\zM@x\zM@dx\zM@x}{%
          \lengthtest{\zM@x pt>\xmin pt}}{\ISub\zM@x\zM@dx\zM@x}\do{%
            \emathPut{(\zM@x,0)}[s]{$\zM@x$}}%
        }{%
          \Cfor{\def\zM@x{\zM@xo}}{\lengthtest{\zM@x pt<\xmax pt}}{%
          \Add\zM@dx\zM@x\zM@x}\do{%
            \emathPut{(\zM@x,0)}[s]{\zM@x}}%
          \Cfor{\def\zM@x{\zM@xo}\Sub\zM@x\zM@dx\zM@x}{%
          \lengthtest{\zM@x pt>\xmin pt}}{\Sub\zM@x\zM@dx\zM@x}\do{%
            \emathPut{(\zM@x,0)}[s]{$\zM@x$}}%
        }%
        \Strchr\zM@yo{.}\zM@tmpa
        \Strchr\zM@dy{.}\zM@tmpb
        \ifthenelse{\zM@tmpa=0 \and \zM@tmpb=0}{%
          \Cfor{\def\zM@y{\zM@yo}\ISub\zM@y\zM@dy\zM@y}{%
          \lengthtest{\zM@y pt>\ymin pt}}{\ISub\zM@y\zM@dy\zM@y}\do{%
            \emathPut{(0,\zM@y)}[w]{$\zM@y$}}%
          \Cfor{\edef\zM@y{\zM@yo}}{\lengthtest{\zM@y pt<\ymax pt}}{%
          \IAdd\zM@dy\zM@y\zM@y}\do{%
            \ifnum\zM@y=\z@\else\emathPut{(0,\zM@y)}[w]{\zM@y}\fi}%
        }{%
          \Cfor{\def\zM@y{\zM@yo}\Sub\zM@y\zM@dy\zM@y}{%
          \lengthtest{\zM@y pt>\ymin pt}}{\Sub\zM@y\zM@dy\zM@y}\do{%
            \emathPut{(0,\zM@y)}[w]{$\zM@y$}}%
          \Cfor{\edef\zM@y{\zM@yo}}{\lengthtest{\zM@y pt<\ymax pt}}{%
          \Add\zM@dy\zM@y\zM@y}\do{%
            \emathPut{(0,\zM@y)}[w]{\zM@y}}%
        }%
      \fi
    }}%
%
    \def\EPSkaiten##1{\@ifnextchar[{\@EPSkaiten{##1}}{\@EPSkaiten{##1}[1]}}%
    \def\@EPSkaiten##1[##2]{\@ifnextchar[{\@@EPSkaiten{##1}[##2]}{\@@EPSkaiten{##1}[##2][1]}}%
    \def\@@EPSkaiten##1[##2][##3]##4##5{\relax}%
    \def\endEPSkaiten{\relax}%
%
    \def\sentaisyou##1##2##3{\relax}%
%
    \def\EPSkakudai##1##2##3{\relax}%
%
    \def\EPShenkan##1##2##3##4##5##6{\relax}%
%
    \def\@@kaitenkigou<##1>[##2]{\relax}%
%
% arcto
%
\def\psarcto##1##2##3{\relax}%
\def\psarc##1##2##3##4{\relax}%
\def\pscurveto##1##2##3{\relax}%
\def\psmoveto##1{\relax}%
\def\pslineto##1{\relax}%
\def\psLineto##1{\relax}%
\def\psnewpath{\relax}%
\def\psclosepath{\relax}%
\def\psclip{\relax}%
\def\psstroke{\relax}%
\def\pssetgray##1{\relax}%
\def\psfill{\@ifstar{\psfill@}{\@psfill}}%
\def\@psfill{\@ifnextchar[{\@@psfill}{\@@psfill[.5]}}%
\def\@@psfill[##1]{\@ifnextchar<{\@@@psfill[##1]}{\@@@psfill[##1]<\empty>}}%
\def\@@@psfill[##1]<##2>{\relax}%
\def\psfill@{\@ifnextchar[{\psfill@@}{\psfill@@[45]}}%
\def\psfill@@[##1]{\@ifnextchar<{\psfill@@@[##1]}{\psfill@@@[##1]<\empty>}}%
\def\psfill@@@[##1]<##2>{\relax}%
\def\psarcbox{\@ifundefined{nuri@grayscale}{\@psarcbox}{\psarcboxfil}}%
\def\@psarcbox##1##2##3##4##5{\relax}%
\def\psarcboxfil##1##2##3##4##5{\relax}%
\def\Yaziri{\def\Yaziri@sironuri{0}\xdef\yaziri@@@M{\O}\@ifstar{\Yaziri@}{\@Yaziri}}%
\def\Yaziri@{\def\Yaziri@sironuri{1}\@Yaziri}%
\def\@Yaziri{\@ifnextchar<{\@@Yaziri}{\@@Yaziri<\empty>}}%
\def\@@Yaziri<##1>##2##3{\relax}%
\def\kYaziri##1##2{\relax}%
\def\yaziri##1{\relax}%
\def\@EMbane<##1>##2##3##4##5{\relax}%
\def\EMpsKinziB##1{\relax}%
\def\EMpsKinziC##1{\relax}%
\def\clipQfunc{\@ifnextchar<{\@clipQfunc}{\@clipQfunc<\empty>}}%
\def\@clipQfunc<##1>##2{\relax}%
\def\endclipQfunc{%
  \endclipTakakkei
}%
\def\clipLfunc{\@ifnextchar<{\@clipLfunc}{\@clipLfunc<\empty>}}%
\def\@clipLfunc<##1>##2{\relax}%
\def\endclipLfunc{\endclipLline}%
\def\clipXGraph{\@ifnextchar<{\@clipXGraph}{\@clipXGraph<\empty>}}%
\def\@clipXGraph<##1>##2{\relax}%
\def\endclipXGraph{%
  \endclipTakakkei
}%
\let\clipXfunc\clipXGraph
\let\endclipXfunc\endclipXGraph
%
\def\clipYoresen{\@ifnextchar<{\@clipYoresen}{\@clipYoresen<\empty>}}%
\def\@clipYoresen<##1>##2{\relax}%
\def\endclipYoresen{%
  \endclipTakakkei
}%
%
\def\clipYGraph{\@ifnextchar<{\@clipYGraph}{\@clipYGraph<\empty>}}%
\def\@clipYGraph<##1>##2{\relax}%
\def\endclipYGraph{%
  \endclipTakakkei
}%
\def\clipYfunc{\@ifnextchar<{\@clipYfunc}{\@clipYfunc<\empty>}}%
\def\@clipYfunc<##1>##2{\relax}%
\def\endclipYfunc{%
  \endclipTakakkei
}%
%
\ignorespaces
    \ifinclude@eps
      \@ifundefined{by@pdf}{%
        \put(\EMps@x@include,\EMps@y@include){%
          \includegraphics[clip=\EMps@clip]{\EMps@filename}}%
      }{%
        \getflext{\EMps@filename}\EMps@node\EMps@ext
        \edef\EMps@pdffl{\EMps@node.pdf}%
\ifnum\by@pdf>\z@
  \fc@eps@pdf{\EMps@node}\fc@ans
%\typeout{fc@ans=\fc@ans}%
  \ifnum\fc@ans>\z@
%  \mtime{\EMps@filename}\tm@eps
%  \mtime{\EMps@pdffl}\tm@pdf
%  \ifnum\tm@pdf<\tm@eps
%    \unlink{\EMps@node.xbb}%
    \EM@system{repstopdf \EMps@filename}%
  \fi
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        \put(\EMps@x@include,\EMps@y@include){%
          \includegraphics[clip=\EMps@clip]{\EMps@pdffl}}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% pdf を読み込むための .xbb ファイルが自動生成されない環境では
% 上の2行を次の2行で置き換える (BBS #8826)。
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \put(\EMps@x@include,\EMps@y@include){%
%   \includegraphics[clip=\EMps@clip,type=eps,ext=.pdf,read=.eps]{\EMps@node}}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      }%
      \@ifundefined{EMBBox}{}{%
        \expandafter\xdef\csname \EMps@filename initBBox\endcsname{\EMBBox}%
      }%
      \include@epsfalse
    \fi
  }{%
%
%
%
% as \EMps@mode=1
%
\@ifundefined{ps@debug}{%
    \ifthenelse{\remake@eps=1}{%
      \ifinclude@eps
        \IfFileExists{\EMps@filename}{%
%\openin\pl@in=\EMps@filename
%\read\pl@in to\@resen
%\ifeof\pl@in
%\errmessage{incorrect EPSfile : \EMps@filename}%
%\fi
%\immediate\closein\pl@in
          \put(\EMps@x@include,\EMps@y@include){%
            \includegraphics[clip=\EMps@clip]{\EMps@filename}}%
          \expandafter\xdef\csname \EMps@filename initBBox\endcsname{\EMBBox}%
          \include@epsfalse
        }{}%
      \fi
    }{}%
}{}%
    \def\writeEPS##1{\immediate\write\EMps@out{##1}}%
    \def\pushGP{%\bgroup%                                 2005/02/20
        \immediate\write\EMps@out{gsave}}%
    \def\popGP{\immediate\write\EMps@out{grestore}%
%      \egroup
    }%
    \let\gsave\pushGP
    \let\grestore\popGP
    \def\setlinewidth##1{%
%      \@wholewidth ##1\relax \@halfwidth .5\@wholewidth
      \upszkansan{##1}\cur@linewidth
        \@Div\cur@linewidth{10}\cur@linewidth@
        \@wholewidth\cur@linewidth@\p@
        \@halfwidth=.5\@wholewidth
      \@Div\cur@linewidth{2}\cur@halflinewidth
      \immediate\write\EMps@out{\cur@linewidth\space setlinewidth}}%
    \let\linethickness\setlinewidth
    \def\setlinecap##1{\edef\cur@linecap{##1}%
      \immediate\write\EMps@out{##1 setlinecap}}%
    \def\setlinejoin##1{\edef\cur@linejoin{##1}%
      \immediate\write\EMps@out{##1 setlinejoin}}%
    \def\byouga{%
       \if s\byouga@dousa\immediate\write\EMps@out{stroke}\else
       \if f\byouga@dousa
          \ifthenelse{\equal\iro@\empty}{%
            \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
          }{%
          }%
          \immediate\write\EMps@out{fill}%
       \else
       \if F\byouga@dousa
          \immediate\write\EMps@out{gsave}%
          \ifthenelse{\equal\nuri@iro\empty}{%
            \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
          }{%
            \EMpsIrositei{\nuri@iro}%
          }%
          \immediate\write\EMps@out{fill\space grestore \space closepath \space stroke}%
       \else
       \if c\byouga@dousa
          \immediate\write\EMps@out{closepath \space stroke}%
       \else
       \if l\byouga@dousa
          \immediate\write\EMps@out{closepath \space clip}%
       \fi\fi\fi\fi\fi
    }%
%    \def\@@Ensyuu##1##2{%
%      \Strchr{##2}{=}\@@Ensyuu@tmp
%      \ifnum\@@Ensyuu@tmp>\z@
%        \edef\@tyuusin{##1}\relax
%        \setkeys{emP}{##2}%
%      \else
%        \edef\@hankei{##2}%
%      \fi
%      \xytops{##1}\@@x\@@y
%      \ltops{\@hankei}\@@r
%      \immediate\write\EMps@out{newpath}%
%      \ifthenelse{\equal{\iro@}{\empty}}{%
%        \immediate\write\EMps@out{%
%          \@@x\space\@@y\space\@@r\space 0 360 arc stroke}%
%      }{%
%        \begin{EMpscolor}{\iro@}%
%          \immediate\write\EMps@out{%
%            \@@x\space\@@y\space\@@r\space 0 360 arc stroke}%
%        \end{EMpscolor}%
%      }%
%    }%
%
    \def\@@Ensyuu##1##2{%
\ifEMpscontinue\else\gsave\fi
      \Strchr{##2}{=}\@@Ensyuu@tmp
      \ifnum\@@Ensyuu@tmp>\z@
        \EMedef\@tyuusin{##1}\relax
        \setkeys{emP}{##2}%
      \else
\ukansan{##2}\@hankei
%        \edef\@hankei{##2}%
      \fi
  \ifx\empty\set@xyrange\else
    \vecXY\@tyuusin\G@x\G@y
    \Add\G@x\@hankei\x@R
    \Sub\G@x\@hankei\x@L
    \Add\G@y\@hankei\y@T
    \Sub\G@y\@hankei\y@B
    \EMwriteLabel{\set@xyrange-xL}{\x@L}%
    \EMwriteLabel{\set@xyrange-xR}{\x@R}%
    \EMwriteLabel{\set@xyrange-yT}{\y@T}%
    \EMwriteLabel{\set@xyrange-yB}{\y@B}%
    \edef\set@xyrange{\empty}%
  \fi
      \xytops{##1}\@@x\@@y
      \ltops{\@hankei}\@@r
      \ifEMpscontinue
        \def\byouga@dousa{p}%
        \edef\EMps@newpath{0}%
      \else
        \def\byouga@dousa{s}%
        \edef\EMps@newpath{1}%
      \fi
      \ifnum\EMps@newpath=\z@\else\immediate\write\EMps@out{newpath}\fi
      \ifthenelse{\equal{\iro@}{\empty}}{%
        \immediate\write\EMps@out{%
          \@@x\space\@@y\space\@@r\space 0 360\space \byouga@arc}%
        \byouga
      }{%
        \begin{EMpscolor}{\iro@}%
          \immediate\write\EMps@out{%
            \@@x\space\@@y\space\@@r\space 0 360\space \byouga@arc}%
          \byouga
        \end{EMpscolor}%
      }%
\ifEMpscontinue\else\grestore\fi
    }%
%
    \def\@Daen{\bgroup\gsave\@ifnextchar<{\@@psDaen}{\@psDaen}}%
    \def\@@psDaen<##1>{\setkeys{emPs}{##1}\@psDaen}%
    \def\@psDaen##1##2##3{%
      \xytops{##1}\@@x\@@y
      \ltops{##2}\@@l
      \ltops{##3}\@@m
      \immediate\write\EMps@out{newpath}%
      \ifthenelse{\equal\iro@\empty}{}{%
%          \immediate\write\EMps@out{%
%            \csname EMps@\iro@\endcsname\space \EMsetcolor}%
        \EMpsIrositei{\iro@}%
      }%
      \immediate\write\EMps@out{%
        \@@x\space\@@y\space\@@l\space\@@m\space 0 360 ellipse stroke}%
      \grestore\egroup
    }%
    \def\@Daen@[##1]##2##3##4{{\gsave
      \edef\draw@border{\empty}%
      \def\noudo@{.5}%
      \def\nuri@iro{\nuri@iro@}%
      \Strchr{##1}{=}\nuri@iro@tmp
      \ifnum\nuri@iro@tmp>\z@\setkeys{emP}{##1}\else\edef\noudo@{##1}\fi
      \Sub{1}\noudo@\nuri@grayscale
      \xytops{##2}\@@x\@@y
      \ltops{##3}\@@l
      \ltops{##4}\@@m
      \ifthenelse{\equal\nuri@iro\empty}{%
        \immediate\write\EMps@out{newpath}%
        \immediate\write\EMps@out{gsave}%
        \ifthenelse{\equal\iro@\empty}{}{%
          \EMpsIrositei{\iro@}%
        }%
        \immediate\write\EMps@out{%
          \@@x\space\@@y\space\@@l\space\@@m\space 0 360 ellipse}%
        \immediate\write\EMps@out{gsave}%
        \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
        \immediate\write\EMps@out{fill}%
        \immediate\write\EMps@out{grestore}%
        \ifthenelse{\equal\draw@border\empty}{}{%
          \immediate\write\EMps@out{stroke}%
        }%
        \immediate\write\EMps@out{grestore}%
      }{%
        \immediate\write\EMps@out{newpath}%
        \immediate\write\EMps@out{%
          \@@x\space\@@y\space\@@l\space\@@m\space 0 360 ellipse}%
        \immediate\write\EMps@out{gsave}%
        \EMpsIrositei{\nuri@iro}%
        \immediate\write\EMps@out{gsave}%
        \immediate\write\EMps@out{fill}%
        \immediate\write\EMps@out{grestore}%
        \ifthenelse{\equal\draw@border\empty}{}{%
          \ifthenelse{\equal\iro@\empty}{}{\EMpsIrositei{\iro@}}%
          \immediate\write\EMps@out{stroke}%
        }%
        \immediate\write\EMps@out{grestore}%
      }%
    \grestore}}%
%
    \def\@@@Daenko[##1][##2]##3##4##5##6{%
%     \edef\@tyuusin{\local@origin}%
      \def\@tyuusin{(0,0)}%
      \ifthenelse{\equal\iro@\empty}{}{%
%          \immediate\write\EMps@out{%
%            \csname EMps@\iro@\endcsname\space \EMsetcolor}%
        \EMpsIrositei{\iro@}%
      }%
      \ifthenelse{\equal{##1}{\empty}}%
      {%
        \xytops{\@tyuusin}\@@x\@@y
        \ltops{##3}\@@l
        \ltops{##4}\@@m
\def\hazime@kaku{##5}%
\def\owari@kaku{##6}%
\ifthenelse{\equal\yazirusi@opt{a}\or\equal\yazirusi@opt{b}}{%
\def\Daenko@tmp{\Arrowhead@L}%
\Mul\Daenko@tmp{9.99}\Daenko@tmp
\@Div\Daenko@tmp\@@l\Daenko@tmp
\RadDeg\Daenko@tmp\Daenko@tmp
\Sub\owari@kaku\Daenko@tmp\owari@kaku@
}{\def\owari@kaku@{\owari@kaku}}%
\ifthenelse{\equal\yazirusi@opt{b}\or\equal\yazirusi@opt{r}}{%
\def\Daenko@tmp{\Arrowhead@L}%
\Mul\Daenko@tmp{9.99}\Daenko@tmp
\@Div\Daenko@tmp\@@l\Daenko@tmp
\RadDeg\Daenko@tmp\Daenko@tmp
\Add\hazime@kaku\Daenko@tmp\hazime@kaku@
}{\def\hazime@kaku@{\hazime@kaku}}%
        \immediate\write\EMps@out{newpath}%
        \immediate\write\EMps@out{%
            \@@x\space\@@y\space\@@l\space\@@m\space
            \hazime@kaku@\space\owari@kaku@\space ellipse stroke}%
      }{%\else
        \edef\@hazimekaku{##5}\edef\@owarikaku{##6}%
        \DegRad{\@hazimekaku}{\@hazimekaku}\DegRad{\@owarikaku}{\@owarikaku}%
        \edef\@x{##3}\edef\@y{##4}%
        \Mul{##2}{0.18}\@dx\Mul{##1}{0.1}\@lx
        \For\@t{\@hazimekaku}{\@owarikaku}{\@dx}\Do{\Add\@t{\@lx}\@@t%
          \ifthenelse{\lengthtest{\@@t pt>\@owarikaku pt}}{%
            \edef\@@t{\@owarikaku}}{}%
          \Cos\@t\@xi\Mul\@x\@xi\@xi\Cos\@@t\@xii\Mul\@x\@xii\@xii%
          \Sin\@t\@yi\Mul\@y\@yi\@yi\Sin\@@t\@yii\Mul\@y\@yii\@yii%
          \drawline(\@xi,\@yi)(\@xii,\@yii)}%
      }%
      \ifthenelse{\equal\yazirusi@opt{a}\or\equal\yazirusi@opt{b}}{%
        \DegCos{##6}\@@x\Mul{##3}\@@x\@@x
        \DegSin{##6}\@@y\Mul{##4}\@@y\@@y
        \Addvec{\@tyuusin}{(\@@x,\@@y)}\@@P
        \@Div{5}{\strip@pt\unitlength}\@@L
        \@Div\@@L{##3}\d@@theta
        \Mul{60}\d@@theta\d@@theta
        \Sub{##6}\d@@theta\@@angle
        \DegCos{\@@angle}\@@x\Mul{##3}\@@x\@@x
        \DegSin{\@@angle}\@@y\Mul{##4}\@@y\@@y
        \Addvec{\@tyuusin}{(\@@x,\@@y)}\@@Q
        \Subvec\@@P\@@Q\@@PQ
        \Yaziri\@@P\@@PQ%
      }{}%
      \ifthenelse{\equal\yazirusi@opt{r}\or\equal\yazirusi@opt{b}}{%
        \DegCos{##5}\@@x\Mul{##3}\@@x\@@x
        \DegSin{##5}\@@y\Mul{##4}\@@y\@@y
        \Addvec{\@tyuusin}{(\@@x,\@@y)}\@@P
        \@Div{5}{\strip@pt\unitlength}\@@L
        \@Div\@@L{##3}\d@@theta
        \Mul{60}\d@@theta\d@@theta
        \Add{##5}\d@@theta\@@angle
        \DegCos{\@@angle}\@@x\Mul{##3}\@@x\@@x
        \DegSin{\@@angle}\@@y\Mul{##4}\@@y\@@y
        \Addvec{\@tyuusin}{(\@@x,\@@y)}\@@Q
        \Subvec\@@P\@@Q\@@PQ
        \Yaziri\@@P\@@PQ%
      }{}%
\egroup
      \grestore
    }%
%
    \def\setd@sh{\protect\@setd@sh}%
    \def\@setd@sh{\@ifnextchar[{\@@setd@sh}{\@@setd@sh[0]}}%
    \def\@@setd@sh[##1]##2{%
      \ifthenelse{\equal{##2}\empty}{%
        \edef\cur@dash{}\edef\cur@dashoffset{0}%
        \immediate\write\EMps@out{[] 0 setdash}%
      }{%
% else
        \edef\cur@dash{##2}\edef\cur@dashoffset{##1}%
        \edef\setd@sh@tmp{}%
        \expandafter\@for\expandafter\@@c\expandafter:\expandafter=##2\do{%
          \ltops\@@c\@@@c
          \ifthenelse{\equal\setd@sh@tmp\empty}{\edef\setd@sh@tmp{\@@@c}}{%
            \edefappend\setd@sh@tmp{\space\@@@c}}%
        }%
        \ltops{##1}\setdash@offset
        \immediate\write\EMps@out{%
          [\setd@sh@tmp] \setdash@offset\space setdash}%
      }%
    }%
%
    \def\grad@Enban##1##2{%
      \@Div{##2}\grad@N\delta@r
      \def\r@val{##2}%
      \ISub\grad@N{1}\grad@Nmi
      \Ifor\rb@i{0}{\grad@N}\Do{%
        \@Div\rb@i\grad@Nmi\rb@tmp
        \@ifundefined{grad@F}{%
        }{%
          \funcval\grad@F\rb@tmp\rb@tmp
        }%
        \EMmixcolor{\grad@begin}{\grad@end}{*}{\rb@tmp}{tmp@color}
        \En*<nuriiro=tmp@color>{##1}\r@val
        \Subself\r@val\delta@r
      }%
      \if 0\draw@border\else\En{##1}{##2}\fi
    }%
%
    \def\@@Enban[##1]<##2>##3##4{{%
      \def\grad@N{0}%
      \define@key{emP}{Cdilutecolor}{%
        \Rdef####1\eb@dC
        \Addvec{##3}\eb@dC\C@dilutecolor
      }%
      \edef\draw@border{\empty}%
      \def\noudo@{.5}%
      \def\nuri@iro{\nuri@iro@}%
      \def\dilute@color{1}%
      \edef\N@dilutecolor{10}%
      \edef\C@dilutecolor{##3}%
      \edef\r@dilutecolor{##4}%
      \Strchr{##1}{=}\nuri@iro@tmp
      \ifnum\nuri@iro@tmp>\z@\setkeys{emP}{##1}\else\edef\noudo@{##1}\fi
      \ifx\empty##2\else\setkeys{emP}{##2}\fi
\ifthenelse{\grad@N>\z@}{\grad@Enban{##3}{##4}}{%
      \ifthenelse{\equal{\draw@border}{y}}{\edef\draw@border{1}}{}%
      \ifx\empty\iro@\else\edef\draw@border{1}\fi
      \ifdim\noudo@\p@=\z@
        \edef\nuri@iro{\EM@white}%
        \ifx\empty\draw@border\edef\draw@border{1}\fi
      \fi
      \ifx\empty\draw@border\else
        \ifdim\draw@border pt=\z@\edef\draw@border{\empty}\fi
      \fi
      \Sub{1}\noudo@\nuri@grayscale
      \xytops{##3}\@@x\@@y
      \ltops{##4}\@@r
      \ifthenelse{\equal\nuri@iro\empty}{%
        \immediate\write\EMps@out{newpath}%
        \immediate\write\EMps@out{gsave}%
        \ifthenelse{\equal\iro@\empty}{}{%
          \EMpsIrositei{\iro@}%
        }%
        \immediate\write\EMps@out{%
          \@@x\space\@@y\space\@@r\space 0 360 arc}%
        \immediate\write\EMps@out{gsave}%
        \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
        \immediate\write\EMps@out{fill}%
        \immediate\write\EMps@out{grestore}%
        \ifthenelse{\equal\draw@border\empty}{}{%
          \immediate\write\EMps@out{stroke}%
        }%
        \immediate\write\EMps@out{grestore}%
      }{%
        \immediate\write\EMps@out{newpath}%
        \immediate\write\EMps@out{gsave}%
        \ifthenelse{\equal\iro@\empty}{}{%
          \EMpsIrositei{\iro@}%
        }%
        \immediate\write\EMps@out{\@@x\space\@@y\space\@@r\space 0 360 arc}%
        \immediate\write\EMps@out{gsave}%
        \ifdim\dilute@color\p@=\z@
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
          \psclip
          \EMdilutecolor*{\nuri@iro}{0}{tmpcolor}%
          \Enban<nuriiro=tmpcolor>{##3}{##4}%
          \edef\eb@hankei{\r@dilutecolor}%
          \@Div\r@dilutecolor\N@dilutecolor\eb@dr
          \Ifor\eb@i{0}{\N@dilutecolor}\Do{%
            \@Div\eb@i\N@dilutecolor\eb@c
            \EMdilutecolor*{\nuri@iro}\eb@c{tmpcolor}%
            \Enban<nuriiro=tmpcolor>\C@dilutecolor\eb@hankei
            \Subself\eb@hankei\eb@dr
          }%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        \else
          \ifdim\dilute@color\p@<\p@
            \EMdilutecolor{\nuri@iro}\dilute@color{tmpcolor}\edef\nuri@iro{tmpcolor}%
          \fi
          \EMpsIrositei{\nuri@iro}%
          \immediate\write\EMps@out{fill}%
        \fi
        \immediate\write\EMps@out{grestore}%
        \ifthenelse{\equal\draw@border\empty}{}{%
          \ifx\empty\iro@\else\EMpsIrositei{\iro@}\fi
          \immediate\write\EMps@out{stroke}%
        }%
        \immediate\write\EMps@out{grestore}%
      }%
}%
    }}%
%
\def\@@@Hatch@Circle[##1]<##2>(##3)##4##5{%
  \edef\@tyuusin{##4}\relax
  \Strchr{##5}{=}\@@Ensyuu@tmp
  \ifnum\@@Ensyuu@tmp>\z@
    \setkeys{emP}{##5}%
  \else
    \edef\@hankei{##5}%
  \fi
%  \Hatchpolygon[##1]<##2>\@resen
\begin{clipEn}\@tyuusin\@hankei
  \ifx\empty ##2
    \Strchr{##1}{=}\@@Ensyuu@tmp
    \ifnum\@@Ensyuu@tmp>\z@
      \emPaint*<slashangle=##1>\zenheimen
    \else
      \emPaint*<slashangle=##1>\zenheimen
%      \linethickness{\slash@thickness}%
%      \Hatchpolygon[##1]<##2>\zenheimen
    \fi
  \else
    \setkeys{emP}{##2}%
%    \Strchr{##2}{=}\@@Ensyuu@tmp
%    \ifnum\@@Ensyuu@tmp>\z@
      \emPaint*<slashangle=##1,##2>\zenheimen
%    \else
%      \linethickness{\slash@thickness}%
%      \Hatchpolygon[##1]<##2>\zenheimen
%    \fi
  \fi
  \ifx\empty\draw@border\else\En\@tyuusin\@hankei\fi
\end{clipEn}
}%
%
%    \def\yclipDrawline##1{%
%      \ifthenelse{\equal{##1}{\par}}{\relax}{\Drawline{##1}}}%
%    \def\xclipDrawline##1{%
%      \ifthenelse{\equal{##1}{\par}}{\relax}{\Drawline{##1}}}%
%    \def\clipDrawline##1{%
%      \ifthenelse{\equal{##1}{\par}}{\relax}{\Drawline{##1}}}%
    \def\drawline(##1,##2){%
      \xytops{(##1,##2)}\@@x\@@y
      \ifnum\EMps@newpath=\z@
%        \immediate\write\EMps@out{\@@x\space\@@y\space moveto}%
      \else
        \immediate\write\EMps@out{newpath\space\@@x\space\@@y\space moveto}%
      \fi
      \@ifnextchar({\@drawline}{\drawline@}%
    }%
    \def\@drawline(##1,##2){%
      \xytops{(##1,##2)}\@@x\@@y
%\typeout{xytops (##1,##2)-->(\@@x,\@@y)}%
      \immediate\write\EMps@out{\@@x\space\@@y\space lineto}%
      \@ifnextchar({\@drawline}{\drawline@}%
    }%
    \def\drawline@{%
      \byouga
    }%
%    \def\Takakkei{\@ifnextchar<{\@Takakkei}{\@Takakkei<\empty>}}%
%    \def\@Takakkei<##1>##2{{%
%      \def\drawline@{%
%        \immediate\write\EMps@out{closepath stroke}%
%      }%
%      \Drawline<##1>{##2}%
%    }}%
%
\edef\nest@clip{0}%
\edef\YG@migiT{\empty}%
\edef\YG@hidariT{\empty}%
\define@key{emPs}{migiT}[migiT]{\def\YG@migiT{##1}}%
\define@key{emPs}{hidariT}[hidariT]{\def\YG@hidariT{##1}}%
\define@key{emPs}{ueT}[ueT]{\def\YG@migiT{##1}}%
\define@key{emPs}{sitaT}[sitaT]{\def\YG@hidariT{##1}}%
\def\clipborder{\@ifnextchar[{\@clipborder}{\@clipborder[\empty]}}%
\def\@clipborder[##1]{%
  \@ifnextchar<{\@@clipborder[##1]}{\@@clipborder[##1]<\empty>}}%
\def\@@clipborder[##1]<##2>{\@ifnextchar\bgroup{\@@@clipborder[##1]<##2>}{%
  \@@@clipborder[##1]<##2>{}}}%
%\def\@@@clipborder[##1]<##2>(##3){%
\def\@@@clipborder[##1]<##2>##3{%
  \ifnum\remake@eps=\z@
    \errmessage{cannot use clipborder with noremake-option for emathPs}
  \fi
  \ifthenelse{\equal{##3}\empty}{%
    \edef\cb@tmp{\clip@lni}%
  }{%
    \edef\cb@tmp{\csname clip@ln@\prelabel ##3\endcsname}%
  }%
  \edef\YG@migiT{\empty}%
  \edef\YG@hidariT{\empty}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \Drawline<##2>\cb@tmp
  \ifthenelse{\equal\YG@hidariT\empty \and \equal\YG@migiT\empty}{}{%
%          \Strsep\cb@tmp{)(}\cb@a\cb@b
          \expandafter\makeTenHairetu\cb@tmp
          \edef\cb@a{\hairetu{TH@V}{1}}%
          \edef\cb@b{\hairetu{TH@V}{\TH@N}}%
%          \vecXY\cb@a\cb@ax\cb@ay
%          \vecXY\cb@b\cb@bx\cb@by
%          \ifdim\cb@ax\p@<\cb@bx\p@\else\swap\cb@a\cb@b\fi
          \expandafter\edef\csname\YG@hidariT\endcsname{\cb@a}%
          \expandafter\edef\csname\YG@migiT\endcsname{\cb@b}%
  }%
\ignorespaces
}%
%
\def\clipborders{\@ifnextchar[{\@clipborders}{\@clipborders[\empty]}}%
\def\@clipborders[##1]{%
  \@ifnextchar<{\@@clipborders[##1]}{\@@clipborders[##1]<\empty>}}%
\def\@@clipborders[##1]<##2>##3{%
  \@for\cbs@l:=##3\do{\@@@clipborder[##1]<##2>{\cbs@l}}%
}%
%
\def\Takakkei{\@ifnextchar<{\@Takakkei}{\@Takakkei<\empty>}}%
\def\@Takakkei<##1>##2{{%
  \edef\nuri@iro{\empty}%
  \def\byouga@dousa{c}%
  \edef\yazirusi@opt{\empty}%
  \edef\oval@r{0}%
\ifEMpscontinue\def\byouga@dousa{p}\edef\EMps@newpath{0}\else\gsave\fi
  \edef\oresen@i{##2}%
  \ifx \empty ##1\relax
    \@@Takakkei<##1>{##2}%
  \else
    \setkeys{emPs}{##1}%
    \@ifundefined{boutyou@size}{}{%
      \boutyou{##2}\boutyou@size\oresen@i
    }%
\exfor[;]\oresen@i:=\oresen@i\do{%
    \ifdim\oval@r\p@=\z@
      \ifx\sensyu\drawline
        \@@Takakkei<##1>{\oresen@i}%
      \else
        \strsep{\oresen@i}{)}\Takakkei@a\Takakkei@b
        \Drawline{\oresen@i\Takakkei@a)}%
      \fi
    \else
      \ifx\empty\iro@
        \@psovalPolygon{\oresen@i}{\oval@r}%
      \else
        \begin{EMpscolor}{\iro@}%
          \@psovalPolygon{\oresen@i}{\oval@r}%
        \end{EMpscolor}%
      \fi
    \fi
}%
  \fi
\ifEMpscontinue\else\grestore\fi
  }}%
\def\@@Takakkei<##1>##2{%
  \def\drawline@{%
    \psclosepath
\@ifundefined{nuri@iro}{}{%
  \ifx\empty\nuri@iro\else
    \edef\nuri@iro@{\nuri@iro}%
    \gsave
      \begin{EMpsIrositei}{\nuri@iro@}%
        \psfill
      \end{EMpsIrositei}
    \grestore
  \fi
}%
    \byouga
%    \immediate\write\EMps@out{closepath stroke}%
  }%
  \@psDrawline<##1>{##2}%
}%
    \let\sensyu=\drawline
    \def\arrow@size{3 25 50 0}%
    \def\setarrowsize{\@ifnextchar<{\@setarrowsize}{\@setarrowsize<\ArrowHeadPit>}}%
    \def\@setarrowsize<##1>##2##3##4{%
      \upszkansan{##2}\saSize@i
      \upszkansan{##3}\saSize@ii
      \upszkansan{##4}\saSize@iii
      \setarr@wsize<##1>{\saSize@i}{\saSize@ii}{\saSize@iii}%
    }%
    \def\setarr@wsize{\@ifnextchar<{\@setarr@wsize}{\@setarr@wsize<\ArrowHeadPit>}}%
    \def\@setarr@wsize<##1>##2##3##4{%
      \ifthenelse{\equal{##2}\empty}{}{\edef\as@i{##2}}%
      \ifthenelse{\equal{##3}\empty}{}{\edef\as@ii{##3}}%
      \ifthenelse{\equal{##4}\empty}{}{\edef\as@iii{##4}}%
      \edef\ArrowHeadPit{##1}%
      \Mul\as@iii{##1}\as@hekomi
      \@Div\as@ii{10}\Arrowhead@W
      \@Div\as@iii{10}\Arrowhead@L%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2005/01/25
      \def\arrow@size{\as@i\space\as@ii\space\as@iii\space\as@hekomi}%
     }%
%
\def\clipTakakkei{\@ifnextchar<{\@clipTakakkei}{\@clipTakakkei<\empty>}}%
\def\@clipTakakkei<##1>##2{%
  \define@key{emPs}{nuri}{\edef\cT@nuri@opt{####1}}%
  \define@key{emPs}{slashthickness}{\edef\slash@thickness{####1}}%
  \gsave
  \edef\h@syugo{\empty}%
  \edef\old@iro{\iro@}%
  \edef\iro@{\empty}%
  \edef\cT@nuri@opt{null}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \edef\cT@iro{\iro@}%
  \edef\iro@{\old@iro}%
  \psnewpath
  \@ifundefined{boutyou@}{%
    \edef\clipT@tmp{##2}%
  }{%
    \boutyou{##2}\boutyou@\clipT@tmp
  }%
  \expandafter\get@orgpoint\clipT@tmp\@nil
  \psmoveto\@rgpoint
  \psLineto\clipT@tmp
  \ifx\empty\h@syugo
  \else
    \psLineto\@rgpoint
    \headchar\h@syugo\h@syugo@t\h@syugo@r
    \if -\h@syugo@t
      \ifthenelse{\equal\h@syugo@r{RB}}{%
        \EMedef\h@syugo{\RB\RT\LT\LB\RB}%
      }{%
        \ifthenelse{\equal\h@syugo@r{LB}}{%
          \EMedef\h@syugo{\LB\RB\RT\LT\LB}%
        }{%
          \ifthenelse{\equal\h@syugo@r{LT}}{%
            \EMedef\h@syugo{\LT\LB\RB\RT\LT}%
          }{%
            \ifthenelse{\equal\h@syugo@r{RT}}{%
              \EMedef\h@syugo{\RT\LT\LB\RB\RT}%
            }{%
            }%
          }%
        }%
      }%
    \else
      \ifthenelse{\equal\h@syugo{RB}}{%
        \EMedef\h@syugo{\RB\LB\LT\RT\RB}%
      }{%
        \ifthenelse{\equal\h@syugo{LB}}{%
          \EMedef\h@syugo{\LB\LT\RT\RB\LB}%
        }{%
          \ifthenelse{\equal\h@syugo{LT}}{%
            \EMedef\h@syugo{\LT\RT\RB\LB\LT}%
          }{%
            \ifthenelse{\equal\h@syugo{RT}}{%
              \EMedef\h@syugo{\RT\RB\LB\LT\RT}%
            }{%
            }%
          }%
        }%
      }%
    \fi
    \psLineto\h@syugo
  \fi
  \psclosepath
  \gsave
%  \ifx\empty\draw@border\else
%    \gsave
%%   \setlinewidth{0}%
%    \psstroke
%    \grestore
%  \fi
  \psclip
  \ifthenelse{\equal{\cT@nuri@opt}{null}}{}{%
%\typeout{nuri@opt=\cT@nuri@opt}%
    \expandafter\Nuritubusi\cT@nuri@opt{\trueYMAX\trueLB\trueRB\trueRT}%
  }%
}%
\def\endclipTakakkei{\grestore
  \ifx\empty\cT@iro\else\EMpsIrositei{\cT@iro}\fi
  \ifx\empty\draw@border\else\psstroke\fi
  \grestore
}%
%
\def\clipEn{\@ifnextchar<{\@clipEn}{\@clipEn<\empty>}}%
\def\@clipEn<##1>##2##3{\begingroup
%
  \def\hosyugo{%
    \grestore
    \ifx\empty\draw@border\else
      \En\cl@o\cl@r
    \fi
    \gsave
    \psnewpath
    \psarc{##2}{##3}{0}{360}%
    \ifx\empty\h@syugo
      \pslineto\RB
      \pslineto\LB
      \pslineto\LT
      \pslineto\RT
      \pslineto\RB
    \fi
    \psclip
  }%
%
  \edef\h@syugo{\empty}%
  \edef\cl@o{##2}%
  \edef\cl@r{##3}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \gsave
  \psnewpath
  \psarc{##2}{##3}{0}{360}%
  \ifx\empty\h@syugo\else
    \pslineto\RB
    \pslineto\LB
    \pslineto\LT
    \pslineto\RT
    \pslineto\RB
  \fi
  \psclip
}%
\def\endclipEn{%
  \grestore
  \ifx\empty\draw@border\else
    \En\cl@o\cl@r
  \fi
  \endgroup
}%
%
\def\clipDaen{\@ifnextchar<{\@clipDaen}{\@clipDaen<\empty>}}%
\def\@clipDaen<##1>##2##3##4{\begingroup
  \gsave
  \edef\h@syugo{\empty}%
  \edef\cl@o{##2}%
  \edef\cl@a{##3}%
  \edef\cl@b{##4}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \xytops{##2}\@@x\@@y
  \ltops{##3}\@@l
  \ltops{##4}\@@m
  \immediate\write\EMps@out{newpath}%
  \immediate\write\EMps@out{%
        \@@x\space\@@y\space\@@l\space\@@m\space 0 360 ellipse}%
  \ifx\empty\h@syugo\else
    \pslineto\RB
    \pslineto\LB
    \pslineto\LT
    \pslineto\RT
    \pslineto\RB
  \fi
  \psclip
}%
\def\endclipDaen{%
  \grestore
  \ifx\empty\draw@border\else
    \Daen\cl@o\cl@a\cl@b
  \fi
  \endgroup\@ignoretrue
}%
%
\def\clipSoukyokusen{%
  \@ifnextchar<{\@clipSoukyokusen}{\@clipSoukyokusen<\empty>}}%
\def\@clipSoukyokusen<##1>##2##3##4{\begingroup
  \gsave
  \edef\h@syugo{\empty}%
  \def\SK@Fy{(##3)*sqrt(Y*Y+(##4)*(##4))/(##4)}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \XLGraph<miny=\trueymin,maxy=\trueymax>\SK@Fy\oresen@i
  \XLGraph<miny=\trueymax,maxy=\trueymin>{-(\SK@Fy)}\oresen@ii
  \ifx\empty\h@syugo
    \begin{clipTakakkei}<hosyugo>{\oresen@i\oresen@ii}%
  \else
    \begin{clipTakakkei}{\oresen@i\oresen@ii}%
  \fi
}%
\def\endclipSoukyokusen{%
  \end{clipTakakkei}
  \ifx\empty\h@syugo
    \Drawlines<iro=white>{\LT\RT;\LB\RB}%
  \fi
  \grestore
  \ifx\empty\draw@border\else
  \fi
  \endgroup\@ignoretrue
}%
%
\def\clipLline{\@ifnextchar<{\@clipLline}{\@clipLline<\empty>}}%
\def\@clipLline<##1>##2##3{%
  \xIncr\nest@clip
  \edef\h@syugo{\empty}%
  \edef\clip@label{\empty}%
  \edef\EMclip@label{\empty}%
  \edef\save@by@perl@{\by@perl@}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \EMedef\@currentlabel{\nest@clip}%
%  \ifx\empty\clip@label\else\writeLabel{\clip@label}{\nest@clip}\fi
%  \ifx\empty\EMclip@label\else\writeLabel{\EMclip@label}{\nest@clip}\fi
  \Subvec{##3}{##2}\cL@tmp\vecXY\cL@tmp\cL@x\cL@y
  \Abs\cL@x\cL@absx
  \ifdim\cL@absx\p@<0.0001\p@%    鉛直
%    \@LandL{##2}{##3}\LT\RT\cL@T
%    \@LandL{##2}{##3}\LB\RB\cL@B
    \vecXY{##2}\cL@x\cL@y
    \edef\cL@T{(\cL@x,\ymax)}%
    \edef\cL@B{(\cL@x,\ymin)}%
    \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
      \cL@T\cL@B}%
    \ifx\empty\h@syugo
      \edef\cL@Takakkei{\cL@T\cL@B\RB\RT}%
    \else
      \edef\cL@Takakkei{\cL@T\cL@B\LB\LT}%
    \fi
  \else
%    \@LandL{##2}{##3}\RT\RB\cL@R\vecXY\cL@R\cL@Rx\cL@Ry
%    \@LandL{##2}{##3}\LT\LB\cL@L\vecXY\cL@L\cL@Lx\cL@Ly
    \vecXY{##2}\cL@xi\cL@yi
    \vecXY{##3}\cL@xii\cL@yii
    \Sub\xmax\cL@xi\cL@m\Sub\cL@xii\xmax\cL@n
    \Bunten{##2}{##3}\cL@m\cL@n\cL@R
    \vecXY\cL@R\cL@Rx\cL@Ry
    \Sub\xmin\cL@xi\cL@m\Sub\cL@xii\xmin\cL@n
    \Bunten{##2}{##3}\cL@m\cL@n\cL@L\vecXY\cL@L\cL@Lx\cL@Ly
    \ifdim\cL@Ry\p@>\ymax\p@
%      \@LandL{##2}{##3}\LT\RT\cL@T
      \Sub\ymax\cL@yi\cL@m\Sub\cL@yii\ymax\cL@n
      \Bunten{##2}{##3}\cL@m\cL@n\cL@T
      \ifdim\cL@Ly\p@<\ymin\p@
%        \@LandL{##2}{##3}\LB\RB\cL@B
        \Sub\ymin\cL@yi\cL@m\Sub\cL@yii\ymin\cL@n
        \Bunten{##2}{##3}\cL@m\cL@n\cL@B
        \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@B\cL@T}%
        \ifx\empty\h@syugo
          \edef\cL@Takakkei{\cL@T\LT\LB\cL@B}%
        \else
          \edef\cL@Takakkei{\cL@T\RT\RB\cL@B}%
        \fi
      \else
        \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@T\cL@L}%
        \ifx\empty\h@syugo
          \edef\cL@Takakkei{\cL@T\LT\cL@L}%
        \else
          \edef\cL@Takakkei{\cL@T\RT\RB\LB\cL@L}%
        \fi
      \fi
    \else\ifdim\cL@Ry\p@<\ymin\p@
%      \@LandL{##2}{##3}\LB\RB\cL@B
      \Sub\ymin\cL@yi\cL@m\Sub\cL@yii\ymin\cL@n
      \Bunten{##2}{##3}\cL@m\cL@n\cL@B
      \ifdim\cL@Ly\p@>\ymax\p@
%        \@LandL{##2}{##3}\LT\RT\cL@T
        \Sub\ymax\cL@yi\cL@m\Sub\cL@yii\ymax\cL@n
        \Bunten{##2}{##3}\cL@m\cL@n\cL@T
        \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@B\cL@T}%
        \ifx\empty\h@syugo
          \edef\cL@Takakkei{\cL@T\RT\RB\cL@B}%
        \else
          \edef\cL@Takakkei{\cL@T\LT\LB\cL@B}%
        \fi
      \else
        \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@L\cL@B}%
        \ifx\empty\h@syugo
          \edef\cL@Takakkei{\cL@L\LT\RT\RB\cL@B}%
        \else
          \edef\cL@Takakkei{\cL@L\LB\cL@B}%
        \fi
      \fi
    \else
      \ifdim\cL@Ly\p@>\ymax\p@
%        \@LandL{##2}{##3}\LT\RT\cL@T
        \Sub\ymax\cL@yi\cL@m\Sub\cL@yii\ymax\cL@n
        \Bunten{##2}{##3}\cL@m\cL@n\cL@T
        \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@T\cL@R}%
        \ifx\empty\h@syugo
          \edef\cL@Takakkei{\cL@T\RT\cL@R}%
        \else
          \edef\cL@Takakkei{\cL@T\LT\LB\RB\cL@R}%
        \fi
      \else\ifdim\cL@Ly\p@<\ymin\p@
%        \@LandL{##2}{##3}\LB\RB\cL@B
        \Sub\ymin\cL@yi\cL@m\Sub\cL@yii\ymin\cL@n
        \Bunten{##2}{##3}\cL@m\cL@n\cL@B
        \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@B\cL@R}%
%          \cL@R\cL@B}%
        \ifx\empty\h@syugo
          \edef\cL@Takakkei{\cL@B\LB\LT\RT\cL@R}%
        \else
          \edef\cL@Takakkei{\cL@B\RB\cL@R}%
        \fi
      \else
        \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@L\cL@R}%
        \ifx\empty\h@syugo
          \edef\cL@Takakkei{\cL@L\LT\RT\cL@R}%
        \else
          \edef\cL@Takakkei{\cL@L\LB\RB\cL@R}%
        \fi
      \fi\fi
    \fi\fi
  \fi
\ifx\empty\EMclip@label
\else
  \expandafter\xdef\csname clip@ln@\EMclip@label\endcsname{%
    \csname clip@ln\romannumeral\nest@clip\endcsname}%
\fi
  \begin{clipTakakkei}\cL@Takakkei
}%
%
\def\cliplline{\@ifnextchar<{\@cliplline}{\@cliplline<\empty>}}%
\def\@cliplline<##1>##2##3{%
  \Addvec{##2}{##3}\cL@Q
  \@clipLline<##1>{##2}\cL@Q
}%
\def\clipkline{\@ifnextchar<{\@clipkline}{\@clipkline<\empty>}}%
\def\@clipkline<##1>##2##3{%
  \DegCos{##3}\kl@c
  \DegSin{##3}\kl@s
  \Addvec{##2}{(\kl@c,\kl@s)}\cL@Q
  \@clipLline<##1>{##2}\cL@Q
}%
\def\clipgline{\@ifnextchar<{\@clipgline}{\@clipgline<\empty>}}%
\def\@clipgline<##1>##2##3{%
  \Addvec{##2}{(1,##3)}\cL@Q
  \@clipLline<##1>{##2}\cL@Q
}%
%
\def\clipabcline{\@ifnextchar<{\@clipabcline}{\@clipabcline<\empty>}}%
\def\@clipabcline<##1>##2{%
% ##2=a,b,c
  \vecXYZ{(##2)}\abcln@a\abcln@b\abcln@c
  \perlteisuuretu{abcln@a=\abcln@a;abcln@b=\abcln@b;abcln@c=\abcln@c}%
  \ifdim \abcln@b\p@=\z@
    \@Div\abcln@c\abcln@a\abcln@x
    \Mulself\abcln@x{-1}%
    \clipkline<##1>{(\abcln@x,0)}{90}%
  \else
    \@Div\abcln@a\abcln@b\abcln@m
    \@Div\abcln@c\abcln@b\abcln@n
    \Mulself\abcln@m{-1}%
    \Mulself\abcln@n{-1}%
    \clipgline<##1>{(0,\abcln@n)}\abcln@m
  \fi
}%
\expandafter\def\csname clipabcline+\endcsname##1{% 正領域
  \vecXYZ{(##1)}\abcln@a\abcln@b\abcln@c
  \perlteisuuretu{abcln@a=\abcln@a;abcln@b=\abcln@b;abcln@c=\abcln@c}%
  \ifdim \abcln@b\p@=\z@
    \@Div\abcln@c\abcln@a\abcln@x
    \Mulself\abcln@x{-1}%
    \ifdim\abcln@a\p@>\z@
      \clipkline{(\abcln@x,0)}{90}%
    \else
      \clipkline<hosyugo>{(\abcln@x,0)}{90}%
    \fi
  \else
    \@Div\abcln@a\abcln@b\abcln@m
    \@Div\abcln@c\abcln@b\abcln@n
    \Mulself\abcln@m{-1}%
    \Mulself\abcln@n{-1}%
    \ifdim\abcln@b\p@>\z@
      \clipgline{(0,\abcln@n)}\abcln@m
    \else
      \clipgline<hosyugo>{(0,\abcln@n)}\abcln@m
    \fi
  \fi
}%
\expandafter\def\csname clipabcline-\endcsname##1{% 負領域
  \vecXYZ{(##1)}\abcln@a\abcln@b\abcln@c
  \perlteisuuretu{abcln@a=\abcln@a;abcln@b=\abcln@b;abcln@c=\abcln@c}%
  \ifdim \abcln@b\p@=\z@
    \@Div\abcln@c\abcln@a\abcln@x
    \Mulself\abcln@x{-1}%
    \ifdim\abcln@a\p@>\z@
      \clipkline<hosyugo>{(\abcln@x,0)}{90}%
    \else
      \clipkline{(\abcln@x,0)}{90}%
    \fi
  \else
    \@Div\abcln@a\abcln@b\abcln@m
    \@Div\abcln@c\abcln@b\abcln@n
    \Mulself\abcln@m{-1}%
    \Mulself\abcln@n{-1}%
    \ifdim\abcln@b\p@>\z@
      \clipgline<hosyugo>{(0,\abcln@n)}\abcln@m
    \else
      \clipgline{(0,\abcln@n)}\abcln@m
    \fi
  \fi
}%
\def\clipxrange{\@ifnextchar<{\@clipxrange}{\@clipxrange<\empty>}}%
\def\@clipxrange<##1>##2{%
  \edef\h@syugo{\empty}%
  \edef\save@by@perl{\by@perl}%
  \edef\by@perl{0}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \Strsep{##2}{,}\clx@xi\clx@xii
  \ifx\empty\clx@xi\edef\clx@xi{\xmin}\fi
  \ifx\empty\clx@xii\edef\clx@xii{\xmax}\fi
  \ifnum\by@perl>\z@\perlteisuuretu{clx@xi=\clx@xi;clx@xii=\clx@xii}\fi
  \edef\by@perl{\save@by@perl}%
  \ifx\empty\h@syugo
    \edef\clx@Takakkei{%
      (\clx@xi,\ymin)(\clx@xii,\ymin)(\clx@xii,\ymax)(\clx@xi,\ymax)}%
  \else
    \edef\clx@Takakkei{\LB\RB\RT(\clx@xii,\ymax)(\clx@xii,\ymin)%
      (\clx@xi,\ymin)(\clx@xi,\ymax)\LT}%
  \fi
  \begin{clipTakakkei}\clx@Takakkei
}%
%
\def\clipyrange{\@ifnextchar<{\@clipyrange}{\@clipyrange<\empty>}}%
\def\@clipyrange<##1>##2{%
  \edef\h@syugo{\empty}%
  \edef\save@by@perl{\by@perl}%
  \edef\by@perl{0}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \Strsep{##2}{,}\cly@yi\cly@yii
  \ifx\empty\cly@yi\edef\cly@yi{\ymin}\fi
  \ifx\empty\cly@yii\edef\cly@yii{\ymax}\fi
  \ifnum\by@perl>\z@\perlteisuuretu{cly@yi=\cly@yi;cly@yii=\cly@yii}\fi
  \edef\by@perl{\save@by@perl}%
  \ifx\empty\h@syugo
    \edef\cly@Takakkei{%
      (\xmin,\cly@yi)(\xmin,\cly@yii)(\xmax,\cly@yii)(\xmax,\cly@yi)}%
  \else
    \edef\cly@Takakkei{\LB\RB\RT(\xmax,\cly@yii)(\xmin,\cly@yii)%
      (\xmin,\cly@yi)(\xmax,\cly@yi)\LT}%
  \fi
  \begin{clipTakakkei}\cly@Takakkei
}%
%
\def\clipSyougen##1{%
  \ifcase ##1
  \or % 1
    \clipTakakkei{(0,0)\XMAX\RT\YMAX}%
  \or % 2
    \clipTakakkei{(0,0)\XMIN\LT\YMAX}%
  \or % 3
    \clipTakakkei{(0,0)\XMIN\LB\YMIN}%
  \or % 4
    \clipTakakkei{(0,0)\XMAX\RB\YMIN}%
  \else
    \ifnum ##1=12\relax
      \clipTakakkei{\XMIN\XMAX\RT\LT}%
    \else\ifnum ##1=13\relax
      \clipTakakkei{\XMAX\RT\YMAX\YMIN\LB\XMIN}
    \else\ifnum ##1=14\relax
      \clipTakakkei{\YMIN\YMAX\RT\RB}%
    \else\ifnum ##1=23\relax
      \clipTakakkei{\YMIN\YMAX\LT\LB}%
    \else\ifnum ##1=24\relax
      \clipTakakkei{\YMIN\YMAX\LT\XMIN\XMAX\RB}%
    \else\ifnum ##1=34\relax
      \clipTakakkei{\RB\XMAX\XMIN\LB}%
    \else\ifnum ##1=123\relax
      \clipTakakkei{\O\XMAX\RT\LT\LB\YMIN}%
    \else\ifnum ##1=124\relax
      \clipTakakkei{\O\YMIN\RB\RT\LT\XMIN}%
    \else\ifnum ##1=134\relax
      \clipTakakkei{\O\XMIN\LB\RB\RT\YMAX}%
    \else\ifnum ##1=234\relax
      \clipTakakkei{\O\YMAX\LT\LB\RB\XMAX}
    \fi\fi\fi\fi\fi\fi\fi\fi\fi\fi
  \fi
}%
\def\endclipSyougen{%
  \endclipTakakkei
}%
%
\def\endclipLline{\xDecr\nest@clip\end{clipTakakkei}}%
\def\endcliplline{\end{clipTakakkei}}%
\def\endclipkline{\end{clipTakakkei}}%
\def\endclipgline{\end{clipTakakkei}}%
\def\endclipabcline{\end{clipTakakkei}}%
\expandafter\def\csname endclipabcline+\endcsname{\end{clipTakakkei}}%
\expandafter\def\csname endclipabcline-\endcsname{\end{clipTakakkei}}%
\def\endclipxrange{\end{clipTakakkei}}%
\def\endclipyrange{\end{clipTakakkei}}%
%
\def\clipLfunc{\@ifnextchar<{\@clipLfunc}{\@clipLfunc<\empty>}}%
\def\@clipLfunc<##1>##2{%
%\typeout{@clipLfunc:<##1>##2}%
  \YPoint{##2}\xmin\cL@P
  \YPoint{##2}\xmax\cL@Q
  \clipLline<##1>\cL@P\cL@Q
}%
\def\endclipLfunc{\endclipLline}%
%
\def\clipQfunc{%
  \@ifnextchar<{\@clipQfunc}{\@clipQfunc<\empty>}}%
\def\@clipQfunc<##1>##2{%
  \edef\draw@border{\empty}%
  \edef\h@syugo{\empty}%
  \edef\next@opt{\empty}%
  \edef\clip@label{\empty}%
  \edef\EMclip@label{\empty}%
  \xIncr\nest@clip
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
%  \ifx\empty\clip@label\else\writeLabel{\clip@label}{\nest@clip}\fi
%  \ifx\empty\EMclip@label\else\writeLabel{\EMclip@label}{\nest@clip}\fi
  \ifx\empty\next@opt
    \YLGraph{##2}\oresen@i
  \else
    \EMedef\cQf@opt{<\next@opt>}%
    \expandafter\YLGraph\cQf@opt{##2}\oresen@i
  \fi
  \clipy@resen{\oresen@i}%
}%
\def\endclipQfunc{%
  \xDecr\nest@clip
  \end{clipTakakkei}%
}%
\let\clipYGraph\clipQfunc
\let\clipYfunc\clipQfunc
\let\endclipYGraph\endclipQfunc
\let\endclipYfunc\endclipQfunc
%
\def\clipXGraph{\@ifnextchar<{\@clipXGraph}{\@clipXGraph<\empty>}}%
\def\@clipXGraph<##1>##2{%
  \edef\draw@border{\empty}%
  \edef\h@syugo{\empty}%
  \edef\next@opt{\empty}%
  \xIncr\nest@clip
  \edef\clip@label{\empty}%
  \edef\EMclip@label{\empty}%
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \EMedef\@currentlabel{\nest@clip}%
%  \ifx\empty\clip@label\else\writeLabel{\clip@label}{\nest@clip}\fi
%  \ifx\empty\EMclip@label\else\writeLabel{\EMclip@label}{\nest@clip}\fi
  \ifx\empty\next@opt
    \XLGraph{##2}\oresen@i
  \else
    \EMedef\cQf@opt{<\next@opt>}%
    \expandafter\XLGraph\cQf@opt{##2}\oresen@i
  \fi
  \clipx@resen{\oresen@i}%
}%
\def\endclipXGraph{%
  \xDecr\nest@clip
  \end{clipTakakkei}%
}%
\let\clipXfunc\clipXGraph
\let\endclipXfunc\endclipXGraph
%
\def\clipYoresen{%
  \@ifnextchar<{\@clipYoresen}{\@clipYoresen<\empty>}}%
\def\@clipYoresen<##1>##2{%
  \edef\draw@border{\empty}%
  \edef\h@syugo{\empty}%
  \edef\next@opt{\empty}%
  \edef\clip@label{\empty}%
  \edef\EMclip@label{\empty}%
  \xIncr\nest@clip
  \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
  \clipy@resen{##2}%
}%
%
\def\endclipYoresen{%
  \xDecr\nest@clip
  \end{clipTakakkei}%
}%
%
\def\clipy@resen##1{%
  \edef\cl@resen{##1}%
  \expandafter\makeTenHairetu\cl@resen
  \vecXY{\hairetu{TH@V}{1}}\dmy\cQf@ly
  \vecXY{\hairetu{TH@V}{\TH@N}}\dmy\cQf@ry
  \ifdim\cQf@ry\p@>\ymax\p@% 右：上方に外れ
    \Cfor{\edef\cQf@ri{\TH@N}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Decr\cQf@ri
        \vecXY{\hairetu{TH@V}{\cQf@ri}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@<\ymax\p@\edef\cQf@found{1}\fi
    }%
    \IAdd\cQf@ri{1}\cQf@rj
    \edef\cQf@Pri{\hairetu{TH@V}{\cQf@ri}}%
    \edef\cQf@Prj{\hairetu{TH@V}{\cQf@rj}}%
    \vecXY\cQf@Prj\cQf@xx\cQf@yy
    \Sub\cQf@yy\ymax\cQf@m
    \Sub\ymax\cQf@y\cQf@n
    \Bunten\cQf@Prj\cQf@Pri\cQf@m\cQf@n\cQf@R
    \ifdim\cQf@ly\p@>\ymax\p@%  左：上方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@<\ymax\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\cQf@yy\ymax\cQf@m
      \Sub\ymax\cQf@y\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RT\RB\LB\LT}%
      \fi
    \else\ifdim\cQf@ly\p@<\ymin\p@%  左：下方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@>\ymin\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\ymin\cQf@yy\cQf@m
      \Sub\cQf@y\ymin\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\LT\LB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RT\RB}%
      \fi
    \else% 左：範囲内
      \edef\cL@Takakkei{}%
      \Ifor*\i@val{1}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\LT}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RT\RB\LB}%
      \fi
    \fi\fi
  \else\ifdim\cQf@ry\p@<\ymin\p@% 右：下方に外れ
    \Cfor{\edef\cQf@ri{\TH@N}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Decr\cQf@ri
        \vecXY{\hairetu{TH@V}{\cQf@ri}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@>\ymin\p@\edef\cQf@found{1}\fi
    }%
    \IAdd\cQf@ri{1}\cQf@rj
    \edef\cQf@Pri{\hairetu{TH@V}{\cQf@ri}}%
    \edef\cQf@Prj{\hairetu{TH@V}{\cQf@rj}}%
    \vecXY\cQf@Prj\cQf@xx\cQf@yy
    \Sub\ymin\cQf@yy\cQf@m
    \Sub\cQf@y\ymin\cQf@n
    \Bunten\cQf@Prj\cQf@Pri\cQf@m\cQf@n\cQf@R
    \ifdim\cQf@ly\p@>\ymax\p@%  左：上方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@<\ymax\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\cQf@yy\ymax\cQf@m
      \Sub\ymax\cQf@y\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RB\RT}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\LB\LT}%
      \fi
    \else\ifdim\cQf@ly\p@<\ymin\p@%  左：下方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@>\ymin\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\ymin\cQf@yy\cQf@m
      \Sub\cQf@y\ymin\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RB\RT\LT\LB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei}%
      \fi
    \else% 左：範囲内
      \edef\cL@Takakkei{}%
      \Ifor*\i@val{1}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RB\RT\LT}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\LB}%
      \fi
    \fi\fi
  \else% 右：範囲内
    \ifdim\cQf@ly\p@>\ymax\p@%  左：上方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@<\ymax\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\cQf@yy\ymax\cQf@m
      \Sub\ymax\cQf@y\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\TH@N}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RT}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RB\LB\LT}%
      \fi
    \else\ifdim\cQf@ly\p@<\ymin\p@%  左：下方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@y\p@>\ymin\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\ymin\cQf@yy\cQf@m
      \Sub\cQf@y\ymin\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\TH@N}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RT\LT\LB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RB}%
      \fi
    \else% 左：範囲内
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          ##1}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{##1\RT\LT}%
      \else
        \edef\cL@Takakkei{##1\RB\LB}%
      \fi
    \fi\fi
  \fi\fi
\ifx\empty\EMclip@label\else
  \expandafter\xdef\csname clip@ln@\EMclip@label\endcsname{%
    \csname clip@ln\romannumeral\nest@clip\endcsname}%
\fi
  \begin{clipTakakkei}\cL@Takakkei
}%
%
\def\clipx@resen##1{%
  \edef\cl@resen{##1}%
  \expandafter\makeTenHairetu\cl@resen
  \vecXY{\hairetu{TH@V}{1}}\cQf@bx\dmy
  \vecXY{\hairetu{TH@V}{\TH@N}}\cQf@ux\dmy
  \ifdim\cQf@ux\p@>\xmax\p@% 上：右方に外れ
    \Cfor{\edef\cQf@ri{\TH@N}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Decr\cQf@ri
        \vecXY{\hairetu{TH@V}{\cQf@ri}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@<\xmax\p@\edef\cQf@found{1}\fi
    }%
    \IAdd\cQf@ri{1}\cQf@rj
    \edef\cQf@Pri{\hairetu{TH@V}{\cQf@ri}}%
    \edef\cQf@Prj{\hairetu{TH@V}{\cQf@rj}}%
    \vecXY\cQf@Prj\cQf@xx\cQf@yy
    \Sub\cQf@xx\xmax\cQf@m
    \Sub\xmax\cQf@x\cQf@n
    \Bunten\cQf@Prj\cQf@Pri\cQf@m\cQf@n\cQf@R
    \ifdim\cQf@bx\p@>\xmax\p@%  下：右方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@<\xmax\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\cQf@xx\xmax\cQf@m
      \Sub\xmax\cQf@x\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RT\LT\LB\RB}%
      \fi
    \else\ifdim\cQf@bx\p@<\xmin\p@%  下：左方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@>\xmin\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\xmin\cQf@xx\cQf@m
      \Sub\cQf@x\xmin\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RB\LB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RT\LT}%
      \fi
    \else% 下：範囲内
      \edef\cL@Takakkei{}%
      \Ifor*\i@val{1}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RT\LT\LB}%
      \fi
    \fi\fi
  \else\ifdim\cQf@ux\p@<\xmin\p@% 上：左方に外れ
    \Cfor{\edef\cQf@ri{\TH@N}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Decr\cQf@ri
        \vecXY{\hairetu{TH@V}{\cQf@ri}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@>\xmin\p@\edef\cQf@found{1}\fi
    }%
    \IAdd\cQf@ri{1}\cQf@rj
    \edef\cQf@Pri{\hairetu{TH@V}{\cQf@ri}}%
    \edef\cQf@Prj{\hairetu{TH@V}{\cQf@rj}}%
    \vecXY\cQf@Prj\cQf@xx\cQf@yy
    \Sub\xmin\cQf@xx\cQf@m
    \Sub\cQf@x\xmin\cQf@n
    \Bunten\cQf@Prj\cQf@Pri\cQf@m\cQf@n\cQf@R
    \ifdim\cQf@bx\p@>\xmax\p@%  下：右方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@<\xmax\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\cQf@xx\xmax\cQf@m
      \Sub\xmax\cQf@x\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\LT\RT}
      \else
        \edef\cL@Takakkei{\cL@Takakkei\LB\RB}%
      \fi
    \else\ifdim\cQf@bx\p@<\xmin\p@%  下：左方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@>\xmin\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\xmin\cQf@xx\cQf@m
      \Sub\cQf@x\xmin\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\LT\RT\RB\LB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei}%
      \fi
    \else% 下：範囲内
      \edef\cL@Takakkei{}%
      \Ifor*\i@val{1}{\cQf@ri}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \edefappend\cL@Takakkei{\cQf@R}%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\RT\LT\LB}%
      \fi
    \fi\fi
  \else% 上：範囲内
    \ifdim\cQf@bx\p@>\xmax\p@%  下：右方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@<\xmax\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\cQf@xx\xmax\cQf@m
      \Sub\xmax\cQf@x\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\TH@N}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\LT}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\LT\LB\RB}%
      \fi
    \else\ifdim\cQf@bx\p@<\xmin\p@%  下：左方に外れ
      \Cfor{\edef\cQf@i{1}\edef\cQf@found{0}}{\cQf@found=\z@}{}\do{%
        \Incr\cQf@i
        \vecXY{\hairetu{TH@V}{\cQf@i}}\cQf@x\cQf@y
        \ifdim\cQf@x\p@>\xmin\p@\edef\cQf@found{1}\fi
      }%
      \ISub\cQf@i{1}\cQf@j
      \edef\cQf@Pi{\hairetu{TH@V}{\cQf@i}}%
      \edef\cQf@Pj{\hairetu{TH@V}{\cQf@j}}%
      \vecXY\cQf@Pj\cQf@xx\cQf@yy
      \Sub\xmin\cQf@xx\cQf@m
      \Sub\cQf@x\xmin\cQf@n
      \Bunten\cQf@Pj\cQf@Pi\cQf@m\cQf@n\cQf@L
      \edef\cL@Takakkei{\cQf@L}%
      \Ifor*\i@val{\cQf@i}{\TH@N}\Do{%
        \edefappend\cL@Takakkei{\hairetu{TH@V}{\i@val}}%
      }%
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          \cL@Takakkei}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{\cL@Takakkei\RT\RB\LB}%
      \else
        \edef\cL@Takakkei{\cL@Takakkei\LT}%
      \fi
    \else% 下：範囲内
      \expandafter\xdef\csname clip@ln\romannumeral\nest@clip\endcsname{%
          ##1}%
      \ifx\empty\h@syugo
        \edef\cL@Takakkei{##1\RT\RB}%
      \else
        \edef\cL@Takakkei{##1\LT\LB}%
      \fi
    \fi\fi
  \fi\fi
\ifx\empty\EMclip@label\else
  \expandafter\xdef\csname clip@ln@\EMclip@label\endcsname{%
    \csname clip@ln\romannumeral\nest@clip\endcsname}%
\fi
  \begin{clipTakakkei}\cL@Takakkei
}%
%
%    \def\@@ArrowLine<##1>[##2]##3##4{%
%     \ifx b##2
%        \Bunten{##3}{##4}11\AL@M
%        \@@@ArrowLine<##1>[1]\AL@M{##4}%
%        \@@@ArrowLine<##1>[1]\AL@M{##3}%
%%        \@@@ArrowLine<##1>[1]{##3}{##4}%
%%        \Subvec{##3}{##4}\AL@v
%%        \Yaziri*{##3}\AL@v
%     \else
%        \@@@ArrowLine<##1>[##2]{##3}{##4}%%
%     \fi
%    }%
    \def\@@ArrowLine<##1>[##2]##3##4{{\gsave%
      \edef\put@str{\empty}\def\put@pos{.5}%
      \edef\hen@i{\empty}%
      \edef\hen@ii{\empty}%
%     \edef\iro@{\empty}%
      \ifx\empty ##1\else\setkeys{emP}{##1}\fi
%
      \ifx\empty\hen@i\def\ArrowLine@A{##3}\else\Addvec*{##3}{\hen@i}\ArrowLine@A\fi
      \ifx\empty\hen@ii\def\ArrowLine@B{##4}\else\Addvec*{##4}{\hen@ii}\ArrowLine@B\fi
%
      \ifx\empty\iro@\else\EMpsIrositei{\iro@}\fi
      \Subvec{\ArrowLine@B}{\ArrowLine@A}\miki@v
      \xytops{\ArrowLine@A}\@@x\@@y
\ifx b##2
        \def\AL@Q{\ArrowLine@B}%
\else
      \ifdim ##2 pt=1pt\relax
        \def\AL@Q{\ArrowLine@B}%
      \else
        \Sub{1}{##2}\AL@i
        \Bunten{\ArrowLine@A}{\ArrowLine@B}{##2}\AL@i\AL@Q
      \fi
\fi
      \xytops{\AL@Q}\@@xx\@@yy
\ifdim\arrow@headsize\p@=\z@
  \psDrawline{\ArrowLine@A\ArrowLine@B}%
\else
    \ifx b##2
      \Tyuuten\ArrowLine@A\ArrowLine@B\ArrowLine@M
      \xytops{\ArrowLine@M}\@@x\@@y
      \xytops{\ArrowLine@B}\@@xx\@@yy
      \immediate\write\EMps@out{newpath}%
      \immediate\write\EMps@out{%
        \@@x\space\@@y\space\@@xx\space\@@yy\space\arrow@size\space arrow}%
      \ifarrowfill
        \immediate\write\EMps@out{fill}%
      \else
        \immediate\write\EMps@out{stroke}%
      \fi
      \xytops{\ArrowLine@A}\@@xx\@@yy
      \immediate\write\EMps@out{newpath}%
      \immediate\write\EMps@out{%
        \@@x\space\@@y\space\@@xx\space\@@yy\space\arrow@size\space arrow}%
      \ifarrowfill
        \immediate\write\EMps@out{fill}%
      \else
        \immediate\write\EMps@out{stroke}%
      \fi
    \else
      \immediate\write\EMps@out{newpath}%
      \immediate\write\EMps@out{%
        \@@x\space\@@y\space\@@xx\space\@@yy\space\arrow@size\space arrow}%
      \ifarrowfill
        \immediate\write\EMps@out{fill}%
      \else
        \immediate\write\EMps@out{stroke}%
      \fi
    \fi
\fi
\ifx b##2\else
      \ifdim ##2 pt=1pt\relax\else\Drawline{\ArrowLine@A\ArrowLine@B}\fi
\fi
      \ifx\empty\put@str\else
        \Mulvec\put@pos\miki@v\put@p\Addvec{\ArrowLine@A}\put@p\put@p
        \expandafter\emathPut\expandafter\put@p\put@str
      \fi
    \grestore}}%
    \def\drawXYaxis{%
\edef\put@KM{\empty}%
      \put(0,0){\zikusensyu(\truexmin,0)(\truexmax,0)}%
      \put(0,0){\zikusensyu(0,\trueymin)(0,\trueymax)}%
      \edef\zahyou@tmp{{(\truexmax,0)}\yokozikuhaiti}%
%      \expandafter\emathPut\zahyou@tmp{\yokozikukigou}%
      \expandafter\cPut\zahyou@tmp{\yokozikukigou}%
      \edef\zahyou@tmp{{(0,\trueymax)}\tatezikuhaiti}%
%      \expandafter\emathPut\zahyou@tmp{\tatezikukigou}%
      \expandafter\cPut\zahyou@tmp{\tatezikukigou}%
      \edef\zahyou@tmp{{(0,0)}\gentenhaiti}%
%      \expandafter\emathPut\zahyou@tmp{\gentenkigou}%
      \expandafter\cPut\zahyou@tmp{\gentenkigou}%
    }%
%    \def\@hasen(##1,##2){\@ifnextchar({%
%        \xytops{(##1,##2)}\@@x\@@y
%        \immediate\write\EMps@out{newpath}%
%        \immediate\write\EMps@out{\@@x\space\@@y\space moveto}%
%        \@@hasen(##1,##2)}{%
%          \immediate\write\EMps@out{[] 0 setdash}%
%      }}%
%    \def\@@hasen(##1,##2)(##3,##4){%
%    \Kyorii{(##1,##2)}{(##3,##4)}\d@@hasen
%    \ifdim\d@@hasen pt>0.005pt\relax
%      \edef\hasen@S{(##1,##2)}\edef\hasen@E{(##3,##4)}%
%      \templa=\hasen@L\@Div{\strip@pt\templa}{\strip@pt\unitlength}\hasen@@L
%      \templa=\hasen@G\@Div{\strip@pt\templa}{\strip@pt\unitlength}\hasen@@G
%      \Add\hasen@@L\hasen@@G\hasen@@LG
%      \Subvec\hasen@E\hasen@S\hasen@v
%      \Unitvec\hasen@v\hasen@u
%      \Absvec\hasen@v\hasen@LL
%      \@Div\hasen@LL\hasen@@LG\hasen@tmp
%      \Seisuububun\hasen@tmp\hasen@n
%      \Sub\hasen@LL\hasen@@L\hasen@tmp
%      \ifnum\hasen@n>\z@
%        \@Div\hasen@tmp\hasen@n\hasen@tmp
%        \Sub\hasen@tmp\hasen@@L\hasen@@G
%        \Add\hasen@@L\hasen@@G\hasen@@LG\fi
%        \xytops{(##3,##4)}\@@x\@@y
%        \immediate\write\EMps@out{\@@x\space\@@y\space lineto}%
%        \ltops\hasen@@L\@@L
%        \ltops\hasen@@G\@@G
%        \immediate\write\EMps@out{[\@@L\space\@@G] 0 setdash}%
%        \immediate\write\EMps@out{stroke}%
%      \fi
%      \@hasen(##3,##4)%
%    }%
%%
%
    \def\Yaziri{%
      \def\Yaziri@sironuri{0}\@ifstar{\Yaziri@}{\@Yaziri}}%
    \def\Yaziri@{\def\Yaziri@sironuri{1}\@Yaziri}%
    \def\@Yaziri{\@ifnextchar<{\@@Yaziri}{\@@Yaziri<\empty>}}%
    \def\@@Yaziri<##1>##2##3{{%
      \gsave\setdash{}\relax
      \define@key{emPs}{fill}{\edef\Yazirusi@fill{####1}}%
      \edef\Yazirusi@fill{1}%
      \edef\yazirusi@opt{n}%
      \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
        \Absvec{##3}\yz@tmp
        \@tempdima\yz@tmp\unitlength
\ifdim\@tempdima>\z@
        \@Div\Arrowhead@L{\strip@pt\@tempdima}\yz@tmp
        \Mulvec\yz@tmp{##3}\yz@v
        \Mulvec{-1}{\yz@v}\yaziri@@@M
        \xdef\yaziri@@@M{\yaziri@@@M}%
        \Subvec{##2}\yz@v\yz@s
        \ifthenelse{\Yaziri@sironuri=\z@}{}{%
          \Add\cur@linewidth{2}\yz@lw
          \Bunten{##2}\yz@s{95}{5}\yz@s@
          \Drawline<iro=\EM@white,linewidth=\yz@lw>{##2\yz@s@}%
        }%
        \@Div\Arrowhead@W{2}\Arrowhead@W@
        \zituKaiten[\Arrowhead@W@\p@]\yz@s{##2}{90}\yz@P
        \zituKaiten[\Arrowhead@W@\p@]\yz@s{##2}{-90}\yz@Q
        \Bunten\yz@s{##2}{\ArrowHeadPit}{*}\yz@R%
        \ifx\empty\nuri@iro
%%          \emPaint<thickness=1>{##2\yz@P\yz@R\yz@Q}%
          \ifnum\Yazirusi@fill=\z@
            \Drawline{\yz@P##2\yz@Q}%
          \else
            \Nuritubusi[1]{##2\yz@P\yz@R\yz@Q}%
          \fi
        \else
          \edef\yz@c{\nuri@iro}%
%          \emPaint<paintcolor=\yz@c>{##2\yz@P\yz@R\yz@Q}%
          \Nuritubusi<nuriiro=\yz@c>{##2\yz@P\yz@R\yz@Q}%
        \fi
\fi
      \grestore
    }}%
    \def\kYaziri##1##2{%
      \DegCos{##2}\pskyzr@x
      \DegSin{##2}\pskyzr@y
      \Yaziri{##1}{(\pskyzr@x,\pskyzr@y)}%
    }%
%    \def\yaziri##1{\Yaziri\local@origin{##1}}%
    \def\yaziri##1{\Yaziri{(0,0)}{##1}}%
%
    \def\Enk@@@<##1>##2##3[##4]##5[##6]##7{\begingroup
      \ifEMpscontinue\else\gsave\fi
      \edef\ten@kosuu{}%
      \edef\hasen@opt{\empty}%
      \edef\hasenLG@opt{\empty}%
      \edef\yazirusi@pos{-1}%
%      \edef\hazime@kaku{##5}%
      \edef\yazirusi@opt{}%
%      \edef\owari@kaku{##7}%
      \edef\@tyuusin{##2}%
      \edef\@hankei{##3}%
      \edef\hamidasi@kaku{0}%
      \edef\YG@owariT{\empty}%
      \edef\YG@owariM{\empty}%
      \edef\YG@hazimeT{\empty}%
      \edef\YG@hazimeM{\empty}%
      \ifEMpscontinue
        \def\byouga@dousa{p}%
        \edef\EMps@newpath{0}%
      \else
        \def\byouga@dousa{s}%
        \edef\EMps@newpath{1}%
      \fi
      \ifx\empty ##1\else\setkeys{emPs}{##1}\fi
      \Strchr{##3}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##3}\fi
      \Strchr{##5}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##5}\else
        \isnumber{##5}{\edef\hazime@kaku{##5}}{\fpcalcval{##5}\hazime@kaku}%
      \fi
      \Strchr{##7}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##7}\else
        \isnumber{##7}{\edef\owari@kaku{##7}}{\fpcalcval{##7}\owari@kaku}%
      \fi
%
      \ifx\empty\hasenLG@opt
      \else
        \strsep\hasenLG@opt{,}\hasen@@L\hasen@@G
        \ukansan\hasen@@L\hasen@@L
        \ukansan\hasen@@G\hasen@@G
        \Add\hasen@@L\hasen@@G\hasen@@LG
        \DegRad{\hazime@kaku}\hE@argS
        \DegRad{\owari@kaku}\hE@argE
        \Sub\hE@argE\hE@argS\hE@arg@
        \Mul\@hankei\hE@arg@\hasen@LL
        \@Div\hasen@LL\hasen@@LG\hasen@tmp
        \Seisuububun\hasen@tmp\hasen@n
        \ifthenelse{\equal{\hazime@kaku}{0}\and\equal{\owari@kaku}{360}}{%
          \edef\hasen@tmp{\hasen@LL}%
        }{%
          \Sub\hasen@LL\hasen@@L\hasen@tmp
        }%
        \ifnum\hasen@n>\z@
          \@Div\hasen@tmp\hasen@n\hasen@tmp
          \Sub\hasen@tmp\hasen@@L\hasen@@G
        \fi
        \setdash{\hasen@@L,\hasen@@G}%
      \fi
%
%      \Subself\hazime@kaku\hamidasi@kaku
%      \Addself\owari@kaku\hamidasi@kaku
      \strsep{\hamidasi@kaku}{,}\hk@a\hk@b
      \ifx\empty\hk@b\edef\hk@b{\hk@a}\fi
      \Subself\hazime@kaku\hk@a
      \Addself\owari@kaku\hk@b
      \Rdef[\@tyuusin](\@hankei,\hazime@kaku)\hazimeT
      \Rdef[\@tyuusin](\@hankei,\owari@kaku)\owariT
      \ifx\empty##4\else\edef##4{\hazime@kaku}\fi
      \ifx\empty##6\else\edef##6{\owari@kaku}\fi
      \ifthenelse{\equal\iro@\empty}{%
        \edef\EMpsc@set{0}%
      }{%
        \edef\EMpsc@set{1}%
        \begin{EMpscolor}{\iro@}%
      }%
      \ifthenelse{\equal\ten@kosuu\empty}{%
            \ifthenelse{\equal\yazirusi@opt\empty}{\edef\yazirusi@opt{n}}{}%
            \ifthenelse{\lengthtest{\arrow@headsize\p@=\z@}}{%
              \edef\yazirusi@opt{n}}{}%
\ifthenelse{\enkobyspecial>\z@}{%
            \ifthenelse{\equal\hasen@opt\empty\or\not
                \equal\hasenLG@opt\empty}{%
              \xytops{\@tyuusin}\@@x\@@y
              \ltops{\@hankei}\@@r
              \ifnum\EMps@newpath=\z@\else\immediate\write\EMps@out{newpath}\fi
%             \ifdim\hazime@kaku pt<\owari@kaku pt\relax
              \ifthenelse{\lengthtest{\hazime@kaku pt<\owari@kaku pt}}{%
%\ifdim\yazirusi@pos\p@<\z@
\ifthenelse{\lengthtest\yazirusi@pos\p@<\z@}{%
                \ifthenelse{\equal\yazirusi@opt{a}\or\equal\yazirusi@opt{b}}{%
                  \def\Enko@tmp{\Arrowhead@L}%
                  \Sub{1}{\ArrowHeadPit}\Enko@@tmp
                  \Mulself\Enko@tmp\Enko@@tmp
                  \Mul\Enko@tmp{9.99}\Enko@tmp
                  \@Div\Enko@tmp\@@r\Enko@tmp
                  \RadDeg\Enko@tmp\Enko@tmp
                  \Sub\owari@kaku\Enko@tmp\owari@kaku@
                }{%
                  \def\owari@kaku@{\owari@kaku}%
                }%
                \ifthenelse{\equal\yazirusi@opt{b}\or\equal\yazirusi@opt{r}}{%
                  \def\Enko@tmp{\Arrowhead@L}%
                  \Mul\Enko@tmp{9.99}\Enko@tmp
                  \Sub{1}{\ArrowHeadPit}\Enko@@tmp
                  \Mulself\Enko@tmp\Enko@@tmp
                  \@Div\Enko@tmp\@@r\Enko@tmp
                  \RadDeg\Enko@tmp\Enko@tmp
                  \Add\hazime@kaku\Enko@tmp\hazime@kaku@
                }{%
                  \def\hazime@kaku@{\hazime@kaku}%
                }%
%\else
}{%
                  \def\hazime@kaku@{\hazime@kaku}%
                  \def\owari@kaku@{\owari@kaku}%
}%
%\fi
                \immediate\write\EMps@out{\@@x\space\@@y\space\@@r\space
                  \hazime@kaku@\space\owari@kaku@\space \byouga@arc}%
              }{%
                \immediate\write\EMps@out{\@@x\space\@@y\space\@@r\space
                  \hazime@kaku\space\owari@kaku\space arcn}%
              }%
              \byouga
%\yyy
\@ifundefined{xunitlength}{}{%
    \kansan{\xmin\xunitlength}{\unitlength}\xmin
    \kansan{\ymin\yunitlength}{\unitlength}\ymin
    \xunitlength=\unitlength
    \yunitlength=\unitlength
    \def\@xscale{1}%
    \def\@yscale{1}%
}%
              \ifthenelse{\equal\yazirusi@opt{a}\or\equal\yazirusi@opt{b}}{%
                \ifdim\yazirusi@pos\p@<\z@
                  \edef\@tmp{\owari@kaku}%
                \else
                  \Sub{1}\yazirusi@pos\yazirusi@pos@
                  \iBunten\hazime@kaku\owari@kaku\yazirusi@pos\yazirusi@pos@\@tmp
                \fi
                \Rdef[\@tyuusin](\@hankei,\@tmp)\enko@T
                \@tempdima=\as@iii\p@\@tempdima=0.1\@tempdima
                \ukansan{\@tempdima}\d@@theta
                \@Div\d@@theta\@hankei\d@@theta
                \RadDeg\d@@theta\d@@theta
%                \Sub\owari@kaku\d@@theta\kaku@tmp
                \Sub\@tmp\d@@theta\kaku@tmp
                \Rdef[\@tyuusin](\@hankei,\kaku@tmp)\enko@U
                \Subvec\enko@T\enko@U\enko@UT
                \Yaziri\enko@T\enko@UT
              }{}%
              \ifthenelse{\equal\yazirusi@opt{r}\or\equal\yazirusi@opt{b}}{%
%                \Rdef[\@tyuusin](\@hankei,\hazime@kaku)\enko@T
                \ifdim\yazirusi@pos\p@<\z@
                  \edef\@tmp{\hazime@kaku}%
                \else
                  \Sub{1}\yazirusi@pos\yazirusi@pos@
                  \iBunten\hazime@kaku\owari@kaku\yazirusi@pos@\yazirusi@pos\@tmp
                \fi
                \Rdef[\@tyuusin](\@hankei,\@tmp)\enko@T
                \@tempdima=\as@iii\p@\@tempdima=0.1\@tempdima
                \ukansan{\@tempdima}\d@@theta
                \@Div\d@@theta\@hankei\d@@theta
                \RadDeg\d@@theta\d@@theta
%                \Add\hazime@kaku\d@@theta\kaku@tmp
                \Add\@tmp\d@@theta\kaku@tmp
                \Rdef[\@tyuusin](\@hankei,\kaku@tmp)\enko@U
                \Subvec\enko@T\enko@U\enko@UT
                \Yaziri\enko@T\enko@UT
              }{}%%
            }{%
              \emathPut\@tyuusin{%
                \Yenko(.5)[\yazirusi@opt]\@hankei\hazime@kaku\owari@kaku%
                \expandafter\Daenko\hasen@opt\@hankei\@hankei
                  \hazime@kaku\owari@kaku}%
            }%
}{%
    \Put\@tyuusin(0,0)[lb]{%
      \Yenko[\yazirusi@opt]\@hankei\hazime@kaku\owari@kaku}%
    \vecXY\@tyuusin\enko@cx\enko@cy
    \DegRad{\hazime@kaku}\hazime@kaku
    \DegRad{\owari@kaku}\owari@kaku
    \def\enko@Xt{\enko@cx+\@hankei*cos(T)}%
    \def\enko@Yt{\enko@cy+\@hankei*sin(T)}%
%    \ifthenelse{\equal{\yazirusi@opt}{a}}{%
%     \ParamDiff<setten=enko@e>\enko@Xt\enko@Yt\owari@kaku\yazirusi@v
%     \Yaziri\enko@e\yazirusi@v
%   }{}%
    \ParamC<mint=\hazime@kaku,maxt=\owari@kaku>\enko@Xt\enko@Yt
}%
      }{%
        \ISub\ten@kosuu{1}\ten@kosuui
        \Sub\owari@kaku\hazime@kaku\kaku@kankaku
        \@Div\kaku@kankaku\ten@kosuui\kaku@kankaku
        \edef\@kaku{\hazime@kaku}%
        \edef\Ten@c{\iro@}%
        \ukansan{.5\p@}\Ten@r
        \emathPut\@tyuusin{%
          \Ifor\@kizami{0}{\ten@kosuui}\Do{%
            \Rdef(\@hankei,\@kaku)\@Ten
%            \emathPut\@Ten{{\unitlength\p@\circle*{1}}}%
            \ifx\empty\Ten@c
              \En*[1]\@Ten\Ten@r
            \else
              \En*[nuriiro=\Ten@c]\@Ten\Ten@r
            \fi
            \Add\@kaku\kaku@kankaku\@kaku
          }%
          \Rdef(\@hankei,\owari@kaku)\@Ten
%          \emathPut\@Ten{{\unitlength\p@\circle*{1}}}%
          \ifx\empty\Ten@c
            \En*[1]\@Ten\Ten@r
          \else
            \En*[nuriiro=\Ten@c]\@Ten\Ten@r
          \fi
        }%
      }%
      \ifthenelse{\EMpsc@set=\z@}{}{\end{EMpscolor}}%
%\if p\byouga@dousa\else\grestore\fi
%\ifnum\ps@continue=\z@\grestore\fi
  \ifx\empty\YG@hazimeM\else
    \EMedef\Enk@tmp{{\hazimeT}\YG@hazimeM}%
    \expandafter\emathPut\Enk@tmp
  \fi
  \ifx\empty\YG@owariM\else
    \EMedef\Enk@tmp{{\owariT}\YG@owariM}%
    \expandafter\emathPut\Enk@tmp
  \fi
\ifEMpscontinue\else\grestore\fi
  \edef\temp@x{\def\noexpand\hazimeT{\hazimeT}%
               \def\noexpand\owariT{\owariT}%
               \def\noexpand\YG@hazimeT{\YG@hazimeT}%
               \def\noexpand\YG@owariT{\YG@owariT}}%
  \expandafter\endgroup\temp@x
  \ifx\empty\YG@hazimeT\else
    \expandafter\edef\csname\YG@hazimeT\endcsname{\hazimeT}\fi
  \ifx\empty\YG@owariT\else
    \expandafter\edef\csname\YG@owariT\endcsname{\owariT}\fi
\ignorespaces}%
%
    \def\@@@ougigata[##1]<##2>##3##4##5{%
      \edef\hazime@kaku{##4}%
      \edef\owari@kaku{##5}%
      \def\nuri@iro{\nuri@iro@}%
      \edef\draw@border{\empty}%
      \Strchr{##2}{=}\Enk@tmp
      \ifnum\Enk@tmp>\z@\setkeys{emP}{##2}\fi
      \edef\@tyuusin{\local@origin}%
      \edef\@hankei{##3}%
      \Strchr{##3}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##3}\fi
      \Strchr{##4}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##4}\fi
      \Strchr{##5}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##5}\fi
      \edef\@tyuusin{(0,0)}%
      \xytops{\@tyuusin}\@@x\@@y
      \ltops{\@hankei}\@@r
      \immediate\write\EMps@out{newpath}%
      \immediate\write\EMps@out{\@@x\space\@@y\space moveto}%
      \immediate\write\EMps@out{%
          \@@x\space\@@y\space\@@r\space\hazime@kaku\space\owari@kaku\space
          arc closepath}%
      \if@nuri
\ifx\empty\draw@border\else\gsave\fi
        \ifthenelse{\equal\nuri@iro\empty}{%
          \Sub{1}{##1}\nuri@grayscale
          \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
        }{%
          \EMpsIrositei{\nuri@iro}%
        }%
        \immediate\write\EMps@out{fill}%
        \immediate\write\EMps@out{0 setgray}%
\ifx\empty\draw@border\else
\grestore
\immediate\write\EMps@out{stroke}%
\fi
      \else
        \immediate\write\EMps@out{stroke}%
      \fi
    }%
    \def\@@hatch@ougigata[##1]<##2>##3##4##5{%
      \bgroup\gsave
      \edef\hazime@kaku{##4}%
      \edef\owari@kaku{##5}%
      \edef\@hankei{##3}%
      \edef\@tyuusin{\local@origin}%
      \Strchr{##3}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##3}\fi
      \Strchr{##4}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##4}\fi
      \Strchr{##5}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##5}\fi
      \edef\@tyuusin{(0,0)}%
      \edef\@resen{\@tyuusin}%
      \For\@kaku{\hazime@kaku}{\owari@kaku}{5}\Do{%
        \Rdef[\@tyuusin](\@hankei,\@kaku)\@P%
        \edef\@resen{\@resen\@P}}%
      \Rdef[\@tyuusin](\@hankei,\owari@kaku)\@P%
      \edef\@resen{\@resen\@P\@tyuusin}%
      \linethickness{\slash@thickness}%
      \Hatchpolygon[##1]<##2>\@resen
      \grestore
      \egroup
    }%
%
    \def\@@@yumigata[##1]<##2>##3##4##5{%
      \edef\hazime@kaku{##4}%
      \edef\owari@kaku{##5}%
      \def\nuri@iro{\nuri@iro@}%
      \Strchr{##2}{=}\Enk@tmp
      \ifnum\Enk@tmp>\z@\setkeys{emP}{##2}\fi
      \edef\@hankei{##3}%
      \edef\@tyuusin{\local@origin}%
      \Strchr{##3}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##3}\fi
      \Strchr{##4}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##4}\fi
      \Strchr{##5}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##5}\fi
      \edef\@tyuusin{(0,0)}%
      \xytops{\@tyuusin}\@@x\@@y
      \ltops{\@hankei}\@@r
      \immediate\write\EMps@out{newpath}%
      \immediate\write\EMps@out{%
          \@@x\space\@@y\space\@@r\space\hazime@kaku\space\owari@kaku\space
          arc closepath}%
      \if@nuri
        \ifthenelse{\equal\nuri@iro\empty}{%
          \Sub{1}{##1}\nuri@grayscale
          \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
        }{%
          \EMpsIrositei{\nuri@iro}%
        }%
        \ifx\empty\draw@border
          \immediate\write\EMps@out{fill}%
        \else
          \immediate\write\EMps@out{gsave}%
          \immediate\write\EMps@out{fill}%
          \immediate\write\EMps@out{grestore}%
          \immediate\write\EMps@out{0 setgray}%
          \immediate\write\EMps@out{stroke}%
        \fi
        \immediate\write\EMps@out{0 setgray}%
      \else
        \immediate\write\EMps@out{stroke}%
      \fi
    }%
    \def\@@hatch@yumigata[##1]<##2>##3##4##5{%
      \bgroup\gsave
      \edef\hazime@kaku{##4}%
      \edef\owari@kaku{##5}%
      \edef\@hankei{##3}%
      \edef\@tyuusin{\local@origin}%
      \Strchr{##3}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##3}\fi
      \Strchr{##4}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##4}\fi
      \Strchr{##5}{=}\Enk@tmp\ifnum\Enk@tmp>\z@\setkeys{emP}{##5}\fi
      \edef\@tyuusin{(0,0)}%
      \edef\@resen{}%
      \For\@kaku\hazime@kaku\owari@kaku{5}\Do{%
        \Rdef[\@tyuusin](\@hankei,\@kaku)\@P\edef\@resen{\@resen\@P}%
      }%
      \Rdef[\@tyuusin](\@hankei,\owari@kaku)\@P
      \edef\@resen{\@resen\@P}\Rdef[\@tyuusin](\@hankei,\hazime@kaku)\@P
      \edef\@resen{\@resen\@P}%
      \linethickness{\slash@thickness}%
      \Hatchpolygon[##1]<##2>\@resen
      \grestore\egroup
    }%
%
    \def\@@@zahyouMemori[##1][##2]<##3>{{%
      \edef\by@perl{0}%
      \gsave
      \xdef\zM@xo{0}%
      \xdef\zM@yo{0}%
      \xdef\zM@dx{1}%
      \xdef\zM@dy{1}%
      \def\zM@sensyu{\drawline}%
      \def\zM@linethickness{\zM@linethickness@}%
      \edef\x@memoriiti{[s]}%
      \edef\y@memoriiti{[w]}%
      \edef\size@{.5pt}%
      \setdash{.1,.1}%
		  \let\zMx@func\relax
		  \let\zMy@func\relax
%      \@tempdima=\def@memori@nagasa
  \Strsep{\def@memori@nagasa}{,}\memori@nagasai\memori@nagasaii
  \uxkansan\memori@nagasai\memori@nagasaxi
  \uykansan\memori@nagasai\memori@nagasayi
  \ifx\empty\memori@nagasaii
    \let\memori@nagasaxii\memori@nagasaxi
    \let\memori@nagasayii\memori@nagasayi
    \edef\memori@nagasaxi{-\memori@nagasaxii}%
    \edef\memori@nagasayi{-\memori@nagasayii}%
  \else
    \uxkansan\memori@nagasaii\memori@nagasaxii
    \uykansan\memori@nagasaii\memori@nagasayii
  \fi
      \Strchr{##3}{=}\zM@tmp
      \ifnum\zM@tmp>\z@
		    \define@key{emPzM}{xfunc}{\def\zMx@func{####1}}%
    		\define@key{emPzM}{yfunc}{\def\zMy@func{####1}}%
        \define@key{emPzM}{size}{\def\size@{####1}}%
        \define@key{emPzM}{only}{\def\zM@only{####1}}%
        \define@key{emPzM}{iro}{\def\iro@{####1}}%
        \setkeys{emPzM}{##3}%
      \else
        \def\zM@dx{##3}%
        \def\zM@dy{##3}%
      \fi
      \setlinewidth{\zM@linethickness}%
%      \@Div{\strip@pt\@tempdima}{\strip@pt\unitlength}\memori@nagasa
%      \@Div\memori@nagasa\@xscale\memori@nagasax
%      \@Div\memori@nagasa\@yscale\memori@nagasay
        \Sub\truexmax\zM@xo\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dx\zM@a
        \Seisuububun\zM@a\zM@xn
        \Sub\zM@xo\truexmin\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dx\zM@a
        \Seisuububun\zM@a\zM@a
        \IAdd\zM@xn\zM@a\zM@xn\Incr\zM@xn
        \Mul\zM@a\zM@dx\zM@a
        \Sub\zM@xo\zM@a\zM@x
        \Sub\trueymax\zM@yo\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dy\zM@a
        \Seisuububun\zM@a\zM@yn
        \Sub\zM@yo\trueymin\zM@a\Sub\zM@a{.001}\zM@a
        \@Div\zM@a\zM@dy\zM@a
        \Seisuububun\zM@a\zM@a
        \IAdd\zM@yn\zM@a\zM@yn\Incr\zM@yn
        \Mul\zM@a\zM@dy\zM@a
        \Sub\zM@yo\zM@a\zM@y
        \edef\x@flg{1}%
        \edef\y@flg{1}%
        \@ifundefined{zM@only}{%
        }{%
          \if x\zM@only
            \edef\y@flg{0}%
          \else\if y\zM@only
            \edef\x@flg{0}%
          \fi\fi
        }
      \if g##1\relax
        \xdef\zMx{\zM@xo}%
        \Add\zM@xo\zM@dx\zM@x@
        \Cfor{\edef\i@num{1}}{\lengthtest{\zM@x@\p@<\truexmax\p@}}{%
              \Addself\zM@x@\zM@dx\Incr\i@num}\do{%
          \expandafter\xdef\csname zMx\romannumeral\i@num\endcsname{\zM@x@}}%
        \Sub\zM@xo\zM@dx\zM@x@
        \Cfor{\edef\i@num{1}}{\lengthtest{\zM@x@\p@>\truexmin\p@}}{%
              \Subself\zM@x@\zM@dx\Incr\i@num}\do{%
          \expandafter\xdef\csname zMxm\romannumeral\i@num\endcsname{\zM@x@}}%
        \xdef\zMy{\zM@yo}%
        \Add\zM@yo\zM@dy\zM@y@
        \Cfor{\edef\i@num{1}}{\lengthtest{\zM@y@\p@<\trueymax\p@}}{%
              \Addself\zM@y@\zM@dy\Incr\i@num}\do{%
          \expandafter\xdef\csname zMy\romannumeral\i@num\endcsname{\zM@y@}}%
        \Sub\zM@yo\zM@dy\zM@y@
        \Cfor{\edef\i@num{1}}{\lengthtest{\zM@y@\p@>\trueymin\p@}}{%
              \Subself\zM@y@\zM@dy\Incr\i@num}\do{%
          \expandafter\xdef\csname zMym\romannumeral\i@num\endcsname{\zM@y@}}%
        \def\zm@@x{\zM@x}%
        \ifx\empty\iro@\else\begin{EMpscolor}{\iro@}\fi
        \Ifor\@@n{0}\zM@xn\Do{%
          \zM@sensyu(\zm@@x,\trueymin)(\zm@@x,\trueymax)\relax
          \Add\zm@@x\zM@dx\zm@@x}%
        \def\zm@@y{\zM@y}%
        \Ifor\@@n{0}\zM@yn\Do{%
          \zM@sensyu(\truexmin,\zm@@y)(\truexmax,\zm@@y)\relax
          \Add\zm@@y\zM@dy\zm@@y}%
        \ifx\empty\iro@\else\end{EMpscolor}\fi
      \else\if +##1\relax
        \gsave
        \setdash{}%
        \def\zm@@x{\zM@x}%
        \Ifor\@@nx{0}\zM@xn\Do{%
          \def\zm@@y{\zM@y}%
          \Ifor\@@ny{0}\zM@yn\Do{%
            \put(\zm@@x,\zm@@y){%
              \zM@sensyu(\memori@nagasaxi,0)(\memori@nagasaxii,0)%
              \zM@sensyu(0,\memori@nagasayi)(0,\memori@nagasayii)%
            }%
            \Add\zm@@y\zM@dy\zm@@y
          }%
          \Add\zm@@x\zM@dx\zm@@x
        }%
        \grestore
      \else\if o##1\relax
        \def\zm@@x{\zM@x}%
        \edef\Kuromaru@Hankei{\size@}%
        \Ifor\@@nx{0}\zM@xn\Do{%
          \def\zm@@y{\zM@y}%
          \Ifor\@@ny{0}\zM@yn\Do{%
            \Kuromaru{(\zm@@x,\zm@@y)}%
            \Add\zm@@y\zM@dy\zm@@y
          }%
          \Add\zm@@x\zM@dx\zm@@x
        }%
      \else\if z##1\relax
        \setdash{}%
        \ifnum\x@flg>\z@
            \def\zm@@x{\zM@x}%
            \Ifor\@@n{0}\zM@xn\Do{%
              \zM@sensyu(\zm@@x,\memori@nagasayi)(\zm@@x,\memori@nagasayii)%
              \Add\zm@@x\zM@dx\zm@@x}%
        \fi
        \ifnum\y@flg>\z@
            \def\zm@@y{\zM@y}%
            \Ifor\@@n{0}\zM@yn\Do{%
              \zM@sensyu(\memori@nagasaxi,\zm@@y)(\memori@nagasaxii,\zm@@y)%
              \Add\zm@@y\zM@dy\zm@@y}%
        \fi
      \fi\fi\fi\fi
      \if m##2\relax
        \ifnum\x@flg>\z@
          \Strchr\zM@xo{.}\zM@tmpa
          \Strchr\zM@dx{.}\zM@tmpb
          \ifthenelse{\zM@tmpa=0 \and \zM@tmpb=0}{%
            \Cfor{\def\zM@x{\zM@xo}}{\lengthtest{\zM@x pt<\truexmax pt}}{%
            \IAdd\zM@dx\zM@x\zM@x}\do{%
              \ifnum\zM@x=\z@\else
                \EMedef\zM@tmp{{(\zM@x,\memori@nagasayi)}\x@memoriiti{$\protect\zMx@func{\zM@x}$}}%
                \expandafter\cPut\zM@tmp
              \fi}%
            \Cfor{\def\zM@x{\zM@xo}\ISub\zM@x\zM@dx\zM@x}{%
              \lengthtest{\zM@x pt>\truexmin pt}}{\ISub\zM@x\zM@dx\zM@x}\do{%
              \EMedef\zM@tmp{{(\zM@x,\memori@nagasayi)}\x@memoriiti{$\protect\zMx@func{\zM@x}$}}%
              \expandafter\cPut\zM@tmp}%
          }{%
            \strsep\zM@dx{.}\zM@dmya\zM@dmyb
            \Strlen\zM@dmyb\zM@syousuubu
            \Cfor{\def\zM@x{\zM@xo}}{\lengthtest{\zM@x pt<\truexmax pt}}{%
              \Add\zM@dx\zM@x\zM@x}\do{%
              \ifdim\zM@x pt=\z@\else
                \EMround\zM@x\zM@syousuubu\zM@x
                \EMedef\zM@tmp{{(\zM@x,\memori@nagasayi)}\x@memoriiti{$\protect\zMx@func{\zM@x}$}}%
	              \expandafter\cPut\zM@tmp
              \fi
            }%
            \Cfor{\def\zM@x{\zM@xo}\Sub\zM@x\zM@dx\zM@x}{%
              \lengthtest{\zM@x pt>\truexmin pt}}{\Sub\zM@x\zM@dx\zM@x}\do{%
              \EMround\zM@x\zM@syousuubu\zM@x
              \EMedef\zM@tmp{{(\zM@x,\memori@nagasayi)}\x@memoriiti{$\protect\zMx@func{\zM@x$}}}%
              \expandafter\cPut\zM@tmp
            }%
          }%
        \fi
        \ifnum\y@flg>\z@
          \Strchr\zM@yo{.}\zM@tmpa
          \Strchr\zM@dy{.}\zM@tmpb
          \ifthenelse{\zM@tmpa=0 \and \zM@tmpb=0}{%
            \Cfor{\def\zM@y{\zM@yo}\ISub\zM@y\zM@dy\zM@y}{%
              \lengthtest{\zM@y pt>\trueymin pt}}{\ISub\zM@y\zM@dy\zM@y}\do{%
                \EMedef\zM@tmp{{(\memori@nagasaxi,\zM@y)}\y@memoriiti{$\protect\zMy@func{\zM@y}$}}%
              \expandafter\cPut\zM@tmp
            }%
            \Cfor{\edef\zM@y{\zM@yo}}{\lengthtest{\zM@y pt<\trueymax pt}}{%
              \IAdd\zM@dy\zM@y\zM@y}\do{%
              \ifnum\zM@y=\z@\else
                \EMedef\zM@tmp{{(\memori@nagasaxi,\zM@y)}\y@memoriiti{$\protect\zMy@func{\zM@y}$}}%
                \expandafter\cPut\zM@tmp%
              \fi
            }%
          }{%
            \strsep\zM@dy{.}\zM@dmya\zM@dmyb
            \Strlen\zM@dmyb\zM@syousuubu
            \Cfor{\def\zM@y{\zM@yo}\Sub\zM@y\zM@dy\zM@y}{%
                \lengthtest{\zM@y pt>\trueymin pt}}{\Sub\zM@y\zM@dy\zM@y}\do{%
              \EMround\zM@y\zM@syousuubu\zM@y
              \EMedef\zM@tmp{{(\memori@nagasaxi,\zM@y)}\y@memoriiti{$\protect[\zMy@func{\zM@y}$}}%
              \expandafter\cPut\zM@tmp
            }%
            \Cfor{\edef\zM@y{\zM@yo}}{\lengthtest{\zM@y pt<\trueymax pt}}{%
              \Add\zM@dy\zM@y\zM@y}\do{%
              \ifdim\zM@y pt=\z@\else
                \EMround\zM@y\zM@syousuubu\zM@y
                \EMedef\zM@tmp{{(\memori@nagasaxi,\zM@y)}\y@memoriiti{$\protect\zMy@func{\zM@y}$}}%
                \expandafter\cPut\zM@tmp
              \fi
            }%
          }%
        \fi
      \fi
      \grestore
    }}%
%
  \def\yokozikuMemori{%
    \@ifnextchar<{\@yokozikuMemori}{\@yokozikuMemori<\empty>}}%
%
  \def\@yokozikuMemori<##1>{{\gsave
% ---------------------------------------------------------------------
    \define@key{emPzM}{prlabel}{\edef\pr@label{####1}}%
    \define@key{emPzM}{Ls}{\edef\zM@Ls{####1}}%
    \define@key{emPzM}{dL}{\edef\zM@dL{####1}}%
    \define@key{emPzM}{xs}{\edef\zM@xs{####1}}%
    \define@key{emPzM}{xe}{\edef\zM@xe{####1}}%
    \define@key{emPzM}{syousuubu}{\edef\syousuu@bu{####1}}%
% ---------------------------------------------------------------------
    \edef\by@perl{0}%
    \def\zM@xs{\truexmin}%
    \def\zM@xe{\truexmax}%
    \Strsep{\def@memori@nagasa}{,}\memori@nagasai\memori@nagasaii
    \uykansan\memori@nagasai\memori@nagasayi
    \ifx\empty\memori@nagasaii
        \let\memori@nagasayii\memori@nagasayi
        \edef\memori@nagasayi{-\memori@nagasayii}%
    \else
        \uykansan\memori@nagasaii\memori@nagasayii
    \fi
    \ifthenelse{%
      \lengthtest{\trueymin\p@<\z@}\and\lengthtest{\trueymax\p@>\z@}}{%
        \def\zM@yo{0}%
    }{%
        \def\zM@yo{\trueymin}%
    }%
    \def\pr@label{1}%
    \def\zM@dx{1}%
    \def\zM@linethickness{\zM@linethickness@}%
    \ifx\empty ##1\else\setkeys{emPzM}{##1}\fi
    \edef\by@perl{0}%
    \linethickness{\zM@linethickness}%
    \Add\zM@yo\memori@nagasayi\zM@yo@
    \ifdim\zM@dx\p@=\z@\else
      \Strsep\zM@dx{.}\zM@dxi\zM@dxs
      \Strlen\zM@dxs\zM@dx@syousuubu
      \@ifundefined{zM@dL}{}{%
        \Strsep\zM@dL{.}\zM@dxi\zM@dxs
        \Strlen\zM@dxs\zM@labeldx@syousuubu
      }%
      \@ifundefined{syousuu@bu}{}{\edef\zM@dx@syousuubu{\syousuu@bu}}%
      \Cfor{\edef\zM@x{\zM@xs}}{%
        \lengthtest{\zM@x\p@<\zM@xe\p@}\or\lengthtest{\zM@x\p@=\zM@xe\p@}}{%
        \Addself\zM@x\zM@dx\EMround\zM@x\zM@dx@syousuubu\zM@x}\do{%
        \Put{(\zM@x,\zM@yo)}{%
          \drawline(0,\memori@nagasayi)(0,\memori@nagasayii)\relax
        }%
        \ifnum\pr@label>\z@
          \@ifundefined{zM@Ls}{%
            \edef\zM@tmp{{(\zM@x,\zM@yo@)}\x@memoriiti{$\zM@x$}}%
          }{%
            \EMround\zM@Ls\zM@labeldx@syousuubu\zM@Ls
            \edef\zM@tmp{{(\zM@x,\zM@yo@)}\x@memoriiti{$\zM@Ls$}}%
            \Addself\zM@Ls\zM@dL
          }%
          \expandafter\emathPut\zM@tmp
        \fi
      }%
    \fi
    \grestore
  }}%
%
  \def\tatezikuMemori{%
    \@ifnextchar<{\@tatezikuMemori}{\@tatezikuMemori<\empty>}}%
%
  \def\@tatezikuMemori<##1>{{\gsave
% ---------------------------------------------------------------------
    \define@key{emPzM}{prlabel}{\edef\pr@label{####1}}%
    \define@key{emPzM}{Ls}{\edef\zM@Ls{####1}}%
    \define@key{emPzM}{dL}{\edef\zM@dL{####1}}%
    \define@key{emPzM}{ys}{\xdef\zM@ys{####1}}%
    \define@key{emPzM}{ye}{\xdef\zM@ye{####1}}%
    \define@key{emPzM}{syousuubu}{\edef\syousuu@bu{####1}}%
      \Strsep{\def@memori@nagasa}{,}\memori@nagasai\memori@nagasaii
      \uykansan\memori@nagasai\memori@nagasaxi
      \ifx\empty\memori@nagasaii
        \let\memori@nagasaxii\memori@nagasaxi
        \edef\memori@nagasaxi{-\memori@nagasaxii}%
      \else
        \uykansan\memori@nagasaii\memori@nagasaxii
      \fi
% ---------------------------------------------------------------------
    \edef\by@perl{0}%
    \def\zM@ys{\trueymin}%
    \def\zM@ye{\trueymax}%
    \def\zM@dy{1}%
    \Strsep{\def@memori@nagasa}{,}\memori@nagasai\memori@nagasaii
    \uykansan\memori@nagasai\memori@nagasayi
    \ifx\empty\memori@nagasaii
        \let\memori@nagasayii\memori@nagasayi
        \edef\memori@nagasayi{-\memori@nagasayii}%
    \else
        \uykansan\memori@nagasaii\memori@nagasayii
    \fi
    \ifthenelse{%
      \lengthtest{\trueymin\p@<\z@}\and\lengthtest{\trueymax\p@>\z@}}{%
        \def\zM@xo{0}%
    }{%
        \def\zM@xo{\truexmin}%
    }%
    \def\pr@label{1}%
    \def\zM@linethickness{\zM@linethickness@}%
    \ifx\empty ##1\else\setkeys{emPzM}{##1}\fi
    \edef\by@perl{0}%
    \Add\zM@xo\memori@nagasaxi\zM@xo@
    \linethickness{\zM@linethickness}%
    \ifdim\zM@dy\p@=\z@\else
      \Strsep\zM@dy{.}\zM@dyi\zM@dys
      \Strlen\zM@dys\zM@dy@syousuubu
      \@ifundefined{zM@dL}{}{%
        \Strsep\zM@dL{.}\zM@dxi\zM@dxs
        \Strlen\zM@dxs\zM@labeldy@syousuubu
      }%
      \@ifundefined{syousuu@bu}{}{\edef\zM@dy@syousuubu{\syousuu@bu}}%
      \Cfor{\edef\zM@y{\zM@ys}}{%
        \lengthtest{\zM@y\p@<\zM@ye\p@}\or\lengthtest{\zM@y\p@=\zM@ye\p@}}{%
        \Addself\zM@y\zM@dy\EMround\zM@y\zM@dy@syousuubu\zM@y}\do{%
        \Put{(\zM@xo,\zM@y)}{%
          \drawline(\memori@nagasaxi,0)(\memori@nagasaxii,0)\relax
        }%
        \ifnum\pr@label>\z@
          \@ifundefined{zM@Ls}{%
            \edef\zM@tmp{{(\zM@xo@,\zM@y)}\y@memoriiti{$\zM@y$}}%
          }{%
            \EMround\zM@Ls\zM@labeldy@syousuubu\zM@Ls
            \edef\zM@tmp{{(\zM@xo@,\zM@y)}\y@memoriiti{$\zM@Ls$}}%
            \Addself\zM@Ls\zM@dL
          }%
          \expandafter\emathPut\zM@tmp
        \fi
      }%
    \fi
    \grestore
  }}%
%
    \let\ltxqbezier\qbezier
    \def\qbezier{\@ifnextchar[{\@qbezier}{\@qbezier[0]}}%
    \def\@qbezier[##1](##2,##3)(##4,##5)(##6,##7){%
      \tenretu*{psqbz@A(##2,##3);psqbz@B(##4,##5);psqbz@C(##6,##7)}%
      \immediate\write\EMps@out{gsave}%
      \immediate\write\EMps@out{newpath}%
      \Bunten\psqbz@A\psqbz@B21\psqbz@AB
      \Bunten\psqbz@B\psqbz@C12\psqbz@BC
      \xytops\psqbz@A\psqbz@Ax\psqbz@Ay
      \xytops\psqbz@C\psqbz@Cx\psqbz@Cy
      \xytops\psqbz@AB\psqbz@ABx\psqbz@ABy
      \xytops\psqbz@BC\psqbz@BCx\psqbz@BCy
      \ifnum ##1>\z@
        \Kyori\psqbz@A\psqbz@B\psqbz@lAB
        \@Div\psqbz@lAB{##1}\psqbz@tmp
        \ltops\psqbz@tmp\psqbz@tmp
        \immediate\write\EMps@out{[\psqbz@tmp\space\psqbz@tmp] 0 setdash}%
      \fi
      \immediate\write\EMps@out{\psqbz@Ax\space\psqbz@Ay\space moveto}%
      \immediate\write\EMps@out{\psqbz@ABx\space\psqbz@ABy\space
        \psqbz@BCx\space\psqbz@BCy\space\psqbz@Cx\space\psqbz@Cy\space
        curveto}%
      \immediate\write\EMps@out{stroke}%
%     \immediate\write\EMps@out{[] 0 setdash}%
      \immediate\write\EMps@out{grestore}%
    }%
%
% Bezier 3次曲線
%
% \EMpsBezier<##1>##2##3##4##5
%   <##1> : key=val
%           linewidth=
%           dash=
%           yazirusi=a/r/A/R
%           waku
%    ##2  : 端点1
%    ##3  : 制御点1
%    ##4  : 制御点2
%    ##5  : 端点2
%
\def\ps@drawwaku@{0}%
\def\psdrawwaku##1{\def\ps@drawwaku@{##1}}%
\def\EMpsBezier{\@ifnextchar<{\@EMpsBezier}{\@EMpsBezier<\empty>}}%
\def\@EMpsBezier<##1>##2##3##4##5{{%
%  \ifnum\ps@continue=\z@\gsave\fi
  \ifEMpscontinue\else\gsave\fi
  \def\ps@drawwaku{\ps@drawwaku@}%
  \def\nuri@grayscale{.5}%
  \ifEMpscontinue\def\byouga@dousa{p}\else\def\byouga@dousa{s}\fi
  \edef\yazirusi@opt{\empty}%
  \ifx \empty ##1\else\setkeys{emPs}{##1}\fi
  \ifEMpscontinue\else\immediate\write\EMps@out{newpath}%
   \xytops{##2}\@@x\@@y
   \immediate\write\EMps@out{\@@x\space\@@y\space moveto}%
  \fi
  \xytops{##3}\@@xi\@@yi
  \xytops{##4}\@@xii\@@yii
  \xytops{##5}\@@xiii\@@yiii
  \immediate\write\EMps@out{%
    \@@xi\space\@@yi\space\@@xii\space\@@yii\space\@@xiii\space\@@yiii\space
    curveto}%
\gsave
  \ifx\empty\iro@\else\EMpsIrositei{\iro@}\fi
  \byouga
  \edef\iro@{\empty}%
  \ifnum\ps@drawwaku>\z@
    \psDrawline<linewidth=1,yazirusi=n>{##2##3##4##5}%
  \fi
\grestore
  \ifx\empty\yazirusi@opt\else
    \if a\yazirusi@opt\Subvec{##5}{##4}\ya@vec\Yaziri*{##5}\ya@vec\else
    \if A\yazirusi@opt\Subvec{##5}{##4}\ya@vec\Yaziri{##5}\ya@vec\else
    \if r\yazirusi@opt\Subvec{##2}{##3}\ya@vec\Yaziri*{##2}\ya@vec\else
    \if R\yazirusi@opt\Subvec{##2}{##3}\ya@vec\Yaziri{##2}\ya@vec
    \else\if b\yazirusi@opt
      \Subvec{##5}{##4}\ya@vec\Yaziri*{##5}\ya@vec
      \Subvec{##2}{##3}\ya@vec\Yaziri*{##2}\ya@vec
    \else\if B\yazirusi@opt
      \Subvec{##5}{##4}\ya@vec\Yaziri{##5}\ya@vec
      \Subvec{##2}{##3}\ya@vec\Yaziri{##2}\ya@vec
    \fi\fi\fi\fi\fi\fi
  \fi
  \ifEMpscontinue\else\grestore\fi
}}%
%
% \EMpsRBezier<##1>##2##3##4##5
%   <##1> : key=val
%           linewidth=
%           dash=
%           waku
%    ##2  : 端点1
%    ##3  : 端点1を始点とする補助点1の極座標
%    ##4  : 端点2
%    ##5  : 端点2を始点とする補助点2の極座標
%
\def\EMpsRBezier{\@ifnextchar<{\@EMpsRBezier}{\@EMpsRBezier<\empty>}}%
\def\@EMpsRBezier<##1>##2##3##4##5{%
%  \ifx\empty\base@angle\else
%    \Subvec{##4}{##2}\psrB@tmp
%    \Argvec\psrB@tmp\base@angle
%  \fi
  \vecXY{##3}\psrB@a\psrB@b
%    \ifx\empty\base@angle\else\Addself\psrB@b\base@angle\fi
    \Rdef[##2](\psrB@a,\psrB@b)\psrB@P
  \vecXY{##5}\psrB@a\psrB@b
%    \ifx\empty\base@angle\else\Addself\psrB@b\base@angle\fi
    \Rdef[##4](\psrB@a,\psrB@b)\psrB@Q
  \@EMpsBezier<##1>{##2}\psrB@P\psrB@Q{##4}%
}%
%
% \emRbezier<##1>##2##3##4
%   <##1>: key=val
%          waku
%          linethickness=
%          yazirusi
%    ##2: 端点0
%    ##3: 端点n
%    ##4: 端点を始点とする制御点の極座標成分列
%
%\edef\base@angle{\empty}%
%\def\emRbezier{\edef\base@angle{\empty}\@ifstar{\emRbezier@}{\@emRbezier}}%
%\def\emRbezier@{\edef\base@angle{1}\@emRbezier}%
%\def\@emRbezier{\@ifnextchar<{\@@emRbezier}{\@@emRbezier<\empty>}}%
\def\emRbezier{\@ifnextchar<{\@@emRbezier}{\@@emRbezier<\empty>}}%
\def\@@emRbezier<##1>##2##3##4{%
  \Strsep{##4}{;}\RB@a\RB@b
  \EMpsRBezier<##1>{##2}{\RB@a}{##3}{\RB@b}%
  \edef\bz@opt{##1}%
  \edef\cur@bzP{##3}%
}%
%
%\def\emRbezierto{\edef\base@angle{\empty}%
%  \@ifstar{\emRbezierto@}{\@emRbezierto}}%
%\def\emRbezierto@{\edef\base@angle{1}\@emRbezierto}%
%\def\@emRbezierto{\@ifnextchar<{\@@emRbezierto}{\@@emRbezierto<\empty>}}%
\def\emRbezierto{\@ifnextchar<{\@@emRbezierto}{\@@emRbezierto<\empty>}}%
\def\@@emRbezierto<##1>##2##3{%
  \vecXY\RB@b\RB@ax\RB@ay
  \Strsep{##3}{;}\RB@a\RB@b
  \ifthenelse{\equal{\RB@a}{*}}{%
    \Addself\RB@ay{180}%
    \edef\RB@a{(\RB@ax,\RB@ay)}%
  }{%
    \vecXY\RB@a\RB@ax@\RB@ay@
    \ifthenelse{\equal\RB@ay@{*}}{%
      \Addself\RB@ay{180}%
      \edef\RB@a{(\RB@ax@,\RB@ay)}%
    }{%
    }%
  }%
  \edef\RBarg@iii{\RB@a;\RB@b}%
  \ifx\empty ##1
    \edef\bz@tmp{<\bz@opt>}%
    \expandafter\emRbezier\bz@tmp\cur@bzP{##2}{\RBarg@iii}%
  \else
    \emRbezier<##1>\cur@bzP{##2}{\RBarg@iii}%
  \fi
}%
%
%
\define@key{emGurafu}{diffL}{\def\diff@L{##1}}%
\def\BGraph{\@ifnextchar<{\@BGraph}{\@BGraph<\empty>}}%
\def\@BGraph<##1>##2{\begingroup
  \gsave
  \edef\YG@unit{1}%
  \edef\YG@xl{\truexmin}%
  \edef\YG@xr{\truexmax}%
  \edef\YG@hidariT{\empty}%
  \edef\YG@migiT{\empty}%
  \edef\diff@L{\empty}%
  \ifx\empty ##1\else\setkeys{emGurafu}{##1}\fi
  \edef\BG@xl{\YG@xl}%
  \Add\BG@xl\YG@unit\BG@xr
  \Sub\BG@xr\BG@xl\BG@w
  \Ytenretu*{##2}{P@L(\BG@xl);P@R(\BG@xr)}%
  \ifx\empty\diff@L
    \YDiff{##2}\BG@xl\m@L
    \YDiff{##2}\BG@xr\m@R
    \ifdim\m@L\p@>\p@
      \perltenretu*{BG@vi(\BG@w/(2.5*\m@L),\BG@w/2.5)}%
    \else\ifdim\m@L\p@<\m@ne\p@
      \perltenretu*{BG@vi(\BG@w/(2.5*(\m@L)),\BG@w/2.5)}%
    \else
      \perltenretu*{BG@vi(\BG@w/2.5,\BG@w*(\m@L)/2.5)}%
    \fi\fi
    \ifdim\m@R\p@>\p@
      \perltenretu*{BG@vii(\BG@w/(2.5*\m@R),\BG@w/2.5)}%
    \else\ifdim\m@R\p@<\m@ne\p@
      \perltenretu*{BG@vii(\BG@w/(2.5*(\m@R)),\BG@w/2.5)}%
    \else
      \perltenretu*{BG@vii(\BG@w/2.5,\BG@w*(\m@R)/2.5)}%
    \fi\fi
  \else
    \perlMulvec{\BG@w/2.5}\diff@L\BG@vi%
    \YDiff{##2}\BG@xr\m@R
    \perltenretu*{BG@vii(\BG@w/2.5,\BG@w*\m@R/2.5)}%
  \fi
  \Addvec\P@L\BG@vi\P@Li
  \Subvec\P@R\BG@vii\P@Lii
%\typeout{\P@L\P@Li\P@Lii\P@R}%
  \psnewpath
  \psmoveto\P@L
  \pscurveto\P@Li\P@Lii\P@R
  \Cfor{\edef\BG@xl{\BG@xr}\Add\BG@xl\YG@unit\BG@xr}%
      {\lengthtest{\BG@xl\p@<\YG@xr\p@}}%
      {\edef\BG@xl{\BG@xr}\Add\BG@xl\YG@unit\BG@xr}\do{%
    \ifdim\BG@xr\p@>\YG@xr\p@\edef\BG@xr{\YG@xr}\fi
    \edef\P@L{\P@R}\edef\m@L{\m@R}%
    \Sub\BG@xr\BG@xl\BG@w
    \Ytenretu*{##2}{P@R(\BG@xr)}%
    \YDiff{##2}\BG@xr\m@R
    \ifdim\m@L\p@>10\p@
      \perltenretu*{BG@vi(\BG@w/(2.5*\m@L),\BG@w/2.5);%
          BG@vii(\BG@w/(2.5*\m@R),\BG@w/2.5)}%
    \else
      \perltenretu*{BG@vi(\BG@w/2.5,\BG@w*\m@L/2.5);%
          BG@vii(\BG@w/2.5,\BG@w*\m@R/2.5)}%
    \fi
%    \perltenretu*{BG@vi(\BG@w/3,\BG@w*\m@L/3);BG@vii(\BG@w/3,\BG@w*\m@R/3)}%
    \Addvec\P@L\BG@vi\P@Li
    \Subvec\P@R\BG@vii\P@Lii
    \pscurveto\P@Li\P@Lii\P@R
  }
  \ifx\empty\iro@\else\EMpsIrositei{\iro@}\fi
  \psstroke
  \grestore
  \endgroup
}%
%
\def\QGraph{\@ifnextchar<{\@QGraph}{\@QGraph<\empty>}}%
\def\@QGraph<##1>##2{\begingroup
  \gsave
  \edef\YG@xl{\truexmin}%
  \edef\YG@xr{\truexmax}%
  \edef\YG@hidariT{\empty}%
  \edef\YG@migiT{\empty}%
  \Qfunctocsv{##2}\Q@csv
  \ifx\empty ##1\else\setkeys{emGurafu}{##1}\fi
  \csvQeq\Q@csv{0,\trueymax}{x@}
    \edef\x@lt{\x@i}%
    \edef\x@rt{\x@ii}%
  \csvQeq\Q@csv{0,\trueymin}{x@}
    \edef\x@lb{\x@i}%
    \edef\x@rb{\x@ii}%
  \funcval{##2}\YG@xr\tmp@y
  \ifdim\tmp@y\p@>\trueymax\p@
    \edef\YG@xr{\x@rt}%
  \else\ifdim\tmp@y\p@<\trueymin\p@
    \edef\YG@xr{\x@rb}%
  \fi\fi
  \funcval{##2}\YG@xl\tmp@y
  \ifdim\tmp@y\p@>\trueymax\p@
    \edef\YG@xl{\x@lt}%
  \else\ifdim\tmp@y\p@<\trueymin\p@
    \edef\YG@xl{\x@lb}%
  \fi\fi
  \perlteisuuretu{QG@xm=(\YG@xl+\YG@xr)/2}%
  \Ytenretu*{##2}{QG@L(\YG@xl);QG@R(\YG@xr);QG@M(\QG@xm)}%
  \csvDiff\Q@csv\YG@xl\QG@Lm
  \csvDiff\Q@csv\YG@xr\QG@Rm
  \csvDiff\Q@csv\QG@xm\QG@Mm
  \gandg\QG@M\QG@Mm\QG@L\QG@Lm\QG@P
  \gandg\QG@M\QG@Mm\QG@R\QG@Rm\QG@Q
  \gandg\QG@M\QG@Mm\QG@R\QG@Rm\QG@Q
  \Bunten\QG@L\QG@P{4}{-1}\QG@ii
  \Bunten\QG@R\QG@Q{4}{-1}\QG@iii
  \EMpsBezier\QG@L\QG@ii\QG@iii\QG@R
  \grestore
  \edef\temp@x{\def\noexpand\migiT{\QG@R}%
               \def\noexpand\hidariT{\QG@L}%
               \def\noexpand\YG@migiT{\YG@migiT}%
               \def\noexpand\YG@hidariT{\YG@hidariT}%
               }%
  \expandafter\endgroup\temp@x
  \ifx\empty\YG@migiT\else
    \expandafter\edef\csname\YG@migiT\endcsname{\migiT}\fi
  \ifx\empty\YG@hidariT\else
    \expandafter\edef\csname\YG@hidariT\endcsname{\hidariT}\fi
  \ignorespaces
}%
%
    \def\nuritubusi{\@ifnextchar[{\@nuritubusi}{\@nuritubusi[.5]}}%
    \def\@nuritubusi[##1]{\Sub{1}{##1}\nuri@grayscale\@@nuritubusi}%
    \def\@@nuritubusi(##1,##2){%
      \immediate\write\EMps@out{newpath}%
      \xytops{(##1,##2)}\@@x\@@y
      \immediate\write\EMps@out{\@@x\space\@@y\space moveto}%
      \@ifnextchar({\@@@nuritubusi}{\nuritubusi@}%
    }%
    \def\@@@nuritubusi(##1,##2){%
      \xytops{(##1,##2)}\@@x\@@y
      \immediate\write\EMps@out{\@@x\space\@@y\space lineto}%
      \@ifnextchar({\@@@nuritubusi}{\nuritubusi@}%
    }%
    \def\nuritubusi@{%
      \immediate\write\EMps@out{closepath}%
      \immediate\write\EMps@out{gsave}%
      \ifthenelse{\equal\nuri@iro\empty}{%
        \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
      }{%
        \EMpsIrositei{\nuri@iro}%
      }%
      \immediate\write\EMps@out{fill}%
      \immediate\write\EMps@out{grestore}%
      \ifthenelse{\equal\draw@border\empty}{}{%
        \ifthenelse{\equal\iro@\empty}{%
          \immediate\write\EMps@out{stroke}%
        }{%
          \gsave
          \EMpsIrositei{\iro@}%
          \immediate\write\EMps@out{stroke}%
          \grestore
        }%
      }%
    }%
    \def\@Nuritubusi[##1]<##2>##3{{%
    \ifthenelse{\equal{##3}\empty}{}{%
      \edef\Nuritubusi@takakkei{##3}%
      \edef\draw@border{\empty}%
      \def\nuri@iro{\nuri@iro@}%
      \ifx\empty ##2\else\setkeys{emP}{##2}\fi
      \Strchr{##1}{=}\nuri@iro@tmp
      \ifnum\nuri@iro@tmp>\z@\setkeys{emP}{##1}%
      \else
        \Sub{1}{##1}\nuri@grayscale
      \fi
      \ifthenelse{\equal\nuri@grayscale{1}}{\edef\draw@border{1}}{}%
\@ifundefined{dilute@color}{}{%
%  \edef\draw@border{1}%
%  \edef\iro@{\nuri@iro}%
  \EMdilutecolor{\nuri@iro}{\dilute@color}{nuri@iro@tmp}%
  \edef\nuri@iro{nuri@iro@tmp}%
}%
      \put(0,0){\@@Nuritubusi{\Nuritubusi@takakkei}}%
%      \ifx\empty\draw@border\else\Takakkei\Nuritubusi@takakkei\fi
    }}}%
    \def\@@Nuritubusi##1{%
    \edef\@tmp{##1}\expandafter\@@nuritubusi\@tmp}%
    \def\open@nuri{%
        \@tempdima=\syasen@tanmatu
        \@tempdima=10\@tempdima
        \begin{EMpscolor}{\EM@white}%
          \setlinewidth{\strip@pt\@tempdima}%
          \Drawline\Nuritubusi@takakkei
        \end{EMpscolor}%
    }%
%
\def\RBezierarc{\@ifnextchar<{\@RBezierarc}{\@RBezierarc<\empty>}}%
\def\@RBezierarc<##1>##2##3##4##5##6##7{%
% ##2: 始点
% ##3: 終点
% (##4,##5): 始点から制御点1へのベクトル（極座標形式）
% (##6,##7): 始点から制御点2へのベクトル（極座標形式）
%          ##6=\empty の場合は ##6=##4
%          ##7=\empty の場合は ##7=##5
  \ifthenelse{\equal{##6}\empty}{\edef\RBarc@rii{##4}}{\edef\RBarc@rii{##6}}%
  \ifthenelse{\equal{##7}\empty}{\edef\RBarc@tii{##5}}{\edef\RBarc@tii{##7}}%
  \Subvec{##3}{##2}\RBarc@v
  \Argvec\RBarc@v\RBarc@arg
  \Add\RBarc@arg{##5}\RBarc@argP\edef\RBarc@P{(##4,\RBarc@argP)}%
  \Sub\RBarc@arg\RBarc@tii\RBarc@argQ\Addself\RBarc@argQ{180}%
  \edef\RBarc@Q{(\RBarc@rii,\RBarc@argQ)}%
  \ifx\empty ##1
    \EMpsRBezier{##2}\RBarc@P{##3}\RBarc@Q
  \else
    \EMpsRBezier<##1>{##2}\RBarc@P{##3}\RBarc@Q
  \fi
}
%
%%
% \EPSkaiten#1[#2][#3]#4#5
%   #1 : 回転の中心
%   #2 : 拡大率(x軸方向)
%   #3 : 拡大率(y軸方向)
%   #4 : 回転角（六十分法）
%   #5 : 回転する対象
%
    \def\EPSkaiten##1{\@ifnextchar[{\@EPSkaiten{##1}}{\@EPSkaiten{##1}[1]}}%
    \def\@EPSkaiten##1[##2]{\@ifnextchar[{\@@EPSkaiten{##1}[##2]}{\@@EPSkaiten{##1}[##2][1]}}%
    \def\@@EPSkaiten##1[##2][##3]##4##5{%
      \bgroup
      \xytops{##1}\@@x\@@y
      \edef\EPStranslate@x{\@@x}%
      \edef\EPStranslate@y{\@@y}%
      \immediate\write\EMps@out{gsave}%
      \immediate\write\EMps@out{%
        \EPStranslate@x\space\EPStranslate@y\space translate}%
      \immediate\write\EMps@out{##4\space rotate}%
      \immediate\write\EMps@out{##2\space ##3\space scale}%
      ##5\relax
      \immediate\write\EMps@out{grestore}%
      \egroup
    }%
%    \def\endEPSkaiten{%
%      \immediate\write\EMps@out{grestore}%
%    }%
%
% 点#1を通り，方向角#2の直線に関して#3を線対称に動かす。
%
\def\sentaisyou##1##2##3{%
      \bgroup
      \Mul{2}{##2}\rflct@arg
%      \DegCos\rflct@arg\c@rflct
      \calcval{Degcos(\rflct@arg)}\c@rflct
      \Mul{-1}\c@rflct\mc@rflct
%      \DegSin\rflct@arg\s@rflct
      \calcval{Degsin(\rflct@arg)}\s@rflct
      \xytops{##1}\@@x\@@y
      \edef\EPStranslate@x{\@@x}%
      \edef\EPStranslate@y{\@@y}%
      \immediate\write\EMps@out{gsave}%
      \immediate\write\EMps@out{%
        \EPStranslate@x\space\EPStranslate@y\space translate}%
      \immediate\write\EMps@out{%
       [\c@rflct\space\s@rflct\space\s@rflct\space\mc@rflct\space 0 0] concat}%
      ##3\relax
      \immediate\write\EMps@out{grestore}%
      \egroup
}%
%\def\sentaisyou##1##2##3{
%      \bgroup
%      \Mul{2}{##2}\rflct@arg
%      \DegCos\rflct@arg\c@rflct
%      \Mul{-1}\c@rflct\mc@rflct
%      \DegSin\rflct@arg\s@rflct
%      \xytops{##1}\@@x\@@y
%      \edef\EPSrflctlate@x{\@@x}%
%      \edef\EPSrflctlate@y{\@@y}%
%      \immediate\write\EMps@out{gsave}%
%      \immediate\write\EMps@out{%
%         [\c@rflct\space\s@rflct\space\s@rflct\space\mc@rflct\space
%         \EPSrflctlate@x\space\EPSrflctlate@y] concat}%
%\Subvec\LB{##1}\rflct@P
%      \Put\rflct@P{##3}\relax
%      \immediate\write\EMps@out{grestore}%
%      \egroup
%}%
%
% \EPSkakudai##1##2##3
%   ##1 : 相似拡大の中心
%   ##2 : 拡大率
%   ##3 : 拡大する対象
%
    \def\EPSkakudai##1##2##3{%
      \bgroup
      \xytops{##1}\@@x\@@y
      \edef\EPStranslate@x{\@@x}%
      \edef\EPStranslate@y{\@@y}%
      \immediate\write\EMps@out{gsave}%
      \immediate\write\EMps@out{%
        \EPStranslate@x\space\EPStranslate@y\space translate}%
      \immediate\write\EMps@out{[##2\space 0 0 ##2\space 0 0] concat}%
%     \immediate\write\EMps@out{##2\space rotate}%
      \@Div\cur@linewidth{##2}\cur@linewidth
      \immediate\write\EMps@out{\cur@linewidth\space setlinewidth}%
      ##3\relax
      \immediate\write\EMps@out{grestore}%
      \egroup
    }%
%
% \EPShenkan##1##2##3##4##5##6
%   ##1 : 基準点
%   ##2,##3,##4,##5 : a, b, c, d
%   ##6 : 対象
%
    \def\EPShenkan##1##2##3##4##5##6{%
      \bgroup
      \xytops{##1}\@@x\@@y
      \edef\EPStranslate@x{\@@x}%
      \edef\EPStranslate@y{\@@y}%
      \immediate\write\EMps@out{gsave}%
      \immediate\write\EMps@out{%
        \EPStranslate@x\space\EPStranslate@y\space translate}%
      \immediate\write\EMps@out{[##2\space ##3\space ##4\space ##5\space 0 0] concat}%
      \immediate\write\EMps@out{\cur@linewidth\space setlinewidth}%
      ##6\relax
      \immediate\write\EMps@out{grestore}%
      \egroup
    }%
%
% \kaitenkigou
%
\def\Dayenko{%
  \@ifstar{\def\yenko@byouga{0}\@Eayenko}{\def\yenko@byouga{1}\@Dayenko}}%
\def\@Dayenko{\@ifnextchar[{\@@Dayenko}{\@@Dayenko[a]}}%
\def\@@Dayenko[##1]##2##3##4##5{{%
  \edef\yenko@s{##4}\edef\yenko@e{##5}%
%  \Add{##2}{##3}\@DaYenko@r\@Div\@DaYenko@r{2}\@DaYenko@r
%  \@Div\Arr@wHeadSize{\@DaYenko@r}\d@theta
\@Div ##2\@yscale\yoko@hankei
\@Div ##3\@xscale\tate@hankei
%  \ifdim ##2\p@>##3\p@
%    \@Div\Arr@wHeadSize{##3}\d@theta
	\ifdim\yoko@hankei\p@>\tate@hankei\p@
		\calcval{##2/(\@yscale*\@yscale)}\d@theta
  \else
%    \@Div\Arr@wHeadSize{##2}\d@theta
		\calcval{##3/(\@xscale*\@xscale)}\d@theta
  \fi
\@Div\d@theta{##2}\d@theta
\Mul\d@theta{##3}\d@theta
  \RadDeg\d@theta\d@theta
  \Mul\d@theta{.4}\d@theta
  \ifdim\@yscale\p@<\p@\Mulself\d@theta\@yscale\fi
  \Mul\d@theta{1}\d@theta@
%
%  \@ifundefined{xunitlength}{}{%
%    \kansan{\xmin\xunitlength}{\unitlength}\xmin
%    \kansan{\ymin\yunitlength}{\unitlength}\ymin
%    \xunitlength=\unitlength
%    \yunitlength=\unitlength
%    \def\@xscale{1}%
%    \def\@yscale{1}%
%  }%
%
  \ifthenelse{\equal{##1}{a} \or \equal{##1}{b} \or \equal{##1}{\empty}}{%
    \ETen\O{##2}{##3}{##5}\yenko@P
    \Sub{##5}\d@theta\yenko@e
    \Sub{##5}\d@theta@\yenko@e@
    \ETen\O{##2}{##3}{\yenko@e@}\yenko@Q
    \Subvec\yenko@P\yenko@Q\@MP
%\Kuromaru{\yenko@P\yenko@Q}%
    \Yaziri\yenko@P\@MP
  }{}%
  \ifthenelse{\equal{##1}{b} \or \equal{##1}{r}}{%
    \ETen\O{##2}{##3}{##4}\yenko@P
    \Add{##4}\d@theta\yenko@s
    \Add{##4}\d@theta@\yenko@s@
    \ETen\O{##2}{##3}{\yenko@s@}\yenko@Q
    \Subvec\yenko@P\yenko@Q\@MP
    \Yaziri\yenko@P\@MP
  }{}%
  \ifnum\yenko@byouga>\z@
      \ifthenelse{\lengthtest{\Arr@wHeadSize\p@=\z@}}{}{%
        \@tempdima=\Arr@wHeadSize\unitlength\advance\@tempdima-\p@
        \ukansan{\@tempdima}\yenko@tmp
        \Sub{1}{\ArrowHeadPit}\yenko@@tmp
        \Mulself\yenko@tmp\yenko@@tmp
        \@Div\yenko@tmp{##2}\yenko@tmp
        \RadDeg\yenko@tmp\yenko@da
        \if f\ArrowHeadType\else\edef\yenko@da{0}\fi
      }%
      \DegRad\yenko@s\yenko@s@
      \DegRad\yenko@e\yenko@e@
%\typeout{goto ParamC: (##2,##3)(\yenko@s@,\yenko@e@), d@theta=\d@theta}%
      \ParamC<mint=\yenko@s@,maxt=\yenko@e@>{(##2)*cos(T)}{(##3)*sin(T)}%
  \fi
}}%
%
\def\@@kaitenkigou<##1>[##2]{{\gsave
  \def\@bairitu{1}%
  \def\@hazimekaku{15}%
  \def\@owarikaku{345}%
  \def\@tyouhankei{3mm}%
  \def\@tanhankei{1.5mm}%
%\@ifundefined{@yscale}{}{%
%  \@tempdima\@tyouhankei\@tempdima = \@yscale\@tempdima
%    \edef\@tyouhankei{\the\@tempdima}%
%  \@tempdima\@tanhankei\@tempdima = \@xscale\@tempdima
%    \edef\@tanhankei{\the\@tempdima}%
%}%
  \def\@muki{n}%
  \edef\yazirusi@opt{\empty}%
  \Strchr{##1}{=}\kaitenkigou@tmp
  \ifnum\kaitenkigou@tmp>\z@
    \setkeys{emP}{##1}%
  \else
    \def\@bairitu{##1}%
  \fi
  \ifx\empty\yazirusi@opt
    \else\edef\@muki{\yazirusi@opt}\edef\yazirusi@opt{\empty}\fi
  \ifthenelse{\equal\@muki{n}}{\edef\@muki{\empty}}{}%
  \@tempdima=\@tanhankei
  \@tempdima=\@bairitu\@tempdima
  \@Div{\strip@pt\@tempdima}{\strip@pt\xunitlength}\rotmark@x
  \@tempdima=\@tyouhankei
  \@tempdima=\@bairitu\@tempdima
  \@Div{\strip@pt\@tempdima}{\strip@pt\yunitlength}\rotmark@y
%  \Mul\rotmark@x{2}\rotmark@y
    \ifthenelse{\equal{##2}{0}}{%
      \Dayenko[\@muki]\rotmark@x\rotmark@y{\@hazimekaku}{\@owarikaku}%
    }{%
      \EPSkaiten\O@@{##2}{%
          \Dayenko[\@muki]\rotmark@x\rotmark@y{\@hazimekaku}{\@owarikaku}%
      }%
    }%
\grestore}}%
%
% EMpscolor
%
    \def\EMpscolor##1{%
%\typeout{EMpscolor:##1}%\ccc
      \gsave
\edef\nuri@iro@{##1}%
      \EMpsIrositei{##1}%
%      \immediate\write\EMps@out{\csname EMps@##1\endcsname\space \EMsetcolor}%
    }%
    \def\endEMpscolor{\grestore}%
%
%
% arcto
%
\def\psarcto##1##2##3{%
  \xytops{##1}\@@x\@@y
  \xytops{##2}\@@@x\@@@y
  \ltops{##3}\@@r
  \immediate\write\EMps@out{\@@x\space\@@y\space\@@@x\space\@@@y\space\@@r\space arcto}%
}%
\def\psarc##1##2##3##4{%
  \xytops{##1}\@@x\@@y
  \ltops{##2}\@@r
  \immediate\write\EMps@out{\@@x\space\@@y\space\@@r\space ##3\space ##4 arc}%
}%
\def\pscurveto##1##2##3{%
  \xytops{##1}\@@x\@@y
  \xytops{##2}\@@@x\@@@y
  \xytops{##3}\@@@@x\@@@@y
  \immediate\write\EMps@out{\@@x\space\@@y\space\@@@x\space\@@@y\space\@@@@x\space\@@@@y\space curveto}%
}%
\def\psmoveto##1{%
  \xytops{##1}\@@x\@@y
  \immediate\write\EMps@out{\@@x\space\@@y\space moveto}%
}%
\def\pslineto##1{%
  \xytops{##1}\@@x\@@y
  \immediate\write\EMps@out{\@@x\space\@@y\space lineto}%
}%
\def\psLineto##1{%
    \edef\psLineto@tmp{##1}%
    \expandafter\makeTenHairetu\psLineto@tmp
%    \edef\psLineto@P{\hairetu{TH@V}{1}}%
%    \psmoveto{\psLineto@P}%
    \Cfor{\edef\psLineto@i{0}}{\psLineto@i<\TH@N}{}\do{%
      \Incr\psLineto@i
      \edef\psLineto@P{\hairetu{TH@V}{\psLineto@i}}%
      \pslineto\psLineto@P
    }%
}%
\def\psnewpath{%
  \immediate\write\EMps@out{newpath}%
}%
\def\psclosepath{%
  \immediate\write\EMps@out{closepath}%
}%
\def\psclip{%
  \immediate\write\EMps@out{clip}%
}%
\def\psclippath{%
  \immediate\write\EMps@out{clippath}%
}%
\def\psstroke{%
  \immediate\write\EMps@out{stroke}%
}%
\def\pssetgray##1{\immediate\write\EMps@out{##1\space setgray}}%
\def\psfill{\@ifstar{\psfill@}{\@psfill}}%
\def\@psfill{\@ifnextchar[{\@@psfill}{\@@psfill[.5]}}%
\def\@@psfill[##1]{\@ifnextchar<{\@@@psfill[##1]}{\@@@psfill[##1]<\empty>}}%
\def\@@@psfill[##1]<##2>{{%
  \edef\nuri@iro{\nuri@iro@}%
  \Strchr{##1}{=}\psfill@tmp
  \ifnum\psfill@tmp>\z@
    \setkeys{emP}{##1}%
  \else
    \Sub{1}{##1}\nuri@grayscale
  \fi
  \ifx\empty ##2\else\setkeys{emP}{##2}\fi
  \ifthenelse{\equal\nuri@iro\empty}{%
    \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
  }{%
    \EMpsIrositei{\nuri@iro}%
  }%
  \immediate\write\EMps@out{fill}%
}}%
%
\def\psfill@{\@ifnextchar[{\psfill@@}{\psfill@@[45]}}%
\def\psfill@@[##1]{\@ifnextchar<{\psfill@@@[##1]}{\psfill@@@[##1]<\empty>}}%
\def\psfill@@@[##1]<##2>{\psclip\Hatchpolygon[##1]<##2>{\LT\LB\RB\RT}\psnewpath}%
%
\def\psarcbox{\@ifundefined{nuri@grayscale}{%
                \@ifundefined{nuri@iro}{\@psarcbox}{%
                  \ifthenelse{\equal\nuri@iro\empty}{\@psarcbox}{\psarcboxfil}}%
              }{\psarcboxfil}}%
\def\@psarcbox##1##2##3##4##5{%
  \Tyuuten{##1}{##2}\psarcbox@s
  \psnewpath
  \psmoveto\psarcbox@s
  \psarcto{##2}{##3}{##5}%
  \psarcto{##3}{##4}{##5}%
  \psarcto{##4}{##1}{##5}%
  \psarcto{##1}{##2}{##5}%
  \pslineto\psarcbox@s
  \psstroke
}%
\def\psarcboxfil##1##2##3##4##5{%
  \Tyuuten{##1}{##2}\psarcbox@s
  \psnewpath
  \psmoveto\psarcbox@s
  \psarcto{##2}{##3}{##5}%
  \psarcto{##3}{##4}{##5}%
  \psarcto{##4}{##1}{##5}%
  \psarcto{##1}{##2}{##5}%
  \pslineto\psarcbox@s
  \immediate\write\EMps@out{gsave}%
  \ifthenelse{\equal\nuri@iro\empty}{%
    \immediate\write\EMps@out{\nuri@grayscale\space setgray}%
  }{%
%    \immediate\write\EMps@out{%
%      \csname EMps@\nuri@iro\endcsname\space \EMsetcolor}%
    \EMpsIrositei{\nuri@iro}%
  }%
  \immediate\write\EMps@out{fill}%
  \immediate\write\EMps@out{grestore}%
  \ifthenelse{\equal\draw@border\empty}{}{%
      \ifthenelse{\equal\iro@\empty}{%
        \immediate\write\EMps@out{stroke}%
      }{%
        \begin{EMpscolor}{\iro@}%
          \immediate\write\EMps@out{stroke}%
        \end{EMpscolor}%
      }%
  }%
}%
%
\def\@EMbane<##1>##2##3##4##5{{%
  \gsave
  \strchr{##1}{=}\bane@tmp
  \ifnum\bane@tmp>\z@\setkeys{emP}{##1}\else\edef\bane@hukurami{##1}\fi
  \Subvec{##3}{##2}\EMbane@v
  \Argvec\EMbane@v\EMbane@arg
  \Kyori{##2}{##3}\EMbane@h
  \Tyuuten{##2}{##3}\EMbane@M
  \Mul{-2}{##4}\EMbane@xmin
  \calcval{\EMbane@h-2*(##4)*(\bane@hukurami)}\EMbane@h
  \def\EMbane@Xt{(-\bane@hukurami)*(##4)*(cos(T)-1)+T*\EMbane@h/($pi*(2*(##5)+1))}%
  \def\EMbane@Yt{##4*sin(T)}%
  \BKinziOresen\EMbane@Xt\EMbane@Yt{0}{2*$pi}{.05}\EMbane@ii%
  \Put{##2}{\EPSkaiten\O{\EMbane@arg}{\Drawline\EMbane@ii}}%
  \Cfor{\edef\EMbane@n{1}}{\EMbane@n<##5}{\Incr\EMbane@n}\do{%
    \BKinziOresen\EMbane@Xt\EMbane@Yt{2*\EMbane@n*$pi+.1}{2*(\EMbane@n+1)*$pi-.1}{.05}\EMbane@i%
    \BKinziOresen\EMbane@Xt\EMbane@Yt{2*\EMbane@n*$pi}{2*(\EMbane@n+1)*$pi}{.05}\EMbane@ii%
    \Put{##2}{\EPSkaiten{(0,0)}{\EMbane@arg}{%
%      \begin{EMpscolor}{\EM@white}\relax
%        \setlinewidth{30}%
        \Drawline<linethickness=3pt,iro=white>\EMbane@i
%      \end{EMpscolor}\relax
      \Drawline\EMbane@ii
    }}%
  }%
  \BKinziOresen\EMbane@Xt\EMbane@Yt{2*##5*$pi+.1}{(2*(##5)+1)*$pi-.1}{.05}\EMbane@i%
  \BKinziOresen\EMbane@Xt\EMbane@Yt{2*##5*$pi}{(2*(##5)+1)*$pi}{.05}\EMbane@ii%
  \Put{##2}{\EPSkaiten\O{\EMbane@arg}{%
%      \begin{EMpscolor}{\EM@white}\relax
%        \setlinewidth{30}%
        \Drawline<linethickness=3pt,iro=white>\EMbane@i
%      \end{EMpscolor}\relax
      \Drawline\EMbane@ii
  }}%
  \grestore
  \ignorespaces
}}%
%
\def\EMpsKinziB##1{%
  \edef\EMpsKinziC@tmp{##1}%
  \expandafter\makeTenHairetu\EMpsKinziC@tmp
%
  \edef\KC@i{1}%
  \IAdd\KC@i{1}\KC@ii
  \IAdd\KC@ii{1}\KC@iii
  \edef\KC@A{\hairetu{TH@V}{\KC@i}}%
  \edef\KC@B{\hairetu{TH@V}{\KC@ii}}%
  \edef\KC@C{\hairetu{TH@V}{\KC@iii}}%
  \Subvec\KC@C\KC@A\KC@AC
  \Tyuuten\KC@A\KC@B\KC@M
%  \landl\KC@B\KC@AC\KC@M{(0,1)}\KC@MM
  \vecXY\KC@AC\KC@x\KC@y
  \Abs\KC@x\KC@xx
  \Abs\KC@y\KC@yy
  \ifdim \KC@xx\p@>\KC@yy\p@
    \landl\KC@B\KC@AC\KC@M{(0,1)}\KC@MM
  \else
    \landl\KC@B\KC@AC\KC@M{(1,0)}\KC@MM
  \fi
  \Bunten\KC@A\KC@MM21\KC@AA
  \Bunten\KC@B\KC@MM21\KC@BB
  \pscurveto\KC@AA\KC@BB\KC@B
%
  \Cfor{}{\KC@iii<\TH@N}{}\do{%
    \IAdd\KC@iii{1}\KC@iv
    \edef\KC@D{\hairetu{TH@V}{\KC@iv}}%
    \Subvec\KC@C\KC@A\KC@AC
    \Subvec\KC@D\KC@B\KC@BD
    \Tyuuten\KC@B\KC@C\KC@N
%      \landl\KC@B\KC@AC\KC@N{(0,1)}\KC@NN
  \vecXY\KC@AC\KC@x\KC@y
  \Abs\KC@x\KC@xx
  \Abs\KC@y\KC@yy
  \ifdim \KC@xx\p@>\KC@yy\p@
    \landl\KC@B\KC@AC\KC@N{(0,1)}\KC@NN
  \else
    \landl\KC@B\KC@AC\KC@N{(1,0)}\KC@NN
  \fi
      \Bunten\KC@B\KC@NN21\KC@BBB
%      \landl\KC@C\KC@BD\KC@N{(0,1)}\KC@NNN
  \vecXY\KC@BD\KC@x\KC@y
  \Abs\KC@x\KC@xx
  \Abs\KC@y\KC@yy
  \ifdim \KC@xx\p@>\KC@yy\p@
    \landl\KC@C\KC@BD\KC@N{(0,1)}\KC@NNN
  \else
    \landl\KC@C\KC@BD\KC@N{(1,0)}\KC@NNN
  \fi
      \Bunten\KC@C\KC@NNN21\KC@CC
    \pscurveto\KC@BBB\KC@CC\KC@C
    \Incr\KC@i
    \IAdd\KC@i{1}\KC@ii
    \IAdd\KC@ii{1}\KC@iii
    \edef\KC@A{\hairetu{TH@V}{\KC@i}}%
    \edef\KC@B{\hairetu{TH@V}{\KC@ii}}%
    \edef\KC@C{\hairetu{TH@V}{\KC@iii}}%
  }%
%
  \Subvec\KC@C\KC@A\KC@AC
  \Tyuuten\KC@B\KC@C\KC@M
%  \landl\KC@B\KC@AC\KC@M{(0,1)}\KC@MM
  \vecXY\KC@AC\KC@x\KC@y
  \Abs\KC@x\KC@xx
  \Abs\KC@y\KC@yy
  \ifdim \KC@xx\p@>\KC@yy\p@
    \landl\KC@B\KC@AC\KC@M{(0,1)}\KC@MM
  \else
    \landl\KC@B\KC@AC\KC@M{(1,0)}\KC@MM
  \fi
  \Bunten\KC@B\KC@MM21\KC@BB
  \Bunten\KC@C\KC@MM21\KC@CC
  \pscurveto\KC@BB\KC@CC\KC@C
}%
%
\def\EMpsKinziC##1{%
  \edef\EMpsKinziC@tmp{##1}%
  \expandafter\makeTenHairetu\EMpsKinziC@tmp
%
  \edef\KC@i{1}%
  \IAdd\KC@i{1}\KC@ii
  \IAdd\KC@ii{1}\KC@iii
  \edef\KC@A{\hairetu{TH@V}{\KC@i}}%
  \edef\KC@B{\hairetu{TH@V}{\KC@ii}}%
  \edef\KC@C{\hairetu{TH@V}{\KC@iii}}%
  \Subvec\KC@C\KC@A\KC@AC
  \Tyuuten\KC@A\KC@B\KC@M
  \landl\KC@B\KC@AC\KC@M{(0,1)}\KC@MM
  \Bunten\KC@A\KC@MM21\KC@AA
  \Bunten\KC@B\KC@MM21\KC@BB
  \pscurveto\KC@AA\KC@BB\KC@B
%
  \Cfor{}{\KC@iii<\TH@N}{}\do{%
    \IAdd\KC@iii{1}\KC@iv
    \edef\KC@D{\hairetu{TH@V}{\KC@iv}}%
    \Subvec\KC@C\KC@A\KC@AC
    \Subvec\KC@D\KC@B\KC@BD
    \Tyuuten\KC@B\KC@C\KC@N
      \landl\KC@B\KC@AC\KC@N{(0,1)}\KC@NN
      \Bunten\KC@B\KC@NN21\KC@BBB
      \landl\KC@C\KC@BD\KC@N{(0,1)}\KC@NNN
      \Bunten\KC@C\KC@NNN21\KC@CC
    \pscurveto\KC@BBB\KC@CC\KC@C
    \Incr\KC@i
    \IAdd\KC@i{1}\KC@ii
    \IAdd\KC@ii{1}\KC@iii
    \edef\KC@A{\hairetu{TH@V}{\KC@i}}%
    \edef\KC@B{\hairetu{TH@V}{\KC@ii}}%
    \edef\KC@C{\hairetu{TH@V}{\KC@iii}}%
  }%
%
  \Subvec\KC@C\KC@A\KC@AC
  \Tyuuten\KC@B\KC@C\KC@M
  \landl\KC@B\KC@AC\KC@M{(0,1)}\KC@MM
  \Bunten\KC@B\KC@MM21\KC@BB
  \Bunten\KC@C\KC@MM21\KC@CC
  \pscurveto\KC@BB\KC@CC\KC@C
}%
%
\def\changeArrowHeadSize##1{%
%  \Mulself\as@i{##1}%
  \Mulself\as@ii{##1}%
  \Mulself\as@iii{##1}%
  \def\arrow@size{\as@i\space\as@ii\space\as@iii\space\as@hekomi}%
  \Mul\ArrowHeadSize{##1}\ArrowHeadSize%
  \setarrowsize<\ArrowHeadPit>{\as@i}{\as@ii}{\as@iii}%
  \templa0.033\unitlength
  \ifdim\templa>\z@\relax
    \@Div{\ArrowHeadSize}{\strip@pt\templa}\Arr@wHeadSize
  \fi
}%
%\def\emSankaku##1{%
\DeclareRobustCommand\emSankaku{\@emSankaku}%
\def\@emSankaku{\@ifnextchar<{\@@emSankaku}{\@@emSankaku<\empty>}}%
\def\@@emSankaku<##1>##2{%
  \define@key{emPs}{size}{\edef\emS@size{####1}}%
  \ifx\empty##1
    \edef\emS@size{0.8zw}%
  \else
    \setkeys{emPs}{##1}%
  \fi
  \ifx\empty##1
  \else
    \ifthenelse{\equal\emS@size{*}}{%
    \setbox0=\hbox{$\scriptstyle\text{##2}$}%
    \@tempdima=0.9\wd0
    \edef\emS@size{\the\@tempdima}%
%\typeout{emSankaku: size=\emS@size}%\ssss
    }{}%
  \fi
  \pstriangle*<dash=,nuriiro=white,border,size=\emS@size>\relax
  \ifx\empty##1
    \Put\O@@(0,0)[c]{$\scriptstyle\text{##2}$}\relax
  \else
    \Put\O@@(0,0)[t]{$\scriptstyle\text{##2}$}\relax
  \fi
}%
%\def\emGyakuSankaku##1{%
\DeclareRobustCommand\emGyakuSankaku[1]{%
  \pstriangle*<dash=,nuriiro=white,border,size=0.7zw,kaiten=180>\relax
  \Put\O@@[c]{$\scriptstyle\text{##1}$}\relax
}%
%\def\emSikaku##1{%
\DeclareRobustCommand\emSikaku[1]{%
  \pssquare*<dash=,nuriiro=white,border,size=0.7zw>\relax
  \Put\O@@[c]{$\scriptstyle\text{##1}$}\relax
}%
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%   \immediate\openout \EMps@out \currentEPSfile
%\typeout{filename:\EMps@filename}%
    \immediate\openout \EMps@out \EMps@filename
    \purexytops{(\xmax,\ymax)}\@@xmax\@@ymax
    \Seisuububun\@@xmax\@@xmax@
    \ifdim\@@xmax pt>\@@xmax@ pt\relax\Incr\@@xmax@\fi
    \Seisuububun\@@ymax\@@ymax@
    \ifdim\@@ymax pt>\@@ymax@ pt\relax\Incr\@@ymax@\fi
%    \purexytops{(\xmin,\ymin)}\@@xmin\@@ymin
%    \Seisuububun\@@xmin\@@xmin\Incr\@@xmin
%    \Seisuububun\@@ymin\@@ymin\Incr\@@ymin
    \immediate\write\EMps@out{\@percent !PS-Adobe-3.0 EPSF-3.0}%
    \immediate\write\EMps@out{%
      \@percent\@percent Creator: emathPs \Ps@version\space%
      tDB (CQB00260@nifty.ne.jp)}%
    \immediate\write\EMps@out{%
      \@percent\@percent BoundingBox: 0 0 \@@xmax@\space \@@ymax@}%
    \immediate\write\EMps@out{%
      \@percent\@percent HiResBoundingBox: 0 0 \@@xmax\space \@@ymax}%
    \immediate\write\EMps@out{/emathsave save def}%
%   \immediate\write\EMps@out{initgraphics}%
%   \immediate\write\EMps@out{10 setlinewidth}%
    \ifthenelse{\equal\EMcolor@type{rgb}}{%
      \immediate\write\EMps@out{  0 0 0 setrgbcolor}%
    }{%
      \immediate\write\EMps@out{  0 0 0 1 setcmykcolor}%
    }%
%\immediate\write\EMps@out{0.1 0.1 scale}%
\immediate\write\EMps@out{0.099626401 0.099626401 scale}%
%
    \immediate\write\EMps@out{/arrowdict 16 dict def}%
    \immediate\write\EMps@out{arrowdict begin}%
    \immediate\write\EMps@out{/mtrx matrix def}%
    \immediate\write\EMps@out{end}%
    \immediate\write\EMps@out{/arrow}%
    \immediate\write\EMps@out{ \@lbrace\space arrowdict begin}%
    \immediate\write\EMps@out{ /hekomi exch def}%
    \immediate\write\EMps@out{ /headlength exch def}%
    \immediate\write\EMps@out{ /halfheadthickness exch 2 div def}%
    \immediate\write\EMps@out{ /halfthickness exch 2 div def}%
    \immediate\write\EMps@out{ /tipy exch def /tipx exch def}%
    \immediate\write\EMps@out{ /taily exch def /tailx exch def}%
    \immediate\write\EMps@out{ /dx tipx tailx sub def}%
    \immediate\write\EMps@out{ /dy tipy taily sub def}%
    \immediate\write\EMps@out{ /arrowlength dx dx mul dy dy mul add sqrt def}%
    \immediate\write\EMps@out{ /angle dy dx atan def}%
    \immediate\write\EMps@out{ /base arrowlength headlength sub def}%
    \immediate\write\EMps@out{ /hekomibase base hekomi add def}%
    \immediate\write\EMps@out{ /savematrix mtrx currentmatrix def}%
    \immediate\write\EMps@out{ tailx taily translate}%
    \immediate\write\EMps@out{ angle rotate}%
    \immediate\write\EMps@out{ 0 halfthickness neg moveto}%
    \immediate\write\EMps@out{ hekomibase halfthickness neg lineto}%
    \immediate\write\EMps@out{ base halfheadthickness neg lineto}%
    \immediate\write\EMps@out{ arrowlength 0 lineto}%
    \immediate\write\EMps@out{ base halfheadthickness lineto}%
    \immediate\write\EMps@out{ hekomibase halfthickness lineto}%
    \immediate\write\EMps@out{ 0 halfthickness lineto}%
    \immediate\write\EMps@out{ closepath}%
    \immediate\write\EMps@out{ savematrix setmatrix}%
    \immediate\write\EMps@out{end}%
    \immediate\write\EMps@out{\@rbrace\space def}%
%
    \immediate\write\EMps@out{/ellipsedict 8 dict def}%
    \immediate\write\EMps@out{ellipsedict /mtrx matrix put}%
    \immediate\write\EMps@out{/ellipse}%
    \immediate\write\EMps@out{\@lbrace\space ellipsedict begin}%
    \immediate\write\EMps@out{  /endangle exch def}%
    \immediate\write\EMps@out{  /startangle exch def}%
    \immediate\write\EMps@out{  /yrad exch def}%
    \immediate\write\EMps@out{  /xrad exch def}%
    \immediate\write\EMps@out{  /y exch def}%
    \immediate\write\EMps@out{  /x exch def}%
    \immediate\write\EMps@out{  /savematrix mtrx currentmatrix def}%
    \immediate\write\EMps@out{  x y translate}%
    \immediate\write\EMps@out{  xrad yrad scale}%
    \immediate\write\EMps@out{  0 0 1 startangle endangle arc}%
    \immediate\write\EMps@out{  savematrix setmatrix}%
    \immediate\write\EMps@out{  end}%
    \immediate\write\EMps@out{\@rbrace\space def}%
  }%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\@@emathPut@@##1[##2]{%
%\typeout{@@emathPut@@:##1[##2]}%
  \def\syaei@xpos{}\def\syaei@ypos{}%
  \def\syaei@linewidth{\syaei@linewidth@}%
  \edef\syaei@iro@{\empty}%
  \edef\syaei@mozi@iro@{\empty}%
  \edef\put@KM{\put@KM@}%
%\typeout{pszahyou:@@emathPut@@:put@KM=\put@KM}%
  \edef\put@SM{\empty}%
  \edef\v@mark{\empty}%
  \define@key{emPut}{syaeiiro}{\def\syaei@iro@{####1}}%
  \define@key{emPut}{syaeimoziiro}{\def\syaei@mozi@iro@{####1}}%
  \define@key{emPut}{houi}{\edef\@houi{####1}}%
  \define@key{emPut}{xlabel}{\def\label@x{####1}}%
  \define@key{emPut}{ylabel}{\def\label@y{####1}}%
  \define@key{emPut}{syaeix}{\strip@cmd{####1}\syaei@xval}%
%  \define@key{emPut}{xpos}{\def\syaei@xpos{####1}}%
%  \define@key{emPut}{ypos}{\def\syaei@ypos{####1}}%
  \define@key{emPut}{xpos}{%
    \headchar{####1}\houi@h\houi@r
    \if [\houi@h
      \edef\syaei@xpos{####1}%
    \else\if (\houi@h
      \edef\syaei@xpos{####1}%
    \else
      \edef\syaei@xpos{[####1]}%
    \fi\fi}%
  \define@key{emPut}{ypos}{%
    \headchar{####1}\houi@h\houi@r
    \if [\houi@h
      \edef\syaei@ypos{####1}%
    \else\if (\houi@h
      \edef\syaei@ypos{####1}%
    \else
      \edef\syaei@ypos{[####1]}%
    \fi\fi}%
  \define@key{emPut}{syaei}[xy]{%
    \expandafter\@tfor\expandafter\@@c\expandafter:\expandafter=####1\do{%
      \if x\@@c\edef\syaei@x{1}\else
      \if y\@@c\edef\syaei@y{1}\fi\fi}}%
  \define@key{emPut}{syaeisensyu}{\def\syaeisensyu{####1}}%
  \define@key{emPut}{linewidth}{\def\syaei@linewidth{####1}}%
  \define@key{emPut}{linethickness}{\def\syaei@linewidth{####1}}%
  \define@key{emPut}{kuromaru}[1]{\edef\put@KM{####1}}%
  \define@key{emPut}{siromaru}[1]{\edef\put@SM{####1}}%
  \define@key{emPut}{vmark}{\def\v@mark{####1}}%
  \define@key{emPut}{dash}{%
    \headchar{####1}\dash@a\dash@b
    \ifthenelse{\equal{\dash@a}{[}}{%
      \edef\dash@tmp{####1}\expandafter\setdash\dash@tmp}{%
      \setdash{####1}}%
      \let\syaeisensyu\drawline
    }%
  \define@key{emPut}{hasenLG}{%
    \edef\hasenLG@opt{####1}%
%    \setdash{####1}\let\syaeisensyu\pshasen
  }%
  \Strchr{##2}{=}\emP@tmp
  \ifnum\emP@tmp=\z@
    \emstrstr{##2}{syaei}%
    \ifnum\retval>\z@
      \edef\emP@tmp{1}%
    \else
      \emstrstr{##2}{kuromaru}%
      \ifnum\retval>\z@\edef\emP@tmp{1}\fi
    \fi
  \fi
  \ifthenelse{\emP@tmp>\z@}{%
    \gsave
    \edef\syaei@x{0}%
    \edef\syaei@y{0}%
    \edef\@houi{\empty}%
    \vecXY{\cPut@orgP}\@Px\@Py
    \edef\syaeiX{(\@Px,0)}%
    \edef\syaeix{\@Px}%
    \edef\syaeiY{(0,\@Py)}%
    \edef\syaeiy{\@Py}%
\EMclip\@Px\label@x
\@ifundefined{xlabelF}{}{\xlabelF\label@x\label@x}%
\EMedef\xlabel{\label@x}%
\EMclip\@Py\label@y
\@ifundefined{ylabelF}{}{\ylabelF\label@y}%
\EMedef\labely{\label@y}%
    \let\syaeisensyu\drawline
    \setkeys{emPut}{##2}%
    \@ifundefined{syaei@xval}{}{%
      \expandafter\edef\csname\syaei@xval\endcsname{\@Px}}%
    {%
      \setlinewidth{\syaei@linewidth}%
      \edef\put@kuromaru{0}%
      \ifnum\syaei@x>\z@
        \Abs\@Py\@tmp
        \ifdim\@tmp\p@>\emLlim\p@
          \ifx\empty\syaei@iro@
%            \put(0,0){\syaeisensyu(\@Px,0)(\@Px,\@Py)}%
            \ifx\empty\syaei@hasenLG
              \Drawline{(\@Px,0)(\@Px,\@Py)}%
            \else
              \Drawline<hasenLG=\syaei@hasenLG>{(\@Px,0)(\@Px,\@Py)}%
            \fi
          \else
            \begin{EMpscolor}\syaei@iro@
%              \put(0,0){\syaeisensyu(\@Px,0)(\@Px,\@Py)}%
              \ifx\empty\syaei@hasenLG
                \Drawline{(\@Px,0)(\@Px,\@Py)}%
              \else
                \Drawline<hasenLG=\syaei@hasenLG>{(\@Px,0)(\@Px,\@Py)}%
              \fi
            \end{EMpscolor}%
          \fi
        \fi
        {\ifx\empty\syaei@xpos
          \ifdim\@Py pt>\z@\def\syaei@xpos{[s]}\else\def\syaei@xpos{[n]}\fi
         \fi
         \edef\Put@math{1}%
         \edef\emPut@tmp{{(\@Px,0)}\syaei@xpos}%
         \ifx\empty\syaei@mozi@iro@
           \expandafter\cPut\emPut@tmp{\label@x}%
         \else
           \EMedefappend\emPut@tmp{{\color{\syaei@mozi@iro@}{\label@x}}}%
           \expandafter\cPut\emPut@tmp
         \fi
        }%
      \fi%
      \ifnum\syaei@y>\z@
        \Abs\@Px\@tmp
        \ifdim\@tmp\p@>\emLlim\p@
          \ifx\empty\syaei@iro@
%            \put(0,0){\syaeisensyu(\@Px,\@Py)(0,\@Py)}%
            \ifx\empty\syaei@hasenLG
              \Drawline{(\@Px,\@Py)(0,\@Py)}%
            \else
              \Drawline<hasenLG=\syaei@hasenLG>{(\@Px,\@Py)(0,\@Py)}%
            \fi
          \else
            \begin{EMpscolor}\syaei@iro@
%              \put(0,0){\syaeisensyu(\@Px,\@Py)(0,\@Py)}%
              \ifx\empty\syaei@hasenLG
                \Drawline{(\@Px,\@Py)(0,\@Py)}%
              \else
                \Drawline<hasenLG=\syaei@hasenLG>{(\@Px,\@Py)(0,\@Py)}%
              \fi
            \end{EMpscolor}%
          \fi
        \fi
        {\ifx\empty\syaei@ypos
          \ifdim\@Px pt>\z@\def\syaei@ypos{[w]}\else\def\syaei@ypos{[e]}\fi
         \fi
         \edef\emPut@tmp{{(0,\@Py)}\syaei@ypos}%
         \edef\Put@math{1}%
         \ifx\empty\syaei@mozi@iro@
           \expandafter\cPut\emPut@tmp{\label@y}%
         \else
           \EMedefappend\emPut@tmp{{\color{\syaei@mozi@iro@}{\label@y}}}%
           \expandafter\cPut\emPut@tmp
         \fi
        }%
      \fi
      \ifx\empty\put@KM
      \else
        \ifthenelse{\equal\put@KM{1}}{%
          \Kuromaru\cPut@orgP
        }{%
          \expandafter\Kuromaru\put@KM{\cPut@orgP}%
        }%
      \fi
      \ifx\empty\put@SM
      \else
        \ifthenelse{\equal\put@SM{1}}{%
          \Siromaru\cPut@orgP
        }{%
          \expandafter\Siromaru\put@SM{\cPut@orgP}%
        }%
      \fi
      \ifx\empty\v@mark\else
        \EMedef\v@mark@{\v@mark}\emathPut{##1}[c]{\v@mark@}\fi
    }%
    \grestore
    \ifthenelse{\equal{\@houi}{\empty}}{\emathPut{##1}}{%
      \@@emathPut@@@{##1}[\@houi]}%
  }{%\typeout{BBB}%
      \ifx\empty\put@KM
      \else
        \ifthenelse{\equal\put@KM{1}}{%
          \Kuromaru\cPut@orgP
        }{%
          \expandafter\Kuromaru\put@KM{\cPut@orgP}%
        }%
      \fi
    \@@emathPut@@@{##1}[##2]}%
  }%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \setlinewidth{\default@linewidth}%
  \setdash{}%
  \setlinecap{\cur@linecap}%
  \setlinejoin{0}%
  \setarrowsize{}{}{}%
%  \ifthenelse{\equal{\nuri@iro@}{\empty}}{}{\begin{EMpscolor}\nuri@iro@}%
  \ifthenelse{\equal{\nuri@iro@}{\empty}}{}{\EMpscolor\nuri@iro@}%
%
%
\everypszahyou\ignorespaces
}%
%\def\endpszahyou{%
\DeclareRobustCommand\endpszahyou{%
  \ifdrawaxis\drawXYaxis\fi
  \ifthenelse{\equal{\nuri@iro@}{\empty}}{}{\endEMpscolor}%
  \ifnum\dp@frame>\z@\Takakkei<linethickness=.1pt,iro=red>%
    {\trueLT\trueLB\trueRB\trueRT}\fi
  \ifnum\EMps@mode=\@ne
    \immediate\write\EMps@out{showpage}%
    \immediate\write\EMps@out{emathsave restore}%
    \immediate\write\EMps@out{\@percent\@percent EOF}%
    \immediate\closeout\EMps@out
\@ifundefined{eps@pdf}{}{%
  \getflext{\EMps@filename}\EMps@node\EMps@ext
  \unlink{\EMps@node.xbb}%
  \EM@system{repstopdf \EMps@filename}%
}%
%    \ifnum\remake@eps=\z@
      \ifinclude@eps
%        \put(\xmin,\ymin){\includegraphics[,clip=\EMps@clip]{\EMps@filename}}%
%\typeout{end：includegraphics:\EMps@filename}%
        \put(\EMps@x@include,\EMps@y@include){\includegraphics[clip=\EMps@clip]{\EMps@filename}}%
      \else
        \Gread@eps{\EMps@filename}%
%\typeout{\csname \EMps@filename initBBox\endcsname;EMBBox=\EMBBox}%
        \ifthenelse{\equal{\csname \EMps@filename initBBox\endcsname}{\EMBBox}}{}{%
         \immediate\write\@auxout{\string\newlabel{LastPage}{{}{0}}}}%
      \fi
%    \fi
  \fi
  \endltxpicture
  \egroup
  \@ignoretrue
}%
%
%
% pszahyou* 環境
%
\expandafter\def\csname pszahyou*\endcsname{\drawaxisfalse\pszahyou}%
\expandafter\def\csname endpszahyou*\endcsname{\endpszahyou\@ignoretrue}%
%
%
% 空間
%
\AtBeginDocument{%
\@ifundefined{iiiDrawline}{}{%
\def\psZahyou{\@ifnextchar[{\@psZahyou}{\@psZahyou[]}}%
\def\@psZahyou[#1]{\@ifnextchar[{\@@psZahyou[#1]}{\@@psZahyou[#1][][]}}%
\def\@@psZahyou[#1][#2][#3]{\@ifnextchar({%
  \@@@psZahyou[#1][#2][#3]}{%
  \@@@psZahyou[#1][#2][#3](\Xmin,\Xmax)(\Ymin,\Ymax)(\Zmin,\Zmax)}}%
\def\@@@psZahyou[#1][#2][#3](#4,#5)(#6,#7)(#8,#9){%
%
  \xIncr\pszahyou@N
  \def\zahyou@haiti{\zahyou@haiti@default}%
  \def\zahyou@haiti@hosei{}%
  \def\ue@yohaku{0}%
  \def\sita@yohaku{0}%
  \def\migi@yohaku{0}%
  \def\hidari@yohaku{0}%
  \def\arrow@headsize{1}%
  \edef\v@mark{\empty}%
%
\define@key{emP}{Ex}{%
  \headchar{##1}\Ex@@@h\Ex@@@o
  \ifthenelse{\equal\Ex@@@h{r}}{\expandafter\Rdef\Ex@@@o\@@@Ex}{\def\@@@Ex{##1}}}%
\define@key{emP}{Ey}{%
  \headchar{##1}\Ey@@@h\Ey@@@o
  \ifthenelse{\equal\Ey@@@h{r}}{\expandafter\Rdef\Ey@@@o\@@@Ey}{\def\@@@Ey{##1}}}%
\define@key{emP}{Ez}{%
  \headchar{##1}\Ez@@@h\Ez@@@o
  \ifthenelse{\equal\Ez@@@h{r}}{\expandafter\Rdef\Ez@@@o\@@@Ez}{\def\@@@Ez{##1}}}%
\def\dp@frame{0}%
\define@key{emP}{frame}[1]{%
  \def\dp@frame{##1}%
}%
\define@key{emPs}{frame}[1]{%
  \def\dp@frame{##1}%
}%
%
  \def\EMps@filename{}%
  \def\ps@debug@{}%
  \def\EMps@clip{true}%
  \edef\Ex@Org{\empty}%
  \edef\Ex@R{.9}%
  \def\@@@Ey{(1,0)}%             y軸正方向の単位ベクトル
  \def\@@@Ez{(0,1)}%             z軸正方向の単位ベクトル
  \Rdef(.667,-138)\@@@Ex%  x軸正方向の単位ベクトル
  \Strchr{#1}{=}\zahyou@tmp
  \ifnum\zahyou@tmp>\z@
    \setkeys{emP}{#1}%
  \else
    \ifthenelse{\equal{#1}\empty}{}{\edef\@@@Ex{#1}}%
    \ifthenelse{\equal{#2}\empty}{}{\edef\@@@Ey{#2}}%
    \ifthenelse{\equal{#3}\empty}{}{\edef\@@@Ez{#3}}%
  \fi
  \edef\Xmin{#4}\edef\Xmax{#5}%
  \edef\Ymin{#6}\edef\Ymax{#7}%
  \edef\Zmin{#8}\edef\Zmax{#9}%
  \Piiitoii{(\Xmin,\Ymin,\Zmin)}\Zh@tmp\vecXY\Zh@tmp\X@mmm\Y@mmm
  \Piiitoii{(\Xmin,\Ymin,\Zmax)}\Zh@tmp\vecXY\Zh@tmp\X@mmM\Y@mmM
  \Piiitoii{(\Xmin,\Ymax,\Zmin)}\Zh@tmp\vecXY\Zh@tmp\X@mMm\Y@mMm
  \Piiitoii{(\Xmin,\Ymax,\Zmax)}\Zh@tmp\vecXY\Zh@tmp\X@mMM\Y@mMM
  \Piiitoii{(\Xmax,\Ymin,\Zmin)}\Zh@tmp\vecXY\Zh@tmp\X@Mmm\Y@Mmm
  \Piiitoii{(\Xmax,\Ymin,\Zmax)}\Zh@tmp\vecXY\Zh@tmp\X@MmM\Y@MmM
  \Piiitoii{(\Xmax,\Ymax,\Zmin)}\Zh@tmp\vecXY\Zh@tmp\X@MMm\Y@MMm
  \Piiitoii{(\Xmax,\Ymax,\Zmax)}\Zh@tmp\vecXY\Zh@tmp\X@MMM\Y@MMM
  \Max{\X@mmm,\X@mmM,\X@mMm,\X@mMM,\X@Mmm,\X@MmM,\X@MMm,\X@MMM}\xmax
  \Min{\X@mmm,\X@mmM,\X@mMm,\X@mMM,\X@Mmm,\X@MmM,\X@MMm,\X@MMM}\xmin
  \Max{\Y@mmm,\Y@mmM,\Y@mMm,\Y@mMM,\Y@Mmm,\Y@MmM,\Y@MMm,\Y@MMM}\ymax
  \Min{\Y@mmm,\Y@mmM,\Y@mMm,\Y@mMM,\Y@Mmm,\Y@MmM,\Y@MMm,\Y@MMM}\ymin
%
%   emathPs.sty の \borderwidth への対応
\edef\truexmin{\xmin}%
\edef\trueymin{\ymin}%
\edef\truexmax{\xmax}%
\edef\trueymax{\ymax}%
\ifdim\border@width>\z@
  \@tempdima\border@width\@Div{\strip@pt\@tempdima}{\strip@pt\unitlength}\x@bd
  \Sub\xmin\x@bd\xmin\Add\xmax\x@bd\xmax
  \@tempdima\border@width\@Div{\strip@pt\@tempdima}{\strip@pt\unitlength}\y@bd
  \Sub\ymin\y@bd\ymin\Add\ymax\y@bd\ymax
\fi
  \drawaxisfalse
%
 \let\Drawline\psDrawline
  \let\Sensyu\psDrawline
  \let\Drawlines\psDrawlines
  \let\yclipDrawline\@psDrawline
  \let\xclipDrawline\@psDrawline
  \let\clipDrawline\@psDrawline
  \let\iiiclipDrawline\iiiDrawline
%  \let\iiiclipDrawline\iiiDrawline
  \let\EMpsIrositei\EM@psIrositei
%
  \pszahyou@(\xmin,\xmax)(\ymin,\ymax)%
  \def\O{(0,0,0)}%
  \def\O@@@{(0,0,0)}%
  \def\iiiXMAX{(\Xmax,0,0)}%
  \def\iiiYMAX{(0,\Ymax,0)}%
  \def\iiiZMAX{(0,0,\Zmax)}%
  \def\iiiXMIN{(\Xmin,0,0)}%
  \def\iiiYMIN{(0,\Ymin,0)}%
  \def\iiiZMIN{(0,0,\Zmin)}%
}%
\def\endpsZahyou{%
  \ifnum\dp@frame>\z@
    \bgroup%\color{red}%
    \iiitenretu*{X@X(\Xmax,\Ymin,\Zmin);Y@Y(\Xmax,\Ymax,\Zmin);Z@Z(\Xmin,\Ymax,\Zmin);O@O(\Xmin,\Ymin,\Zmin)}%
    \iiitenretu*{X@XX(\Xmax,\Ymin,\Zmax);Y@YY(\Xmax,\Ymax,\Zmax);Z@ZZ(\Xmin,\Ymax,\Zmax);O@OO(\Xmin,\Ymin,\Zmax)}%
    \iiiTakakkei<linethickness=.1pt,iro=red>{\X@X\Y@Y\Z@Z\O@O}%
    \iiiTakakkei<linethickness=.1pt,iro=red>{\X@XX\Y@YY\Z@ZZ\O@OO}%
    \iiiDrawlines<linethickness=.1pt,iro=red>{\X@X\X@XX;\Y@Y\Y@YY;\Z@Z\Z@ZZ;\O@O\O@OO}%
%    (\xmaxY,\yminY)(\xmaxY,\ymaxY)(\xminY,\ymaxY)(\xminY,\yminY)}%
%    \Takakkei<linethickness=.1pt,iro=green>\zenheimenY
    \@ifundefined{def@yohaku}{}{{\gsave\linethickness{.1pt}%
    \put(0,0){\color{green}%
      \rotateline(\xmaxY,\yminY)(\xmaxY,\ymaxY)%
      \rotateline(\xmaxY,\ymaxY)(\xminY,\ymaxY)%
      \rotateline(\xminY,\ymaxY)(\xminY,\yminY)%
      \rotateline(\xminY,\yminY)(\xmaxY,\yminY)%
    }\grestore}}%
    \Takakkei<linethickness=.1pt,iro=cyan>\zenheimen
    \egroup
  \fi
  \ifDrawaxis
    \iiiArrowLine{(0,0,0)}{(\Xmax,0,0)}%
    \iiiArrowLine{(0,0,0)}{(0,\Ymax,0)}%
    \iiiArrowLine{(0,0,0)}{(0,0,\Zmax)}%
%    \iiiDrawline<yazirusi=a>{(0,0,0)(\Xmax,0,0)}%
%    \iiiDrawline<yazirusi=a>{(0,0,0)(0,\Ymax,0)}%
%    \iiiDrawline<yazirusi=a>{(0,0,0)(0,0,\Zmax)}%
  \fi
  \endpszahyou
  \@ignoretrue
}%
%
% 座標軸を描画しない psZahyou* 環境
\expandafter\def\csname psZahyou*\endcsname{\Drawaxisfalse\psZahyou}%
\expandafter\def\csname endpsZahyou*\endcsname{\endpsZahyou}%
}%
}%
%
%
\endinput
%
2010/05/16 v 1.86 emathPs.sty から分離
2010/07/10 v 1.87 epstopdf を shell_escape_restricted からの呼び出しに対応
2010/07/26 v 1.88 psZahyou環境の定義も移管
2010/10/27 v 1.89 \zahyouMemori: + オプションのバグフィックス (BBS #9370)
2010/12/09 v 1.90 syaeisensyu について，zahyou環境との混用に配慮
2010/12/29 v 1.91 clipLline: \h@syugo の初期化
2011/02/16 v 1.92 \syaeihasenLG
2011/02/24 v 1.93 \ougigata,\yumigata: hazimeten=. 
                    右辺の扱いを emathPh と揃える (BBS #9681)
2011/04/28 v 1.94 \changeArrowHeadSize#1
2011/05/09 v 1.95 \Takakkei: <nuriiro=..>
2011/06/28 v 1.96 \enkobyspecial
2011/07/11 v 1.97 \psZahyou[frame]: 余白付きの枠を \rotateline で描画
2011/08/21 v 1.98 \psZahyou: \iiiclipDrawline-->\iiiDrawline
2011/09/09 v 1.99 \zahyouMemori: <size=..> オプションで黒丸サイズを指定
                  clipTakakkei環境：外部の指定法
2011/09/27 v 2.00 clipLfunc, clipQfunc環境
2011/11/09 v 2.01 clipLline, clipabcline
2011/12/06 v 2.02 扇形，弓形：斜線塗りの太さ
2011/12/19 v 2.03 \yokozikuMemori, \tatezikuMemori
2011/12/20 v 2.04 \yokozikuMemori, \tatezikuMemori: \gsave,\grestore で囲む
2011/12/25 v 2.05 \yokozikuMemori, \tatezikuMemori: 調整
2011/12/27 v 2.06 \yokozikuMemori, \tatezikuMemori: <Ls=..,dL=..> オプション
2012/01/10 v 2.07 \kaitenkigou: <yazirusi=r> オプションが無効だったのを修正
                  \Heikoukigou に対する <heikoukigousize=.> が 
                  pszahyou でも有効とする (BBS #10513)
2012/03/04 v 2.08 \emSikaku
                  \syaeithickness
2012/03/10 v 2.09 \En*: gradN など有効とする
2012/03/28 v 2.10 \clipQfunc: ゴースト処理
2012/04/03 v 2.11 \Yaziri: カラー対応
2012/04/04 v 2.12 \changeArrowHeadSize: バグ修正 (BBS #10679)
2012/04/13 v 2.13 \clipYfunc, \clipXfunc
2012/04/26 v 2.14 \clipxrange, \clipyrange
2012/05/05 v 2.15 <cliplabel=..>
2012/05/19 v 2.16 <EMcliplabel=..>
2012/05/21 v 2.17 <cliplabel=..> 整備
2012/06/10 v 2.18 \clipborder 引数なしを許容
2012/06/15 v 2.19 \gridlinethickness に対応
2012/06/20 v 2.20 \EMbane: <#1> に key=val を許容
2012/07/17 v 2.21 clipYoresen, 
                  \Enko : <hamidasikaku=始点,終点>
2012/07/27 v 2.22 \kaitenkigou: 矢印の調整
2012/12/17 v 2.23 \Enko における \setkeys のグループを emP --> emPs
2013/01/17 v 2.24 \Yaziri: 方向ベクトルが零ベクトルの場合 (BBS #11469)
2013/01/31 v 2.25 \xlabelF (BBS #11505)
2013/02/15 v 2.26 Henvi などを pszahyou環境でも有効とする (BBS #11567)
2013/02/16 v 2.27 \Yaziri: \emPaint ではなく，\Nuritubusi を呼ぶ (BBS #11572)
2013/05/20 v 2.28 clipabcline(+,-)環境
2013/09/10 v 2.29 \Enk@@@: <hazimeM=..,owariM=..> (BBS #11905)
2013/11/15 v 2.30 \Yaziri: <nuriiro=..,arrowheadsize=..>
2013/12/27 v 2.31 <syaeimoziiro> (BBS #12115)
2014/02/04 v 2.32 \kaitenkigou:バグ修正 (BBS #12217)
2014/02/12 v 2.33 \Enko: 矢印の位置を指定 <yazirusipos=..> (0..1)
2014/08/10 v 2.34 \EMpsBezier: <yazirusi=b/B> (BBS #12447)
2014/09/01 v 2.35 \psZahyou の定義に \AtBeginDocument をかぶせる。(BBS #12470)
2014/10/06 v 2.36 \clipSoukyokusen
2014/10/18 v 2.37 \Yaziri: <fill=0/1> オプション
2015/04/26 v 2.38 \emSankaku: emathPh.sty の定義との互換
2015/10/17 v 2.39 \EPShenkan
2017/08/20 v 2.40 \Dayenko: xscale, yscale 指定の場合 (BBS #13366)
